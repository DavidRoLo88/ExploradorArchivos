import{a as yf,b as pu,c as yu,d as _u,e as _f,f as wf,g as vf,h as bi,i as wu,j as vu,k as Js,l as Tf,m as Ef,n as Ys,o as ce,p as En,q as ut,r as Zs,s as Si,t as If,u as Af,v as bf,w as jt,x as Le}from"./chunk-CCFAKEYT.js";import{c as Xs}from"./chunk-ADPZH37H.js";import{$ as Tn,D as hf,F as df,I as Ws,J as Qs,K as fu,M as Hs,N as vn,Nb as gf,O as mu,Ob as pf,Pb as Ai,S as er,T as tr,V as Me,W as Y,X as et,Ya as rr,c as Lt,cb as at,f as uf,fa as ff,h as Gs,i as cf,k as Ei,l as Ks,m as qt,n as Ut,na as gu,oa as mf,r as Fe,w as lf,wa as nr,x as Ii}from"./chunk-3ZIC73LE.js";import{a as Ti,b as $s,d as du,e as C}from"./chunk-U7UK6LYI.js";var N_="firebase",O_="11.10.0";jt(N_,O_,"app");function Be(r){r===void 0&&(r=et(ff));let e=r.get(gu);return t=>new Lt(n=>{let i=e.add(),s=!1;function a(){s||(i(),s=!0)}let u=t.subscribe({next:c=>{n.next(c),a()},complete:()=>{n.complete(),a()},error:c=>{n.error(c),a()}});return u.add(()=>{n.unsubscribe(),a()}),u})}var Bt=new gf("ANGULARFIRE2_VERSION");var Sf=(r,e)=>{let t=e?[e]:bf(),n=[];return t.forEach(i=>{i.container.getProvider(r).instances.forEach(a=>{n.includes(a)||n.push(a)})}),n},Tu=function(r){return r[r.SILENT=0]="SILENT",r[r.WARN=1]="WARN",r[r.VERBOSE=2]="VERBOSE",r}(Tu||{}),nE=Ai()&&typeof Zone<"u"?Tu.WARN:Tu.SILENT;var eo=class{zone;delegate;constructor(e,t=cf){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,n){let i=this.zone,s=function(a){i?i.runGuarded(()=>{e.apply(this,[a])}):e.apply(this,[a])};return this.delegate.schedule(s,t,n)}},Ri=(()=>{class r{outsideAngular;insideAngular;constructor(){let t=et(at);this.outsideAngular=t.runOutsideAngular(()=>new eo(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new eo(typeof Zone>"u"?void 0:Zone.current,Gs))}static \u0275fac=function(n){return new(n||r)};static \u0275prov=er({token:r,factory:r.\u0275fac,providedIn:"root"})}return r})();var F_="firebase",M_="11.10.0";Le.registerVersion(F_,M_,"app-compat");var L_=["ngOnDestroy"],Cf=(r,e,t,n={})=>new Proxy(r,{get:(i,s)=>t.runOutsideAngular(()=>{if(r[s])return n?.spy?.get&&n.spy.get(s,r[s]),r[s];if(L_.indexOf(s)>-1)return()=>{};let a=e.toPromise().then(u=>{let c=u?.[s];return typeof c=="function"?c.bind(u):c?.then?c.then(h=>t.run(()=>h)):t.run(()=>c)});return new Proxy(()=>{},{get:(u,c)=>a[c],apply:(u,c,h)=>a.then(f=>{let g=f?.(...h);return n?.spy?.apply&&n.spy.apply(s,h,g),g})})})});var to=class{constructor(e){return e}},ir=new Me("angularfire2.app.options"),sr=new Me("angularfire2.app.name");function Pi(r,e,t){let n=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||n;let a=Le.apps.filter(u=>u&&u.name===i.name)[0]||e.runOutsideAngular(()=>Le.initializeApp(r,i));try{if(JSON.stringify(r)!==JSON.stringify(a.options)){let u=!!module.hot;q_("error",`${a.name} Firebase App already initialized with different options${u?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new to(a)}var q_=(r,...e)=>{Ai()&&typeof console<"u"&&console[r](...e)},U_={provide:to,useFactory:Pi,deps:[ir,at,[new mf,sr]]},hE=(()=>{class r{static initializeApp(t,n){return{ngModule:r,providers:[{provide:ir,useValue:t},{provide:sr,useValue:n}]}}constructor(t){Le.registerVersion("angularfire",Bt.full,"core"),Le.registerVersion("angularfire",Bt.full,"app-compat"),Le.registerVersion("angular",pf.full,t.toString())}static \u0275fac=function(n){return new(n||r)(Y(nr))};static \u0275mod=rr({type:r});static \u0275inj=tr({providers:[U_]})}return r})();function no(r,e,t,n,i){let[,s,a]=globalThis.\u0275AngularfireInstanceCache.find(u=>u[0]===r)||[];if(s)return j_(i,a)||(Pf("error",`${e} was already initialized on the ${t} Firebase App with different settings.${B_?" You may need to reload as Firebase is not HMR aware.":""}`),Pf("warn",{is:i,was:a})),s;{let u=n();return globalThis.\u0275AngularfireInstanceCache.push([r,u,i]),u}}function j_(r,e){try{return r.toString()===e.toString()}catch{return r===e}}var B_=typeof module<"u"&&!!module.hot,Pf=(r,...e)=>{Ai()&&typeof console<"u"&&console[r](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var G_=new Map,K_={activated:!1,tokenObservers:[]},W_={initialized:!1,enabled:!1};function tt(r){return G_.get(r)||Object.assign({},K_)}function kf(){return W_}var Q_="https://content-firebaseappcheck.googleapis.com/v1";var H_="exchangeDebugToken",Df={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},wE=24*60*60*1e3;var bu=class{constructor(e,t,n,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=n,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return C(this,null,function*(){this.stop();try{this.pending=new yu,this.pending.promise.catch(t=>{}),yield X_(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new yu,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function X_(r){return new Promise(e=>{setTimeout(e,r)})}var J_={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},zt=new Ef("appCheck","AppCheck",J_);function Nf(r){if(!tt(r).activated)throw zt.create("use-before-activation",{appName:r.name})}function Of(n,i){return C(this,arguments,function*({url:r,body:e},t){let s={"Content-Type":"application/json"},a=t.getImmediate({optional:!0});if(a){let A=yield a.getHeartbeatsHeader();A&&(s["X-Firebase-Client"]=A)}let u={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(r,u)}catch(A){throw zt.create("fetch-network-error",{originalErrorMessage:A?.message})}if(c.status!==200)throw zt.create("fetch-status-error",{httpStatus:c.status});let h;try{h=yield c.json()}catch(A){throw zt.create("fetch-parse-error",{originalErrorMessage:A?.message})}let f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw zt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});let g=Number(f[1])*1e3,y=Date.now();return{token:h.token,expireTimeMillis:y+g,issuedAtTimeMillis:y}})}function Ff(r,e){let{projectId:t,appId:n,apiKey:i}=r.options;return{url:`${Q_}/projects/${t}/apps/${n}:${H_}?key=${i}`,body:{debug_token:e}}}var Y_="firebase-app-check-database",Z_=1,Su="firebase-app-check-store";var ro=null;function ew(){return ro||(ro=new Promise((r,e)=>{try{let t=indexedDB.open(Y_,Z_);t.onsuccess=n=>{r(n.target.result)},t.onerror=n=>{var i;e(zt.create("storage-open",{originalErrorMessage:(i=n.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=n=>{let i=n.target.result;switch(n.oldVersion){case 0:i.createObjectStore(Su,{keyPath:"compositeKey"})}}}catch(t){e(zt.create("storage-open",{originalErrorMessage:t?.message}))}}),ro)}function tw(r,e){return nw(rw(r),e)}function nw(r,e){return C(this,null,function*(){let n=(yield ew()).transaction(Su,"readwrite"),s=n.objectStore(Su).put({compositeKey:r,value:e});return new Promise((a,u)=>{s.onsuccess=c=>{a()},n.onerror=c=>{var h;u(zt.create("storage-set",{originalErrorMessage:(h=c.target.error)===null||h===void 0?void 0:h.message}))}})})}function rw(r){return`${r.options.appId}-${r.name}`}var Ci=new Zs("@firebase/app-check");function Iu(r,e){return Js()?tw(r,e).catch(t=>{Ci.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Mf(){return kf().enabled}function Lf(){return C(this,null,function*(){let r=kf();if(r.enabled&&r.token)return r.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var iw={error:"UNKNOWN_ERROR"};function sw(r){return yf.encodeString(JSON.stringify(r),!1)}function Ru(r,e=!1,t=!1){return C(this,null,function*(){let n=r.app;Nf(n);let i=tt(n),s=i.token,a;if(s&&!Di(s)&&(i.token=void 0,s=void 0),!s){let h=yield i.cachedTokenPromise;h&&(Di(h)?s=h:yield Iu(n,void 0))}if(!e&&s&&Di(s))return{token:s.token};let u=!1;if(Mf())try{i.exchangeTokenPromise||(i.exchangeTokenPromise=Of(Ff(n,yield Lf()),r.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);let h=yield i.exchangeTokenPromise;return yield Iu(n,h),i.token=h,{token:h.token}}catch(h){return h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?Ci.warn(h.message):t&&Ci.error(h),Au(h)}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),s=yield tt(n).exchangeTokenPromise}catch(h){h.code==="appCheck/throttled"||h.code==="appCheck/initial-throttle"?Ci.warn(h.message):t&&Ci.error(h),a=h}let c;return s?a?Di(s)?c={token:s.token,internalError:a}:c=Au(a):(c={token:s.token},i.token=s,yield Iu(n,s)):c=Au(a),u&&cw(n,c),c})}function ow(r){return C(this,null,function*(){let e=r.app;Nf(e);let{provider:t}=tt(e);if(Mf()){let n=yield Lf(),{token:i}=yield Of(Ff(e,n),r.heartbeatServiceProvider);return{token:i}}else{let{token:n}=yield t.getToken();return{token:n}}})}function aw(r,e,t,n){let{app:i}=r,s=tt(i),a={next:t,error:n,type:e};if(s.tokenObservers=[...s.tokenObservers,a],s.token&&Di(s.token)){let u=s.token;Promise.resolve().then(()=>{t({token:u.token}),Vf(r)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Vf(r))}function qf(r,e){let t=tt(r),n=t.tokenObservers.filter(i=>i.next!==e);n.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=n}function Vf(r){let{app:e}=r,t=tt(e),n=t.tokenRefresher;n||(n=uw(r),t.tokenRefresher=n),!n.isRunning()&&t.isTokenAutoRefreshEnabled&&n.start()}function uw(r){let{app:e}=r;return new bu(()=>C(null,null,function*(){let t=tt(e),n;if(t.token?n=yield Ru(r,!0):n=yield Ru(r),n.error)throw n.error;if(n.internalError)throw n.internalError}),()=>!0,()=>{let t=tt(e);if(t.token){let n=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return n=Math.min(n,i),Math.max(0,n-Date.now())}else return 0},Df.RETRIAL_MIN_WAIT,Df.RETRIAL_MAX_WAIT)}function cw(r,e){let t=tt(r).tokenObservers;for(let n of t)try{n.type==="EXTERNAL"&&e.error!=null?n.error(e.error):n.next(e)}catch{}}function Di(r){return r.expireTimeMillis-Date.now()>0}function Au(r){return{token:sw(iw),error:r}}var Pu=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=tt(this.app);for(let t of e)qf(this.app,t.next);return Promise.resolve()}};function lw(r,e){return new Pu(r,e)}function hw(r){return{getToken:e=>Ru(r,e),getLimitedUseToken:()=>ow(r),addTokenListener:e=>aw(r,"INTERNAL",e),removeTokenListener:e=>qf(r.app,e)}}var dw="@firebase/app-check",fw="0.10.1";var mw="app-check",xf="app-check-internal";function gw(){Si(new En(mw,r=>{let e=r.getProvider("app").getImmediate(),t=r.getProvider("heartbeat");return lw(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((r,e,t)=>{r.getProvider(xf).initialize()})),Si(new En(xf,r=>{let e=r.getProvider("app-check").getImmediate();return hw(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),jt(dw,fw)}gw();var pw="app-check";var or=class{constructor(){return Sf(pw)}};var yw=["localhost","0.0.0.0","127.0.0.1"],NE=typeof window<"u"&&yw.includes(window.location.hostname);var Cu=new Me("angularfire2.auth.use-emulator"),Du=new Me("angularfire2.auth.settings"),Vu=new Me("angularfire2.auth.tenant-id"),xu=new Me("angularfire2.auth.langugage-code"),ku=new Me("angularfire2.auth.use-device-language"),Nu=new Me("angularfire.auth.persistence"),Ou=(r,e,t,n,i,s,a,u)=>no(`${r.name}.auth`,"AngularFireAuth",r.name,()=>{let c=e.runOutsideAngular(()=>r.auth());if(t&&c.useEmulator(...t),n&&(c.tenantId=n),c.languageCode=i,s&&c.useDeviceLanguage(),a)for(let[h,f]of Object.entries(a))c.settings[h]=f;return u&&c.setPersistence(u),c},[t,n,i,s,a,u]),Fu=(()=>{class r{injector=et(Tn);authState;idToken;user;idTokenResult;credential;constructor(t,n,i,s,a,u,c,h,f,g,y,A){let x=new uf,k=Ut(void 0).pipe(Ei(a.outsideAngular),vn(()=>s.runOutsideAngular(()=>import("./chunk-2OX3B2SI.js"))),Fe(()=>Pi(t,s,n)),Fe(V=>Ou(V,s,u,h,f,g,c,y)),fu({bufferSize:1,refCount:!1}));if(Xs(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Ut(null);else{k.pipe(df()).subscribe();let V=k.pipe(vn(M=>M.getRedirectResult().then($=>$,()=>null)),Be(this.injector),fu({bufferSize:1,refCount:!1})),z=k.pipe(vn(M=>new Lt($=>({unsubscribe:s.runOutsideAngular(()=>M.onAuthStateChanged(K=>$.next(K),K=>$.error(K),()=>$.complete()))})))),B=k.pipe(vn(M=>new Lt($=>({unsubscribe:s.runOutsideAngular(()=>M.onIdTokenChanged(K=>$.next(K),K=>$.error(K),()=>$.complete()))}))));this.authState=V.pipe(mu(z),Ks(a.outsideAngular),Ei(a.insideAngular)),this.user=V.pipe(mu(B),Ks(a.outsideAngular),Ei(a.insideAngular)),this.idToken=this.user.pipe(vn(M=>M?qt(M.getIdToken()):Ut(null))),this.idTokenResult=this.user.pipe(vn(M=>M?qt(M.getIdTokenResult()):Ut(null))),this.credential=lf(V,x,this.authState.pipe(Ii(M=>!M))).pipe(Fe(M=>M?.user?M:null),Ks(a.outsideAngular),Ei(a.insideAngular))}return Cf(this,k,s,{spy:{apply:(V,z,B)=>{(V.startsWith("signIn")||V.startsWith("createUser"))&&B.then(M=>x.next(M))}}})}static \u0275fac=function(n){return new(n||r)(Y(ir),Y(sr,8),Y(nr),Y(at),Y(Ri),Y(Cu,8),Y(Du,8),Y(Vu,8),Y(xu,8),Y(ku,8),Y(Nu,8),Y(or,8))};static \u0275prov=er({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),XE=(()=>{class r{constructor(){Le.registerVersion("angularfire",Bt.full,"auth-compat")}static \u0275fac=function(n){return new(n||r)};static \u0275mod=rr({type:r});static \u0275inj=tr({providers:[Fu]})}return r})();var jf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Bf={};var Et,Mu;(function(){var r;function e(v,p){function w(){}w.prototype=p.prototype,v.D=p.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(T,E,b){for(var _=Array(arguments.length-2),wt=2;wt<arguments.length;wt++)_[wt-2]=arguments[wt];return p.prototype[E].apply(T,_)}}function t(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(n,t),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,p,w){w||(w=0);var T=Array(16);if(typeof p=="string")for(var E=0;16>E;++E)T[E]=p.charCodeAt(w++)|p.charCodeAt(w++)<<8|p.charCodeAt(w++)<<16|p.charCodeAt(w++)<<24;else for(E=0;16>E;++E)T[E]=p[w++]|p[w++]<<8|p[w++]<<16|p[w++]<<24;p=v.g[0],w=v.g[1],E=v.g[2];var b=v.g[3],_=p+(b^w&(E^b))+T[0]+3614090360&4294967295;p=w+(_<<7&4294967295|_>>>25),_=b+(E^p&(w^E))+T[1]+3905402710&4294967295,b=p+(_<<12&4294967295|_>>>20),_=E+(w^b&(p^w))+T[2]+606105819&4294967295,E=b+(_<<17&4294967295|_>>>15),_=w+(p^E&(b^p))+T[3]+3250441966&4294967295,w=E+(_<<22&4294967295|_>>>10),_=p+(b^w&(E^b))+T[4]+4118548399&4294967295,p=w+(_<<7&4294967295|_>>>25),_=b+(E^p&(w^E))+T[5]+1200080426&4294967295,b=p+(_<<12&4294967295|_>>>20),_=E+(w^b&(p^w))+T[6]+2821735955&4294967295,E=b+(_<<17&4294967295|_>>>15),_=w+(p^E&(b^p))+T[7]+4249261313&4294967295,w=E+(_<<22&4294967295|_>>>10),_=p+(b^w&(E^b))+T[8]+1770035416&4294967295,p=w+(_<<7&4294967295|_>>>25),_=b+(E^p&(w^E))+T[9]+2336552879&4294967295,b=p+(_<<12&4294967295|_>>>20),_=E+(w^b&(p^w))+T[10]+4294925233&4294967295,E=b+(_<<17&4294967295|_>>>15),_=w+(p^E&(b^p))+T[11]+2304563134&4294967295,w=E+(_<<22&4294967295|_>>>10),_=p+(b^w&(E^b))+T[12]+1804603682&4294967295,p=w+(_<<7&4294967295|_>>>25),_=b+(E^p&(w^E))+T[13]+4254626195&4294967295,b=p+(_<<12&4294967295|_>>>20),_=E+(w^b&(p^w))+T[14]+2792965006&4294967295,E=b+(_<<17&4294967295|_>>>15),_=w+(p^E&(b^p))+T[15]+1236535329&4294967295,w=E+(_<<22&4294967295|_>>>10),_=p+(E^b&(w^E))+T[1]+4129170786&4294967295,p=w+(_<<5&4294967295|_>>>27),_=b+(w^E&(p^w))+T[6]+3225465664&4294967295,b=p+(_<<9&4294967295|_>>>23),_=E+(p^w&(b^p))+T[11]+643717713&4294967295,E=b+(_<<14&4294967295|_>>>18),_=w+(b^p&(E^b))+T[0]+3921069994&4294967295,w=E+(_<<20&4294967295|_>>>12),_=p+(E^b&(w^E))+T[5]+3593408605&4294967295,p=w+(_<<5&4294967295|_>>>27),_=b+(w^E&(p^w))+T[10]+38016083&4294967295,b=p+(_<<9&4294967295|_>>>23),_=E+(p^w&(b^p))+T[15]+3634488961&4294967295,E=b+(_<<14&4294967295|_>>>18),_=w+(b^p&(E^b))+T[4]+3889429448&4294967295,w=E+(_<<20&4294967295|_>>>12),_=p+(E^b&(w^E))+T[9]+568446438&4294967295,p=w+(_<<5&4294967295|_>>>27),_=b+(w^E&(p^w))+T[14]+3275163606&4294967295,b=p+(_<<9&4294967295|_>>>23),_=E+(p^w&(b^p))+T[3]+4107603335&4294967295,E=b+(_<<14&4294967295|_>>>18),_=w+(b^p&(E^b))+T[8]+1163531501&4294967295,w=E+(_<<20&4294967295|_>>>12),_=p+(E^b&(w^E))+T[13]+2850285829&4294967295,p=w+(_<<5&4294967295|_>>>27),_=b+(w^E&(p^w))+T[2]+4243563512&4294967295,b=p+(_<<9&4294967295|_>>>23),_=E+(p^w&(b^p))+T[7]+1735328473&4294967295,E=b+(_<<14&4294967295|_>>>18),_=w+(b^p&(E^b))+T[12]+2368359562&4294967295,w=E+(_<<20&4294967295|_>>>12),_=p+(w^E^b)+T[5]+4294588738&4294967295,p=w+(_<<4&4294967295|_>>>28),_=b+(p^w^E)+T[8]+2272392833&4294967295,b=p+(_<<11&4294967295|_>>>21),_=E+(b^p^w)+T[11]+1839030562&4294967295,E=b+(_<<16&4294967295|_>>>16),_=w+(E^b^p)+T[14]+4259657740&4294967295,w=E+(_<<23&4294967295|_>>>9),_=p+(w^E^b)+T[1]+2763975236&4294967295,p=w+(_<<4&4294967295|_>>>28),_=b+(p^w^E)+T[4]+1272893353&4294967295,b=p+(_<<11&4294967295|_>>>21),_=E+(b^p^w)+T[7]+4139469664&4294967295,E=b+(_<<16&4294967295|_>>>16),_=w+(E^b^p)+T[10]+3200236656&4294967295,w=E+(_<<23&4294967295|_>>>9),_=p+(w^E^b)+T[13]+681279174&4294967295,p=w+(_<<4&4294967295|_>>>28),_=b+(p^w^E)+T[0]+3936430074&4294967295,b=p+(_<<11&4294967295|_>>>21),_=E+(b^p^w)+T[3]+3572445317&4294967295,E=b+(_<<16&4294967295|_>>>16),_=w+(E^b^p)+T[6]+76029189&4294967295,w=E+(_<<23&4294967295|_>>>9),_=p+(w^E^b)+T[9]+3654602809&4294967295,p=w+(_<<4&4294967295|_>>>28),_=b+(p^w^E)+T[12]+3873151461&4294967295,b=p+(_<<11&4294967295|_>>>21),_=E+(b^p^w)+T[15]+530742520&4294967295,E=b+(_<<16&4294967295|_>>>16),_=w+(E^b^p)+T[2]+3299628645&4294967295,w=E+(_<<23&4294967295|_>>>9),_=p+(E^(w|~b))+T[0]+4096336452&4294967295,p=w+(_<<6&4294967295|_>>>26),_=b+(w^(p|~E))+T[7]+1126891415&4294967295,b=p+(_<<10&4294967295|_>>>22),_=E+(p^(b|~w))+T[14]+2878612391&4294967295,E=b+(_<<15&4294967295|_>>>17),_=w+(b^(E|~p))+T[5]+4237533241&4294967295,w=E+(_<<21&4294967295|_>>>11),_=p+(E^(w|~b))+T[12]+1700485571&4294967295,p=w+(_<<6&4294967295|_>>>26),_=b+(w^(p|~E))+T[3]+2399980690&4294967295,b=p+(_<<10&4294967295|_>>>22),_=E+(p^(b|~w))+T[10]+4293915773&4294967295,E=b+(_<<15&4294967295|_>>>17),_=w+(b^(E|~p))+T[1]+2240044497&4294967295,w=E+(_<<21&4294967295|_>>>11),_=p+(E^(w|~b))+T[8]+1873313359&4294967295,p=w+(_<<6&4294967295|_>>>26),_=b+(w^(p|~E))+T[15]+4264355552&4294967295,b=p+(_<<10&4294967295|_>>>22),_=E+(p^(b|~w))+T[6]+2734768916&4294967295,E=b+(_<<15&4294967295|_>>>17),_=w+(b^(E|~p))+T[13]+1309151649&4294967295,w=E+(_<<21&4294967295|_>>>11),_=p+(E^(w|~b))+T[4]+4149444226&4294967295,p=w+(_<<6&4294967295|_>>>26),_=b+(w^(p|~E))+T[11]+3174756917&4294967295,b=p+(_<<10&4294967295|_>>>22),_=E+(p^(b|~w))+T[2]+718787259&4294967295,E=b+(_<<15&4294967295|_>>>17),_=w+(b^(E|~p))+T[9]+3951481745&4294967295,v.g[0]=v.g[0]+p&4294967295,v.g[1]=v.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,v.g[2]=v.g[2]+E&4294967295,v.g[3]=v.g[3]+b&4294967295}n.prototype.u=function(v,p){p===void 0&&(p=v.length);for(var w=p-this.blockSize,T=this.B,E=this.h,b=0;b<p;){if(E==0)for(;b<=w;)i(this,v,b),b+=this.blockSize;if(typeof v=="string"){for(;b<p;)if(T[E++]=v.charCodeAt(b++),E==this.blockSize){i(this,T),E=0;break}}else for(;b<p;)if(T[E++]=v[b++],E==this.blockSize){i(this,T),E=0;break}}this.h=E,this.o+=p},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var p=1;p<v.length-8;++p)v[p]=0;var w=8*this.o;for(p=v.length-8;p<v.length;++p)v[p]=w&255,w/=256;for(this.u(v),v=Array(16),p=w=0;4>p;++p)for(var T=0;32>T;T+=8)v[w++]=this.g[p]>>>T&255;return v};function s(v,p){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=p(v)}function a(v,p){this.h=p;for(var w=[],T=!0,E=v.length-1;0<=E;E--){var b=v[E]|0;T&&b==p||(w[E]=b,T=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(p){return new a([p|0],0>p?-1:0)}):new a([v|0],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return g;if(0>v)return V(h(-v));for(var p=[],w=1,T=0;v>=w;T++)p[T]=v/w|0,w*=4294967296;return new a(p,0)}function f(v,p){if(v.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(v.charAt(0)=="-")return V(f(v.substring(1),p));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(p,8)),T=g,E=0;E<v.length;E+=8){var b=Math.min(8,v.length-E),_=parseInt(v.substring(E,E+b),p);8>b?(b=h(Math.pow(p,b)),T=T.j(b).add(h(_))):(T=T.j(w),T=T.add(h(_)))}return T}var g=c(0),y=c(1),A=c(16777216);r=a.prototype,r.m=function(){if(k(this))return-V(this).m();for(var v=0,p=1,w=0;w<this.g.length;w++){var T=this.i(w);v+=(0<=T?T:4294967296+T)*p,p*=4294967296}return v},r.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(x(this))return"0";if(k(this))return"-"+V(this).toString(v);for(var p=h(Math.pow(v,6)),w=this,T="";;){var E=$(w,p).g;w=z(w,E.j(p));var b=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=E,x(w))return b+T;for(;6>b.length;)b="0"+b;T=b+T}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function x(v){if(v.h!=0)return!1;for(var p=0;p<v.g.length;p++)if(v.g[p]!=0)return!1;return!0}function k(v){return v.h==-1}r.l=function(v){return v=z(this,v),k(v)?-1:x(v)?0:1};function V(v){for(var p=v.g.length,w=[],T=0;T<p;T++)w[T]=~v.g[T];return new a(w,~v.h).add(y)}r.abs=function(){return k(this)?V(this):this},r.add=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0,E=0;E<=p;E++){var b=T+(this.i(E)&65535)+(v.i(E)&65535),_=(b>>>16)+(this.i(E)>>>16)+(v.i(E)>>>16);T=_>>>16,b&=65535,_&=65535,w[E]=_<<16|b}return new a(w,w[w.length-1]&-2147483648?-1:0)};function z(v,p){return v.add(V(p))}r.j=function(v){if(x(this)||x(v))return g;if(k(this))return k(v)?V(this).j(V(v)):V(V(this).j(v));if(k(v))return V(this.j(V(v)));if(0>this.l(A)&&0>v.l(A))return h(this.m()*v.m());for(var p=this.g.length+v.g.length,w=[],T=0;T<2*p;T++)w[T]=0;for(T=0;T<this.g.length;T++)for(var E=0;E<v.g.length;E++){var b=this.i(T)>>>16,_=this.i(T)&65535,wt=v.i(E)>>>16,ni=v.i(E)&65535;w[2*T+2*E]+=_*ni,B(w,2*T+2*E),w[2*T+2*E+1]+=b*ni,B(w,2*T+2*E+1),w[2*T+2*E+1]+=_*wt,B(w,2*T+2*E+1),w[2*T+2*E+2]+=b*wt,B(w,2*T+2*E+2)}for(T=0;T<p;T++)w[T]=w[2*T+1]<<16|w[2*T];for(T=p;T<2*p;T++)w[T]=0;return new a(w,0)};function B(v,p){for(;(v[p]&65535)!=v[p];)v[p+1]+=v[p]>>>16,v[p]&=65535,p++}function M(v,p){this.g=v,this.h=p}function $(v,p){if(x(p))throw Error("division by zero");if(x(v))return new M(g,g);if(k(v))return p=$(V(v),p),new M(V(p.g),V(p.h));if(k(p))return p=$(v,V(p)),new M(V(p.g),p.h);if(30<v.g.length){if(k(v)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var w=y,T=p;0>=T.l(v);)w=K(w),T=K(T);var E=W(w,1),b=W(T,1);for(T=W(T,2),w=W(w,2);!x(T);){var _=b.add(T);0>=_.l(v)&&(E=E.add(w),b=_),T=W(T,1),w=W(w,1)}return p=z(v,E.j(p)),new M(E,p)}for(E=g;0<=v.l(p);){for(w=Math.max(1,Math.floor(v.m()/p.m())),T=Math.ceil(Math.log(w)/Math.LN2),T=48>=T?1:Math.pow(2,T-48),b=h(w),_=b.j(p);k(_)||0<_.l(v);)w-=T,b=h(w),_=b.j(p);x(b)&&(b=y),E=E.add(b),v=z(v,_)}return new M(E,v)}r.A=function(v){return $(this,v).h},r.and=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)&v.i(T);return new a(w,this.h&v.h)},r.or=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)|v.i(T);return new a(w,this.h|v.h)},r.xor=function(v){for(var p=Math.max(this.g.length,v.g.length),w=[],T=0;T<p;T++)w[T]=this.i(T)^v.i(T);return new a(w,this.h^v.h)};function K(v){for(var p=v.g.length+1,w=[],T=0;T<p;T++)w[T]=v.i(T)<<1|v.i(T-1)>>>31;return new a(w,v.h)}function W(v,p){var w=p>>5;p%=32;for(var T=v.g.length-w,E=[],b=0;b<T;b++)E[b]=0<p?v.i(b+w)>>>p|v.i(b+w+1)<<32-p:v.i(b+w);return new a(E,v.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Mu=Bf.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=f,Et=Bf.Integer=a}).apply(typeof jf<"u"?jf:typeof self<"u"?self:typeof window<"u"?window:{});var io=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},It={};var Lu,ww,ar,qu,Vi,so,Uu,ju,Bu;(function(){var r,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o};function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof io=="object"&&io];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var n=t(this);function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var I=o[m];if(!(I in d))break e;d=d[I]}o=o[o.length-1],m=d[o],l=l(m),l!=m&&l!=null&&e(d,o,{configurable:!0,writable:!0,value:l})}}function s(o,l){o instanceof String&&(o+="");var d=0,m=!1,I={next:function(){if(!m&&d<o.length){var P=d++;return{value:l(P,o[P]),done:!1}}return m=!0,{done:!0,value:void 0}}};return I[Symbol.iterator]=function(){return I},I}i("Array.prototype.values",function(o){return o||function(){return s(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return l=l!="object"?l:o?Array.isArray(o)?"array":l:"null",l=="array"||l=="object"&&typeof o.length=="number"}function h(o){var l=typeof o;return l=="object"&&o!=null||l=="function"}function f(o,l,d){return o.call.apply(o.bind,arguments)}function g(o,l,d){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var I=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(I,m),o.apply(l,I)}}return function(){return o.apply(l,arguments)}}function y(o,l,d){return y=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,y.apply(null,arguments)}function A(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var m=d.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function x(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(m,I,P){for(var O=Array(arguments.length-2),ie=2;ie<arguments.length;ie++)O[ie-2]=arguments[ie];return l.prototype[I].apply(m,O)}}function k(o){let l=o.length;if(0<l){let d=Array(l);for(let m=0;m<l;m++)d[m]=o[m];return d}return[]}function V(o,l){for(let d=1;d<arguments.length;d++){let m=arguments[d];if(c(m)){let I=o.length||0,P=m.length||0;o.length=I+P;for(let O=0;O<P;O++)o[I+O]=m[O]}else o.push(m)}}class z{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function B(o){return/^[\s\xa0]*$/.test(o)}function M(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function $(o){return $[" "](o),o}$[" "]=function(){};var K=M().indexOf("Gecko")!=-1&&!(M().toLowerCase().indexOf("webkit")!=-1&&M().indexOf("Edge")==-1)&&!(M().indexOf("Trident")!=-1||M().indexOf("MSIE")!=-1)&&M().indexOf("Edge")==-1;function W(o,l,d){for(let m in o)l.call(d,o[m],m,o)}function v(o,l){for(let d in o)l.call(void 0,o[d],d,o)}function p(o){let l={};for(let d in o)l[d]=o[d];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function T(o,l){let d,m;for(let I=1;I<arguments.length;I++){m=arguments[I];for(d in m)o[d]=m[d];for(let P=0;P<w.length;P++)d=w[P],Object.prototype.hasOwnProperty.call(m,d)&&(o[d]=m[d])}}function E(o){var l=1;o=o.split(":");let d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function b(o){u.setTimeout(()=>{throw o},0)}function _(){var o=ja;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}class wt{constructor(){this.h=this.g=null}add(l,d){let m=ni.get();m.set(l,d),this.h?this.h.next=m:this.g=m,this.h=m}}var ni=new z(()=>new e_,o=>o.reset());class e_{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let ri,ii=!1,ja=new wt,od=()=>{let o=u.Promise.resolve(void 0);ri=()=>{o.then(t_)}};var t_=()=>{for(var o;o=_();){try{o.h.call(o.g)}catch(d){b(d)}var l=ni;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}ii=!1};function Nt(){this.s=this.s,this.C=this.C}Nt.prototype.s=!1,Nt.prototype.ma=function(){this.s||(this.s=!0,this.N())},Nt.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Re(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}Re.prototype.h=function(){this.defaultPrevented=!0};var n_=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function si(o,l){if(Re.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(K){e:{try{$(l.nodeName);var I=!0;break e}catch{}I=!1}I||(l=null)}}else d=="mouseover"?l=o.fromElement:d=="mouseout"&&(l=o.toElement);this.relatedTarget=l,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:r_[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&si.aa.h.call(this)}}x(si,Re);var r_={2:"touch",3:"pen",4:"mouse"};si.prototype.h=function(){si.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var oi="closure_listenable_"+(1e6*Math.random()|0),i_=0;function s_(o,l,d,m,I){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!m,this.ha=I,this.key=++i_,this.da=this.fa=!1}function Rs(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ps(o){this.src=o,this.g={},this.h=0}Ps.prototype.add=function(o,l,d,m,I){var P=o.toString();o=this.g[P],o||(o=this.g[P]=[],this.h++);var O=za(o,l,m,I);return-1<O?(l=o[O],d||(l.fa=!1)):(l=new s_(l,this.src,P,!!m,I),l.fa=d,o.push(l)),l};function Ba(o,l){var d=l.type;if(d in o.g){var m=o.g[d],I=Array.prototype.indexOf.call(m,l,void 0),P;(P=0<=I)&&Array.prototype.splice.call(m,I,1),P&&(Rs(l),o.g[d].length==0&&(delete o.g[d],o.h--))}}function za(o,l,d,m){for(var I=0;I<o.length;++I){var P=o[I];if(!P.da&&P.listener==l&&P.capture==!!d&&P.ha==m)return I}return-1}var $a="closure_lm_"+(1e6*Math.random()|0),Ga={};function ad(o,l,d,m,I){if(m&&m.once)return cd(o,l,d,m,I);if(Array.isArray(l)){for(var P=0;P<l.length;P++)ad(o,l[P],d,m,I);return null}return d=Ha(d),o&&o[oi]?o.K(l,d,h(m)?!!m.capture:!!m,I):ud(o,l,d,!1,m,I)}function ud(o,l,d,m,I,P){if(!l)throw Error("Invalid event type");var O=h(I)?!!I.capture:!!I,ie=Wa(o);if(ie||(o[$a]=ie=new Ps(o)),d=ie.add(l,d,m,O,P),d.proxy)return d;if(m=o_(),d.proxy=m,m.src=o,m.listener=d,o.addEventListener)n_||(I=O),I===void 0&&(I=!1),o.addEventListener(l.toString(),m,I);else if(o.attachEvent)o.attachEvent(hd(l.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return d}function o_(){function o(d){return l.call(o.src,o.listener,d)}let l=a_;return o}function cd(o,l,d,m,I){if(Array.isArray(l)){for(var P=0;P<l.length;P++)cd(o,l[P],d,m,I);return null}return d=Ha(d),o&&o[oi]?o.L(l,d,h(m)?!!m.capture:!!m,I):ud(o,l,d,!0,m,I)}function ld(o,l,d,m,I){if(Array.isArray(l))for(var P=0;P<l.length;P++)ld(o,l[P],d,m,I);else m=h(m)?!!m.capture:!!m,d=Ha(d),o&&o[oi]?(o=o.i,l=String(l).toString(),l in o.g&&(P=o.g[l],d=za(P,d,m,I),-1<d&&(Rs(P[d]),Array.prototype.splice.call(P,d,1),P.length==0&&(delete o.g[l],o.h--)))):o&&(o=Wa(o))&&(l=o.g[l.toString()],o=-1,l&&(o=za(l,d,m,I)),(d=-1<o?l[o]:null)&&Ka(d))}function Ka(o){if(typeof o!="number"&&o&&!o.da){var l=o.src;if(l&&l[oi])Ba(l.i,o);else{var d=o.type,m=o.proxy;l.removeEventListener?l.removeEventListener(d,m,o.capture):l.detachEvent?l.detachEvent(hd(d),m):l.addListener&&l.removeListener&&l.removeListener(m),(d=Wa(l))?(Ba(d,o),d.h==0&&(d.src=null,l[$a]=null)):Rs(o)}}}function hd(o){return o in Ga?Ga[o]:Ga[o]="on"+o}function a_(o,l){if(o.da)o=!0;else{l=new si(l,this);var d=o.listener,m=o.ha||o.src;o.fa&&Ka(o),o=d.call(m,l)}return o}function Wa(o){return o=o[$a],o instanceof Ps?o:null}var Qa="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ha(o){return typeof o=="function"?o:(o[Qa]||(o[Qa]=function(l){return o.handleEvent(l)}),o[Qa])}function Pe(){Nt.call(this),this.i=new Ps(this),this.M=this,this.F=null}x(Pe,Nt),Pe.prototype[oi]=!0,Pe.prototype.removeEventListener=function(o,l,d,m){ld(this,o,l,d,m)};function Ne(o,l){var d,m=o.F;if(m)for(d=[];m;m=m.F)d.push(m);if(o=o.M,m=l.type||l,typeof l=="string")l=new Re(l,o);else if(l instanceof Re)l.target=l.target||o;else{var I=l;l=new Re(m,o),T(l,I)}if(I=!0,d)for(var P=d.length-1;0<=P;P--){var O=l.g=d[P];I=Cs(O,m,!0,l)&&I}if(O=l.g=o,I=Cs(O,m,!0,l)&&I,I=Cs(O,m,!1,l)&&I,d)for(P=0;P<d.length;P++)O=l.g=d[P],I=Cs(O,m,!1,l)&&I}Pe.prototype.N=function(){if(Pe.aa.N.call(this),this.i){var o=this.i,l;for(l in o.g){for(var d=o.g[l],m=0;m<d.length;m++)Rs(d[m]);delete o.g[l],o.h--}}this.F=null},Pe.prototype.K=function(o,l,d,m){return this.i.add(String(o),l,!1,d,m)},Pe.prototype.L=function(o,l,d,m){return this.i.add(String(o),l,!0,d,m)};function Cs(o,l,d,m){if(l=o.i.g[String(l)],!l)return!0;l=l.concat();for(var I=!0,P=0;P<l.length;++P){var O=l[P];if(O&&!O.da&&O.capture==d){var ie=O.listener,Ae=O.ha||O.src;O.fa&&Ba(o.i,O),I=ie.call(Ae,m)!==!1&&I}}return I&&!m.defaultPrevented}function dd(o,l,d){if(typeof o=="function")d&&(o=y(o,d));else if(o&&typeof o.handleEvent=="function")o=y(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function fd(o){o.g=dd(()=>{o.g=null,o.i&&(o.i=!1,fd(o))},o.l);let l=o.h;o.h=null,o.m.apply(null,l)}class u_ extends Nt{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:fd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ai(o){Nt.call(this),this.h=o,this.g={}}x(ai,Nt);var md=[];function gd(o){W(o.g,function(l,d){this.g.hasOwnProperty(d)&&Ka(l)},o),o.g={}}ai.prototype.N=function(){ai.aa.N.call(this),gd(this)},ai.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Xa=u.JSON.stringify,c_=u.JSON.parse,l_=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Ja(){}Ja.prototype.h=null;function pd(o){return o.h||(o.h=o.i())}function yd(){}var ui={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ya(){Re.call(this,"d")}x(Ya,Re);function Za(){Re.call(this,"c")}x(Za,Re);var pn={},_d=null;function Ds(){return _d=_d||new Pe}pn.La="serverreachability";function wd(o){Re.call(this,pn.La,o)}x(wd,Re);function ci(o){let l=Ds();Ne(l,new wd(l))}pn.STAT_EVENT="statevent";function vd(o,l){Re.call(this,pn.STAT_EVENT,o),this.stat=l}x(vd,Re);function Oe(o){let l=Ds();Ne(l,new vd(l,o))}pn.Ma="timingevent";function Td(o,l){Re.call(this,pn.Ma,o),this.size=l}x(Td,Re);function li(o,l){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function hi(){this.g=!0}hi.prototype.xa=function(){this.g=!1};function h_(o,l,d,m,I,P){o.info(function(){if(o.g)if(P)for(var O="",ie=P.split("&"),Ae=0;Ae<ie.length;Ae++){var ee=ie[Ae].split("=");if(1<ee.length){var Ce=ee[0];ee=ee[1];var De=Ce.split("_");O=2<=De.length&&De[1]=="type"?O+(Ce+"="+ee+"&"):O+(Ce+"=redacted&")}}else O=null;else O=P;return"XMLHTTP REQ ("+m+") [attempt "+I+"]: "+l+`
`+d+`
`+O})}function d_(o,l,d,m,I,P,O){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+I+"]: "+l+`
`+d+`
`+P+" "+O})}function Xn(o,l,d,m){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+m_(o,d)+(m?" "+m:"")})}function f_(o,l){o.info(function(){return"TIMEOUT: "+l})}hi.prototype.info=function(){};function m_(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var m=d[o];if(!(2>m.length)){var I=m[1];if(Array.isArray(I)&&!(1>I.length)){var P=I[0];if(P!="noop"&&P!="stop"&&P!="close")for(var O=1;O<I.length;O++)I[O]=""}}}}return Xa(d)}catch{return l}}var Vs={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ed={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},eu;function xs(){}x(xs,Ja),xs.prototype.g=function(){return new XMLHttpRequest},xs.prototype.i=function(){return{}},eu=new xs;function Ot(o,l,d,m){this.j=o,this.i=l,this.l=d,this.R=m||1,this.U=new ai(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Id}function Id(){this.i=null,this.g="",this.h=!1}var Ad={},tu={};function nu(o,l,d){o.L=1,o.v=Fs(vt(l)),o.m=d,o.P=!0,bd(o,null)}function bd(o,l){o.F=Date.now(),ks(o),o.A=vt(o.v);var d=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),qd(d.i,"t",m),o.C=0,d=o.j.J,o.h=new Id,o.g=rf(o.j,d?l:null,!o.m),0<o.O&&(o.M=new u_(y(o.Y,o,o.g),o.O)),l=o.U,d=o.g,m=o.ca;var I="readystatechange";Array.isArray(I)||(I&&(md[0]=I.toString()),I=md);for(var P=0;P<I.length;P++){var O=ad(d,I[P],m||l.handleEvent,!1,l.h||l);if(!O)break;l.g[O.key]=O}l=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),ci(),h_(o.i,o.u,o.A,o.l,o.R,o.m)}Ot.prototype.ca=function(o){o=o.target;let l=this.M;l&&Tt(o)==3?l.j():this.Y(o)},Ot.prototype.Y=function(o){try{if(o==this.g)e:{let De=Tt(this.g);var l=this.g.Ba();let Zn=this.g.Z();if(!(3>De)&&(De!=3||this.g&&(this.h.h||this.g.oa()||Kd(this.g)))){this.J||De!=4||l==7||(l==8||0>=Zn?ci(3):ci(2)),ru(this);var d=this.g.Z();this.X=d;t:if(Sd(this)){var m=Kd(this.g);o="";var I=m.length,P=Tt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){yn(this),di(this);var O="";break t}this.h.i=new u.TextDecoder}for(l=0;l<I;l++)this.h.h=!0,o+=this.h.i.decode(m[l],{stream:!(P&&l==I-1)});m.length=0,this.h.g+=o,this.C=0,O=this.h.g}else O=this.g.oa();if(this.o=d==200,d_(this.i,this.u,this.A,this.l,this.R,De,d),this.o){if(this.T&&!this.K){t:{if(this.g){var ie,Ae=this.g;if((ie=Ae.g?Ae.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!B(ie)){var ee=ie;break t}}ee=null}if(d=ee)Xn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,iu(this,d);else{this.o=!1,this.s=3,Oe(12),yn(this),di(this);break e}}if(this.P){d=!0;let Ze;for(;!this.J&&this.C<O.length;)if(Ze=g_(this,O),Ze==tu){De==4&&(this.s=4,Oe(14),d=!1),Xn(this.i,this.l,null,"[Incomplete Response]");break}else if(Ze==Ad){this.s=4,Oe(15),Xn(this.i,this.l,O,"[Invalid Chunk]"),d=!1;break}else Xn(this.i,this.l,Ze,null),iu(this,Ze);if(Sd(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),De!=4||O.length!=0||this.h.h||(this.s=1,Oe(16),d=!1),this.o=this.o&&d,!d)Xn(this.i,this.l,O,"[Invalid Chunked Response]"),yn(this),di(this);else if(0<O.length&&!this.W){this.W=!0;var Ce=this.j;Ce.g==this&&Ce.ba&&!Ce.M&&(Ce.j.info("Great, no buffering proxy detected. Bytes received: "+O.length),lu(Ce),Ce.M=!0,Oe(11))}}else Xn(this.i,this.l,O,null),iu(this,O);De==4&&yn(this),this.o&&!this.J&&(De==4?Zd(this.j,this):(this.o=!1,ks(this)))}else x_(this.g),d==400&&0<O.indexOf("Unknown SID")?(this.s=3,Oe(12)):(this.s=0,Oe(13)),yn(this),di(this)}}}catch{}finally{}};function Sd(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function g_(o,l){var d=o.C,m=l.indexOf(`
`,d);return m==-1?tu:(d=Number(l.substring(d,m)),isNaN(d)?Ad:(m+=1,m+d>l.length?tu:(l=l.slice(m,m+d),o.C=m+d,l)))}Ot.prototype.cancel=function(){this.J=!0,yn(this)};function ks(o){o.S=Date.now()+o.I,Rd(o,o.I)}function Rd(o,l){if(o.B!=null)throw Error("WatchDog timer not null");o.B=li(y(o.ba,o),l)}function ru(o){o.B&&(u.clearTimeout(o.B),o.B=null)}Ot.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(f_(this.i,this.A),this.L!=2&&(ci(),Oe(17)),yn(this),this.s=2,di(this)):Rd(this,this.S-o)};function di(o){o.j.G==0||o.J||Zd(o.j,o)}function yn(o){ru(o);var l=o.M;l&&typeof l.ma=="function"&&l.ma(),o.M=null,gd(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function iu(o,l){try{var d=o.j;if(d.G!=0&&(d.g==o||su(d.h,o))){if(!o.K&&su(d.h,o)&&d.G==3){try{var m=d.Da.g.parse(l)}catch{m=null}if(Array.isArray(m)&&m.length==3){var I=m;if(I[0]==0){e:if(!d.u){if(d.g)if(d.g.F+3e3<o.F)js(d),qs(d);else break e;cu(d),Oe(18)}}else d.za=I[1],0<d.za-d.T&&37500>I[2]&&d.F&&d.v==0&&!d.C&&(d.C=li(y(d.Za,d),6e3));if(1>=Dd(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else wn(d,11)}else if((o.K||d.g==o)&&js(d),!B(l))for(I=d.Da.g.parse(l),l=0;l<I.length;l++){let ee=I[l];if(d.T=ee[0],ee=ee[1],d.G==2)if(ee[0]=="c"){d.K=ee[1],d.ia=ee[2];let Ce=ee[3];Ce!=null&&(d.la=Ce,d.j.info("VER="+d.la));let De=ee[4];De!=null&&(d.Aa=De,d.j.info("SVER="+d.Aa));let Zn=ee[5];Zn!=null&&typeof Zn=="number"&&0<Zn&&(m=1.5*Zn,d.L=m,d.j.info("backChannelRequestTimeoutMs_="+m)),m=d;let Ze=o.g;if(Ze){let zs=Ze.g?Ze.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(zs){var P=m.h;P.g||zs.indexOf("spdy")==-1&&zs.indexOf("quic")==-1&&zs.indexOf("h2")==-1||(P.j=P.l,P.g=new Set,P.h&&(ou(P,P.h),P.h=null))}if(m.D){let hu=Ze.g?Ze.g.getResponseHeader("X-HTTP-Session-Id"):null;hu&&(m.ya=hu,oe(m.I,m.D,hu))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms")),m=d;var O=o;if(m.qa=nf(m,m.J?m.ia:null,m.W),O.K){Vd(m.h,O);var ie=O,Ae=m.L;Ae&&(ie.I=Ae),ie.B&&(ru(ie),ks(ie)),m.g=O}else Jd(m);0<d.i.length&&Us(d)}else ee[0]!="stop"&&ee[0]!="close"||wn(d,7);else d.G==3&&(ee[0]=="stop"||ee[0]=="close"?ee[0]=="stop"?wn(d,7):uu(d):ee[0]!="noop"&&d.l&&d.l.ta(ee),d.v=0)}}ci(4)}catch{}}var p_=class{constructor(o,l){this.g=o,this.map=l}};function Pd(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Cd(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Dd(o){return o.h?1:o.g?o.g.size:0}function su(o,l){return o.h?o.h==l:o.g?o.g.has(l):!1}function ou(o,l){o.g?o.g.add(l):o.h=l}function Vd(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}Pd.prototype.cancel=function(){if(this.i=xd(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function xd(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let l=o.i;for(let d of o.g.values())l=l.concat(d.D);return l}return k(o.i)}function y_(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(c(o)){for(var l=[],d=o.length,m=0;m<d;m++)l.push(o[m]);return l}l=[],d=0;for(m in o)l[d++]=o[m];return l}function __(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||typeof o=="string"){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(let m in o)l[d++]=m;return l}}}function kd(o,l){if(o.forEach&&typeof o.forEach=="function")o.forEach(l,void 0);else if(c(o)||typeof o=="string")Array.prototype.forEach.call(o,l,void 0);else for(var d=__(o),m=y_(o),I=m.length,P=0;P<I;P++)l.call(void 0,m[P],d&&d[P],o)}var Nd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function w_(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var m=o[d].indexOf("="),I=null;if(0<=m){var P=o[d].substring(0,m);I=o[d].substring(m+1)}else P=o[d];l(P,I?decodeURIComponent(I.replace(/\+/g," ")):"")}}}function _n(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof _n){this.h=o.h,Ns(this,o.j),this.o=o.o,this.g=o.g,Os(this,o.s),this.l=o.l;var l=o.i,d=new gi;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),Od(this,d),this.m=o.m}else o&&(l=String(o).match(Nd))?(this.h=!1,Ns(this,l[1]||"",!0),this.o=fi(l[2]||""),this.g=fi(l[3]||"",!0),Os(this,l[4]),this.l=fi(l[5]||"",!0),Od(this,l[6]||"",!0),this.m=fi(l[7]||"")):(this.h=!1,this.i=new gi(null,this.h))}_n.prototype.toString=function(){var o=[],l=this.j;l&&o.push(mi(l,Fd,!0),":");var d=this.g;return(d||l=="file")&&(o.push("//"),(l=this.o)&&o.push(mi(l,Fd,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&o.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&o.push("/"),o.push(mi(d,d.charAt(0)=="/"?E_:T_,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",mi(d,A_)),o.join("")};function vt(o){return new _n(o)}function Ns(o,l,d){o.j=d?fi(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function Os(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function Od(o,l,d){l instanceof gi?(o.i=l,b_(o.i,o.h)):(d||(l=mi(l,I_)),o.i=new gi(l,o.h))}function oe(o,l,d){o.i.set(l,d)}function Fs(o){return oe(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function fi(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function mi(o,l,d){return typeof o=="string"?(o=encodeURI(o).replace(l,v_),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function v_(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Fd=/[#\/\?@]/g,T_=/[#\?:]/g,E_=/[#\?]/g,I_=/[#\?@]/g,A_=/#/g;function gi(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function Ft(o){o.g||(o.g=new Map,o.h=0,o.i&&w_(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}r=gi.prototype,r.add=function(o,l){Ft(this),this.i=null,o=Jn(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this};function Md(o,l){Ft(o),l=Jn(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Ld(o,l){return Ft(o),l=Jn(o,l),o.g.has(l)}r.forEach=function(o,l){Ft(this),this.g.forEach(function(d,m){d.forEach(function(I){o.call(l,I,m,this)},this)},this)},r.na=function(){Ft(this);let o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let m=0;m<l.length;m++){let I=o[m];for(let P=0;P<I.length;P++)d.push(l[m])}return d},r.V=function(o){Ft(this);let l=[];if(typeof o=="string")Ld(this,o)&&(l=l.concat(this.g.get(Jn(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return Ft(this),this.i=null,o=Jn(this,o),Ld(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o?(o=this.V(o),0<o.length?String(o[0]):l):l};function qd(o,l,d){Md(o,l),0<d.length&&(o.i=null,o.g.set(Jn(o,l),k(d)),o.h+=d.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var m=l[d];let P=encodeURIComponent(String(m)),O=this.V(m);for(m=0;m<O.length;m++){var I=P;O[m]!==""&&(I+="="+encodeURIComponent(String(O[m]))),o.push(I)}}return this.i=o.join("&")};function Jn(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function b_(o,l){l&&!o.j&&(Ft(o),o.i=null,o.g.forEach(function(d,m){var I=m.toLowerCase();m!=I&&(Md(this,m),qd(this,I,d))},o)),o.j=l}function S_(o,l){let d=new hi;if(u.Image){let m=new Image;m.onload=A(Mt,d,"TestLoadImage: loaded",!0,l,m),m.onerror=A(Mt,d,"TestLoadImage: error",!1,l,m),m.onabort=A(Mt,d,"TestLoadImage: abort",!1,l,m),m.ontimeout=A(Mt,d,"TestLoadImage: timeout",!1,l,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else l(!1)}function R_(o,l){let d=new hi,m=new AbortController,I=setTimeout(()=>{m.abort(),Mt(d,"TestPingServer: timeout",!1,l)},1e4);fetch(o,{signal:m.signal}).then(P=>{clearTimeout(I),P.ok?Mt(d,"TestPingServer: ok",!0,l):Mt(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(I),Mt(d,"TestPingServer: error",!1,l)})}function Mt(o,l,d,m,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),m(d)}catch{}}function P_(){this.g=new l_}function C_(o,l,d){let m=d||"";try{kd(o,function(I,P){let O=I;h(I)&&(O=Xa(I)),l.push(m+P+"="+encodeURIComponent(O))})}catch(I){throw l.push(m+"type="+encodeURIComponent("_badmap")),I}}function pi(o){this.l=o.Ub||null,this.j=o.eb||!1}x(pi,Ja),pi.prototype.g=function(){return new Ms(this.l,this.j)},pi.prototype.i=function(o){return function(){return o}}({});function Ms(o,l){Pe.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}x(Ms,Pe),r=Ms.prototype,r.open=function(o,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,_i(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,yi(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,_i(this)),this.g&&(this.readyState=3,_i(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ud(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ud(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?yi(this):_i(this),this.readyState==3&&Ud(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,yi(this))},r.Qa=function(o){this.g&&(this.response=o,yi(this))},r.ga=function(){this.g&&yi(this)};function yi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,_i(o)}r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,o.push(d[0]+": "+d[1]),d=l.next();return o.join(`\r
`)};function _i(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Ms.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function jd(o){let l="";return W(o,function(d,m){l+=m,l+=":",l+=d,l+=`\r
`}),l}function au(o,l,d){e:{for(m in d){var m=!1;break e}m=!0}m||(d=jd(d),typeof o=="string"?d!=null&&encodeURIComponent(String(d)):oe(o,l,d))}function he(o){Pe.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}x(he,Pe);var D_=/^https?$/i,V_=["POST","PUT"];r=he.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,l,d,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():eu.g(),this.v=this.o?pd(this.o):pd(eu),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(P){Bd(this,P);return}if(o=d||"",d=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var I in m)d.set(I,m[I]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let P of m.keys())d.set(P,m.get(P));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(d.keys()).find(P=>P.toLowerCase()=="content-type"),I=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(V_,l,void 0))||m||I||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[P,O]of d)this.g.setRequestHeader(P,O);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Gd(this),this.u=!0,this.g.send(o),this.u=!1}catch(P){Bd(this,P)}};function Bd(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,zd(o),Ls(o)}function zd(o){o.A||(o.A=!0,Ne(o,"complete"),Ne(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Ne(this,"complete"),Ne(this,"abort"),Ls(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ls(this,!0)),he.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?$d(this):this.bb())},r.bb=function(){$d(this)};function $d(o){if(o.h&&typeof a<"u"&&(!o.v[1]||Tt(o)!=4||o.Z()!=2)){if(o.u&&Tt(o)==4)dd(o.Ea,0,o);else if(Ne(o,"readystatechange"),Tt(o)==4){o.h=!1;try{let O=o.Z();e:switch(O){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var m;if(m=O===0){var I=String(o.D).match(Nd)[1]||null;!I&&u.self&&u.self.location&&(I=u.self.location.protocol.slice(0,-1)),m=!D_.test(I?I.toLowerCase():"")}d=m}if(d)Ne(o,"complete"),Ne(o,"success");else{o.m=6;try{var P=2<Tt(o)?o.g.statusText:""}catch{P=""}o.l=P+" ["+o.Z()+"]",zd(o)}}finally{Ls(o)}}}}function Ls(o,l){if(o.g){Gd(o);let d=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Ne(o,"ready");try{d.onreadystatechange=m}catch{}}}function Gd(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function Tt(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<Tt(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&l.indexOf(o)==0&&(l=l.substring(o.length)),c_(l)}};function Kd(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function x_(o){let l={};o=(o.g&&2<=Tt(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(B(o[m]))continue;var d=E(o[m]);let I=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let P=l[I]||[];l[I]=P,P.push(d)}v(l,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function wi(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function Wd(o){this.Aa=0,this.i=[],this.j=new hi,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=wi("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=wi("baseRetryDelayMs",5e3,o),this.cb=wi("retryDelaySeedMs",1e4,o),this.Wa=wi("forwardChannelMaxRetries",2,o),this.wa=wi("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Pd(o&&o.concurrentRequestLimit),this.Da=new P_,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Wd.prototype,r.la=8,r.G=1,r.connect=function(o,l,d,m){Oe(0),this.W=o,this.H=l||{},d&&m!==void 0&&(this.H.OSID=d,this.H.OAID=m),this.F=this.X,this.I=nf(this,null,this.W),Us(this)};function uu(o){if(Qd(o),o.G==3){var l=o.U++,d=vt(o.I);if(oe(d,"SID",o.K),oe(d,"RID",l),oe(d,"TYPE","terminate"),vi(o,d),l=new Ot(o,o.j,l),l.L=2,l.v=Fs(vt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&(new Image().src=l.v,d=!0),d||(l.g=rf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),ks(l)}tf(o)}function qs(o){o.g&&(lu(o),o.g.cancel(),o.g=null)}function Qd(o){qs(o),o.u&&(u.clearTimeout(o.u),o.u=null),js(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function Us(o){if(!Cd(o.h)&&!o.s){o.s=!0;var l=o.Ga;ri||od(),ii||(ri(),ii=!0),ja.add(l,o),o.B=0}}function k_(o,l){return Dd(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=l.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=li(y(o.Ga,o,l),ef(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let I=new Ot(this,this.j,o),P=this.o;if(this.S&&(P?(P=p(P),T(P,this.S)):P=this.S),this.m!==null||this.O||(I.H=P,P=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){t:{var m=this.i[d];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break t}m=void 0}if(m===void 0)break;if(l+=m,4096<l){l=d;break e}if(l===4096||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=Xd(this,I,l),d=vt(this.I),oe(d,"RID",o),oe(d,"CVER",22),this.D&&oe(d,"X-HTTP-Session-Id",this.D),vi(this,d),P&&(this.O?l="headers="+encodeURIComponent(String(jd(P)))+"&"+l:this.m&&au(d,this.m,P)),ou(this.h,I),this.Ua&&oe(d,"TYPE","init"),this.P?(oe(d,"$req",l),oe(d,"SID","null"),I.T=!0,nu(I,d,null)):nu(I,d,l),this.G=2}}else this.G==3&&(o?Hd(this,o):this.i.length==0||Cd(this.h)||Hd(this))};function Hd(o,l){var d;l?d=l.l:d=o.U++;let m=vt(o.I);oe(m,"SID",o.K),oe(m,"RID",d),oe(m,"AID",o.T),vi(o,m),o.m&&o.o&&au(m,o.m,o.o),d=new Ot(o,o.j,d,o.B+1),o.m===null&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=Xd(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ou(o.h,d),nu(d,m,l)}function vi(o,l){o.H&&W(o.H,function(d,m){oe(l,m,d)}),o.l&&kd({},function(d,m){oe(l,m,d)})}function Xd(o,l,d){d=Math.min(o.i.length,d);var m=o.l?y(o.l.Na,o.l,o):null;e:{var I=o.i;let P=-1;for(;;){let O=["count="+d];P==-1?0<d?(P=I[0].g,O.push("ofs="+P)):P=0:O.push("ofs="+P);let ie=!0;for(let Ae=0;Ae<d;Ae++){let ee=I[Ae].g,Ce=I[Ae].map;if(ee-=P,0>ee)P=Math.max(0,I[Ae].g-100),ie=!1;else try{C_(Ce,O,"req"+ee+"_")}catch{m&&m(Ce)}}if(ie){m=O.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,m}function Jd(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;ri||od(),ii||(ri(),ii=!0),ja.add(l,o),o.v=0}}function cu(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=li(y(o.Fa,o),ef(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Yd(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=li(y(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Oe(10),qs(this),Yd(this))};function lu(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Yd(o){o.g=new Ot(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var l=vt(o.qa);oe(l,"RID","rpc"),oe(l,"SID",o.K),oe(l,"AID",o.T),oe(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&oe(l,"TO",o.ja),oe(l,"TYPE","xmlhttp"),vi(o,l),o.m&&o.o&&au(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Fs(vt(l)),d.m=null,d.P=!0,bd(d,o)}r.Za=function(){this.C!=null&&(this.C=null,qs(this),cu(this),Oe(19))};function js(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Zd(o,l){var d=null;if(o.g==l){js(o),lu(o),o.g=null;var m=2}else if(su(o.h,l))d=l.D,Vd(o.h,l),m=1;else return;if(o.G!=0){if(l.o)if(m==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var I=o.B;m=Ds(),Ne(m,new Td(m,d)),Us(o)}else Jd(o);else if(I=l.s,I==3||I==0&&0<l.X||!(m==1&&k_(o,l)||m==2&&cu(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),I){case 1:wn(o,5);break;case 4:wn(o,10);break;case 3:wn(o,6);break;default:wn(o,2)}}}function ef(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function wn(o,l){if(o.j.info("Error code "+l),l==2){var d=y(o.fb,o),m=o.Xa;let I=!m;m=new _n(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Ns(m,"https"),Fs(m),I?S_(m.toString(),d):R_(m.toString(),d)}else Oe(2);o.G=0,o.l&&o.l.sa(l),tf(o),Qd(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Oe(2)):(this.j.info("Failed to ping google.com"),Oe(1))};function tf(o){if(o.G=0,o.ka=[],o.l){let l=xd(o.h);(l.length!=0||o.i.length!=0)&&(V(o.ka,l),V(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function nf(o,l,d){var m=d instanceof _n?vt(d):new _n(d);if(m.g!="")l&&(m.g=l+"."+m.g),Os(m,m.s);else{var I=u.location;m=I.protocol,l=l?l+"."+I.hostname:I.hostname,I=+I.port;var P=new _n(null);m&&Ns(P,m),l&&(P.g=l),I&&Os(P,I),d&&(P.l=d),m=P}return d=o.D,l=o.ya,d&&l&&oe(m,d,l),oe(m,"VER",o.la),vi(o,m),m}function rf(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=o.Ca&&!o.pa?new he(new pi({eb:d})):new he(o.pa),l.Ha(o.J),l}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function sf(){}r=sf.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Bs(){}Bs.prototype.g=function(o,l){return new We(o,l)};function We(o,l){Pe.call(this),this.g=new Wd(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!B(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!B(l)&&(this.g.D=l,o=this.h,o!==null&&l in o&&(o=this.h,l in o&&delete o[l])),this.j=new Yn(this)}x(We,Pe),We.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},We.prototype.close=function(){uu(this.g)},We.prototype.o=function(o){var l=this.g;if(typeof o=="string"){var d={};d.__data__=o,o=d}else this.u&&(d={},d.__data__=Xa(o),o=d);l.i.push(new p_(l.Ya++,o)),l.G==3&&Us(l)},We.prototype.N=function(){this.g.l=null,delete this.j,uu(this.g),delete this.g,We.aa.N.call(this)};function of(o){Ya.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(let d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=l!==null&&o in l?l[o]:void 0),this.data=l}else this.data=o}x(of,Ya);function af(){Za.call(this),this.status=1}x(af,Za);function Yn(o){this.g=o}x(Yn,sf),Yn.prototype.ua=function(){Ne(this.g,"a")},Yn.prototype.ta=function(o){Ne(this.g,new of(o))},Yn.prototype.sa=function(o){Ne(this.g,new af)},Yn.prototype.ra=function(){Ne(this.g,"b")},Bs.prototype.createWebChannel=Bs.prototype.g,We.prototype.send=We.prototype.o,We.prototype.open=We.prototype.m,We.prototype.close=We.prototype.close,Bu=It.createWebChannelTransport=function(){return new Bs},ju=It.getStatEventTarget=function(){return Ds()},Uu=It.Event=pn,so=It.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Vs.NO_ERROR=0,Vs.TIMEOUT=8,Vs.HTTP_ERROR=6,Vi=It.ErrorCode=Vs,Ed.COMPLETE="complete",qu=It.EventType=Ed,yd.EventType=ui,ui.OPEN="a",ui.CLOSE="b",ui.ERROR="c",ui.MESSAGE="d",Pe.prototype.listen=Pe.prototype.K,ar=It.WebChannel=yd,ww=It.FetchXmlHttpFactory=pi,he.prototype.listenOnce=he.prototype.L,he.prototype.getLastError=he.prototype.Ka,he.prototype.getLastErrorCode=he.prototype.Ba,he.prototype.getStatus=he.prototype.Z,he.prototype.getResponseJson=he.prototype.Oa,he.prototype.getResponseText=he.prototype.oa,he.prototype.send=he.prototype.ea,he.prototype.setWithCredentials=he.prototype.Ha,Lu=It.XhrIo=he}).apply(typeof io<"u"?io:typeof self<"u"?self:typeof window<"u"?window:{});var zf="@firebase/firestore",$f="4.8.0";var we=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};we.UNAUTHENTICATED=new we(null),we.GOOGLE_CREDENTIALS=new we("google-credentials-uid"),we.FIRST_PARTY=new we("first-party-uid"),we.MOCK_USER=new we("mock-user");var Kr="11.10.0";var Zt=new Zs("@firebase/firestore");function mr(){return Zt.logLevel}function sg(r){Zt.setLogLevel(r)}function N(r,...e){if(Zt.logLevel<=ut.DEBUG){let t=e.map(nh);Zt.debug(`Firestore (${Kr}): ${r}`,...t)}}function fe(r,...e){if(Zt.logLevel<=ut.ERROR){let t=e.map(nh);Zt.error(`Firestore (${Kr}): ${r}`,...t)}}function Ke(r,...e){if(Zt.logLevel<=ut.WARN){let t=e.map(nh);Zt.warn(`Firestore (${Kr}): ${r}`,...t)}}function nh(r){if(typeof r=="string")return r;try{return function(t){return JSON.stringify(t)}(r)}catch{return r}}function q(r,e,t){let n="Unexpected state";typeof e=="string"?n=e:t=e,og(r,n,t)}function og(r,e,t){let n=`FIRESTORE (${Kr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${r.toString(16)})`;if(t!==void 0)try{n+=" CONTEXT: "+JSON.stringify(t)}catch{n+=" CONTEXT: "+t}throw fe(n),new Error(n)}function U(r,e,t,n){let i="Unexpected state";typeof t=="string"?i=t:n=t,r||og(e,i,n)}function ag(r,e){r||q(57014,e)}function L(r,e){return r}var R={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},D=class extends Tf{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ee=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var vo=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Xu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(we.UNAUTHENTICATED))}shutdown(){}},Ju=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Yu=class{constructor(e){this.t=e,this.currentUser=we.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){U(this.o===void 0,42304);let n=this.i,i=c=>this.i!==n?(n=this.i,t(c)):Promise.resolve(),s=new Ee;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ee,e.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let c=s;e.enqueueRetryable(()=>C(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ee)}},0),a()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U(typeof n.accessToken=="string",31837,{l:n}),new vo(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return U(e===null||typeof e=="string",2055,{h:e}),new we(e)}},Zu=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=we.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},ec=class{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new Zu(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(we.FIRST_PARTY))}shutdown(){}invalidateToken(){}},To=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},tc=class{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,If(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){U(this.o===void 0,3512);let n=s=>{s.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.m;return this.m=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};let i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new To(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(U(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new To(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}};function vw(r){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}function rh(){return new TextEncoder}var Ki=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516),n="";for(;n.length<20;){let i=vw(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+=e.charAt(i[s]%62))}return n}};function G(r,e){return r<e?-1:r>e?1:0}function nc(r,e){let t=0;for(;t<r.length&&t<e.length;){let n=r.codePointAt(t),i=e.codePointAt(t);if(n!==i){if(n<128&&i<128)return G(n,i);{let s=rh(),a=Tw(s.encode(Gf(r,t)),s.encode(Gf(e,t)));return a!==0?a:G(n,i)}}t+=n>65535?2:1}return G(r.length,e.length)}function Gf(r,e){return r.codePointAt(e)>65535?r.substring(e,e+2):r.substring(e,e+1)}function Tw(r,e){for(let t=0;t<r.length&&t<e.length;++t)if(r[t]!==e[t])return G(r[t],e[t]);return G(r.length,e.length)}function Ir(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function ug(r){return r+"\0"}var Kf="__name__",Eo=class r{constructor(e,t,n){t===void 0?t=0:t>e.length&&q(637,{offset:t,range:e.length}),n===void 0?n=e.length-t:n>e.length-t&&q(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return r.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof r?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let i=0;i<n;i++){let s=r.compareSegments(e.get(i),t.get(i));if(s!==0)return s}return G(e.length,t.length)}static compareSegments(e,t){let n=r.isNumericId(e),i=r.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?r.extractNumericId(e).compare(r.extractNumericId(t)):nc(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Et.fromString(e.substring(4,e.length-2))}},X=class r extends Eo{construct(e,t,n){return new r(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new r(t)}static emptyPath(){return new r([])}},Ew=/^[_a-zA-Z][_a-zA-Z0-9]*$/,me=class r extends Eo{construct(e,t,n){return new r(e,t,n)}static isValidIdentifier(e){return Ew.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Kf}static keyField(){return new r([Kf])}static fromServerFormat(e){let t=[],n="",i=0,s=()=>{if(n.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},a=!1;for(;i<e.length;){let u=e[i];if(u==="\\"){if(i+1===e.length)throw new D(R.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new D(R.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new D(R.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new r(t)}static emptyPath(){return new r([])}};var F=class r{constructor(e){this.path=e}static fromPath(e){return new r(X.fromString(e))}static fromName(e){return new r(X.fromString(e).popFirst(5))}static empty(){return new r(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&X.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new r(new X(e.slice()))}};function ih(r,e,t){if(!t)throw new D(R.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function sh(r,e,t,n){if(e===!0&&n===!0)throw new D(R.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Wf(r){if(!F.isDocumentKey(r))throw new D(R.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function Qf(r){if(F.isDocumentKey(r))throw new D(R.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function cg(r){return typeof r=="object"&&r!==null&&(Object.getPrototypeOf(r)===Object.prototype||Object.getPrototypeOf(r)===null)}function Ta(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let e=function(n){return n.constructor?n.constructor.name:null}(r);return e?`a custom ${e} object`:"an object"}}return typeof r=="function"?"a function":q(12329,{type:typeof r})}function Z(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new D(R.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Ta(r);throw new D(R.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function lg(r,e){if(e<=0)throw new D(R.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}function ve(r,e){let t={typeString:r};return e&&(t.value=e),t}function ys(r,e){if(!cg(r))throw new D(R.INVALID_ARGUMENT,"JSON must be an object");let t;for(let n in e)if(e[n]){let i=e[n].typeString,s="value"in e[n]?{value:e[n].value}:void 0;if(!(n in r)){t=`JSON missing required field: '${n}'`;break}let a=r[n];if(i&&typeof a!==i){t=`JSON field '${n}' must be a ${i}.`;break}if(s!==void 0&&a!==s.value){t=`Expected '${n}' field to equal '${s.value}'`;break}}if(t)throw new D(R.INVALID_ARGUMENT,t);return!0}var Hf=-62135596800,Xf=1e6,se=class r{static now(){return r.fromMillis(Date.now())}static fromDate(e){return r.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*Xf);return new r(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(R.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Hf)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(R.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Xf}_compareTo(e){return this.seconds===e.seconds?G(this.nanoseconds,e.nanoseconds):G(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:r._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ys(e,r._jsonSchema))return new r(e.seconds,e.nanoseconds)}valueOf(){let e=this.seconds-Hf;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};se._jsonSchemaVersion="firestore/timestamp/1.0",se._jsonSchema={type:ve("string",se._jsonSchemaVersion),seconds:ve("number"),nanoseconds:ve("number")};var j=class r{static fromTimestamp(e){return new r(e)}static min(){return new r(new se(0,0))}static max(){return new r(new se(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Ar=-1,br=class{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}};function rc(r){return r.fields.find(e=>e.kind===2)}function An(r){return r.fields.filter(e=>e.kind!==2)}br.UNKNOWN_ID=-1;var vr=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var Wi=class r{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new r(0,Ye.min())}};function hg(r,e){let t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=j.fromTimestamp(n===1e9?new se(t+1,0):new se(t,n));return new Ye(i,F.empty(),e)}function dg(r){return new Ye(r.readTime,r.key,Ar)}var Ye=class r{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new r(j.min(),F.empty(),Ar)}static max(){return new r(j.max(),F.empty(),Ar)}};function oh(r,e){let t=r.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(r.documentKey,e.documentKey),t!==0?t:G(r.largestBatchId,e.largestBatchId))}var fg="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Io=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function hn(r){return C(this,null,function*(){if(r.code!==R.FAILED_PRECONDITION||r.message!==fg)throw r;N("LocalStore","Unexpectedly lost primary lease")})}var S=class r{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&q(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof r?t:r.resolve(t)}catch(t){return r.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):r.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):r.reject(t)}static resolve(e){return new r((t,n)=>{t(e)})}static reject(e){return new r((t,n)=>{n(e)})}static waitFor(e){return new r((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=r.resolve(!1);for(let n of e)t=t.next(i=>i?r.resolve(i):n());return t}static forEach(e,t){let n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new r((n,i)=>{let s=e.length,a=new Array(s),u=0;for(let c=0;c<s;c++){let h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new r((n,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):n()};s()})}};var Qe="SimpleDb",Ao=class r{static open(e,t,n,i){try{return new r(t,e.transaction(i,n))}catch(s){throw new xn(t,s)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.S=new Ee,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{t.error?this.S.reject(new xn(e,t.error)):this.S.resolve()},this.transaction.onerror=n=>{let i=ah(n.target.error);this.S.reject(new xn(e,i))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(N(Qe,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new sc(t)}},en=class r{static delete(e){return N(Qe,"Removing database:",e),Sn(pu().indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Js())return!1;if(r.F())return!0;let e=bi(),t=r.M(e),n=0<t&&t<10,i=mg(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.O)==="YES"}static N(e,t){return e.store(t)}static M(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}constructor(e,t,n){this.name=e,this.version=t,this.B=n,this.L=null,r.M(bi())===12.2&&fe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(e){return C(this,null,function*(){return this.db||(N(Qe,"Opening database:",this.name),this.db=yield new Promise((t,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;t(a)},i.onblocked=()=>{n(new xn(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new D(R.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new D(R.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new xn(e,a))},i.onupgradeneeded=s=>{N(Qe,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${a.version}`);this.B.q(a,i.transaction,s.oldVersion,this.version).next(()=>{N(Qe,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",t=>{let n=t.target;this.L=n.version},{passive:!0})),this.db.addEventListener("versionchange",t=>{var n;t.newVersion===null&&(Ke('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(n=this.databaseDeletedListener)===null||n===void 0||n.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}runTransaction(e,t,n,i){return C(this,null,function*(){let s=t==="readonly",a=0;for(;;){++a;try{this.db=yield this.k(e);let u=Ao.open(this.db,e,s?"readonly":"readwrite",n),c=i(u).next(h=>(u.v(),h)).catch(h=>(u.abort(h),S.reject(h))).toPromise();return c.catch(()=>{}),yield u.D,c}catch(u){let c=u,h=c.name!=="FirebaseError"&&a<3;if(N(Qe,"Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function mg(r){let e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}var ic=class{constructor(e){this.$=e,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(e){this.$=e}done(){this.U=!0}G(e){this.K=e}delete(){return Sn(this.$.delete())}},xn=class extends D{constructor(e,t){super(R.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function dn(r){return r.name==="IndexedDbTransactionError"}var sc=class{constructor(e){this.store=e}put(e,t){let n;return t!==void 0?(N(Qe,"PUT",this.store.name,e,t),n=this.store.put(t,e)):(N(Qe,"PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Sn(n)}add(e){return N(Qe,"ADD",this.store.name,e,e),Sn(this.store.add(e))}get(e){return Sn(this.store.get(e)).next(t=>(t===void 0&&(t=null),N(Qe,"GET",this.store.name,e,t),t))}delete(e){return N(Qe,"DELETE",this.store.name,e),Sn(this.store.delete(e))}count(){return N(Qe,"COUNT",this.store.name),Sn(this.store.count())}j(e,t){let n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new S((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{let s=this.cursor(n),a=[];return this.J(s,(u,c)=>{a.push(c)}).next(()=>a)}}H(e,t){let n=this.store.getAll(e,t===null?void 0:t);return new S((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}Y(e,t){N(Qe,"DELETE ALL",this.store.name);let n=this.options(e,t);n.Z=!1;let i=this.cursor(n);return this.J(i,(s,a,u)=>u.delete())}X(e,t){let n;t?n=e:(n={},t=e);let i=this.cursor(n);return this.J(i,t)}ee(e){let t=this.cursor({});return new S((n,i)=>{t.onerror=s=>{let a=ah(s.target.error);i(a)},t.onsuccess=s=>{let a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}J(e,t){let n=[];return new S((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let c=new ic(u),h=t(u.primaryKey,u.value,c);if(h instanceof S){let f=h.catch(g=>(c.done(),S.reject(g)));n.push(f)}c.isDone?i():c.W===null?u.continue():u.continue(c.W)}}).next(()=>S.waitFor(n))}options(e,t){let n;return e!==void 0&&(typeof e=="string"?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let n=this.store.index(e.index);return e.Z?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function Sn(r){return new S((e,t)=>{r.onsuccess=n=>{let i=n.target.result;e(i)},r.onerror=n=>{let i=ah(n.target.error);t(i)}})}var Jf=!1;function ah(r){let e=en.M(bi());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){let n=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Jf||(Jf=!0,setTimeout(()=>{throw n},0)),n}}return r}var Li="IndexBackfiller",oc=class{constructor(e,t){this.asyncQueue=e,this.te=t,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(e){N(Li,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>C(this,null,function*(){this.task=null;try{let t=yield this.te.re();N(Li,`Documents written: ${t}`)}catch(t){dn(t)?N(Li,"Ignoring IndexedDB error during index backfill: ",t):yield hn(t)}yield this.ne(6e4)}))}},ac=class{constructor(e,t){this.localStore=e,this.persistence=t}re(e=50){return C(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ie(t,e))})}ie(e,t){let n=new Set,i=t,s=!0;return S.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!n.has(a))return N(Li,`Processing collection: ${a}`),this.se(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}se(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.oe(i,s)).next(u=>(N(Li,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}oe(e,t){let n=e;return t.changes.forEach((i,s)=>{let a=dg(s);oh(a,n)>0&&(n=a)}),new Ye(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}};var He=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this._e(i),this.ae=i=>n.writeSequenceNumber(i))}_e(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.ae&&this.ae(t),t}}r.ue=-1;return r})(),Xt=-1;function _s(r){return r==null}function Qi(r){return r===0&&1/r==-1/0}function gg(r){return typeof r=="number"&&Number.isInteger(r)&&!Qi(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}var bo="";function ke(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Yf(e)),e=Iw(r.get(t),e);return Yf(e)}function Iw(r,e){let t=e,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":t+="";break;case bo:t+="";break;default:t+=s}}return t}function Yf(r){return r+bo+""}function lt(r){let e=r.length;if(U(e>=2,64408,{path:r}),e===2)return U(r.charAt(0)===bo&&r.charAt(1)==="",56145,{path:r}),X.emptyPath();let t=e-2,n=[],i="";for(let s=0;s<e;){let a=r.indexOf(bo,s);switch((a<0||a>t)&&q(50515,{path:r}),r.charAt(a+1)){case"":let u=r.substring(s,a),c;i.length===0?c=u:(i+=u,c=i,i=""),n.push(c);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:q(61167,{path:r})}s=a+2}return new X(n)}var bn="remoteDocuments",ws="owner",ur="owner",Hi="mutationQueues",Aw="userId",nt="mutations",Zf="batchId",Dn="userMutationsIndex",em=["userId","batchId"];function ho(r,e){return[r,ke(e)]}function pg(r,e,t){return[r,ke(e),t]}var bw={},Sr="documentMutations",So="remoteDocumentsV14",Sw=["prefixPath","collectionGroup","readTime","documentId"],fo="documentKeyIndex",Rw=["prefixPath","collectionGroup","documentId"],yg="collectionGroupIndex",Pw=["collectionGroup","readTime","prefixPath","documentId"],Xi="remoteDocumentGlobal",uc="remoteDocumentGlobalKey",Rr="targets",_g="queryTargetsIndex",Cw=["canonicalId","targetId"],Pr="targetDocuments",Dw=["targetId","path"],uh="documentTargetsIndex",Vw=["path","targetId"],Ro="targetGlobalKey",kn="targetGlobal",Ji="collectionParents",xw=["collectionId","parent"],Cr="clientMetadata",kw="clientId",Ea="bundles",Nw="bundleId",Ia="namedQueries",Ow="name",ch="indexConfiguration",Fw="indexId",cc="collectionGroupIndex",Mw="collectionGroup",qi="indexState",Lw=["indexId","uid"],wg="sequenceNumberIndex",qw=["uid","sequenceNumber"],Ui="indexEntries",Uw=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vg="documentKeyIndex",jw=["indexId","uid","orderedDocumentKey"],Aa="documentOverlays",Bw=["userId","collectionPath","documentId"],lc="collectionPathOverlayIndex",zw=["userId","collectionPath","largestBatchId"],Tg="collectionGroupOverlayIndex",$w=["userId","collectionGroup","largestBatchId"],lh="globals",Gw="name",Eg=[Hi,nt,Sr,bn,Rr,ws,kn,Pr,Cr,Xi,Ji,Ea,Ia],Kw=[...Eg,Aa],Ig=[Hi,nt,Sr,So,Rr,ws,kn,Pr,Cr,Xi,Ji,Ea,Ia,Aa],Ag=Ig,hh=[...Ag,ch,qi,Ui],Ww=hh,bg=[...hh,lh],Qw=bg;var Yi=class extends Io{constructor(e,t){super(),this.ce=e,this.currentSequenceNumber=t}};function Ie(r,e){let t=L(r);return en.N(t.ce,e)}function tm(r){let e=0;for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function fn(r,e){for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function Sg(r){for(let e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}var ae=class r{constructor(e,t){this.comparator=e,this.root=t||dt.EMPTY}insert(e,t){return new r(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,dt.BLACK,null,null))}remove(e){return new r(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(n===0)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(e,n.key);if(i===0)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new wr(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new wr(this.root,e,this.comparator,!1)}getReverseIterator(){return new wr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new wr(this.root,e,this.comparator,!0)}},wr=class{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},dt=class r{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new r(e??this.key,t??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw q(43730,{key:this.key,value:this.value});if(this.right.isRed())throw q(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw q(27949);return e+(this.isRed()?0:1)}};dt.EMPTY=null,dt.RED=!0,dt.BLACK=!1;dt.EMPTY=new class{constructor(){this.size=0}get key(){throw q(57766)}get value(){throw q(16141)}get color(){throw q(16727)}get left(){throw q(29726)}get right(){throw q(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new dt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var re=class r{constructor(e){this.comparator=e,this.data=new ae(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Po(this.data.getIterator())}getIteratorFrom(e){return new Po(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new r(this.comparator);return t.data=e,t}},Po=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function cr(r){return r.hasNext()?r.getNext():void 0}var Xe=class r{constructor(e){this.fields=e,e.sort(me.comparator)}static empty(){return new r([])}unionWith(e){let t=new re(me.comparator);for(let n of this.fields)t=t.add(n);for(let n of e)t=t.add(n);return new r(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ir(this.fields,e.fields,(t,n)=>t.isEqual(n))}};var Co=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function Rg(){return typeof atob<"u"}var pe=class r{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Co("Invalid base64 string: "+s):s}}(e);return new r(t)}static fromUint8Array(e){let t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new r(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return G(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};pe.EMPTY_BYTE_STRING=new pe("");var Hw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function St(r){if(U(!!r,39018),typeof r=="string"){let e=0,t=Hw.exec(r);if(U(!!t,46558,{timestamp:r}),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:ue(r.seconds),nanos:ue(r.nanos)}}function ue(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function Rt(r){return typeof r=="string"?pe.fromBase64String(r):pe.fromUint8Array(r)}var Pg="server_timestamp",Cg="__type__",Dg="__previous_value__",Vg="__local_write_time__";function ba(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{})[Cg])===null||t===void 0?void 0:t.stringValue)===Pg}function Sa(r){let e=r.mapValue.fields[Dg];return ba(e)?Sa(e):e}function Zi(r){let e=St(r.mapValue.fields[Vg].timestampValue);return new se(e.seconds,e.nanos)}var hc=class{constructor(e,t,n,i,s,a,u,c,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}},dc="(default)",tn=class r{constructor(e,t){this.projectId=e,this.database=t||dc}static empty(){return new r("","")}get isDefaultDatabase(){return this.database===dc}isEqual(e){return e instanceof r&&e.projectId===this.projectId&&e.database===this.database}};var dh="__type__",xg="__max__",Qt={mapValue:{fields:{__type__:{stringValue:xg}}}},fh="__vector__",Dr="value",mo={nullValue:"NULL_VALUE"};function nn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ba(r)?4:kg(r)?9007199254740991:Ra(r)?10:11:q(28295,{value:r})}function pt(r,e){if(r===e)return!0;let t=nn(r);if(t!==nn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return Zi(r).isEqual(Zi(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=St(i.timestampValue),u=St(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return function(i,s){return Rt(i.bytesValue).isEqual(Rt(s.bytesValue))}(r,e);case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return ue(i.geoPointValue.latitude)===ue(s.geoPointValue.latitude)&&ue(i.geoPointValue.longitude)===ue(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ue(i.integerValue)===ue(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ue(i.doubleValue),u=ue(s.doubleValue);return a===u?Qi(a)===Qi(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return Ir(r.arrayValue.values||[],e.arrayValue.values||[],pt);case 10:case 11:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(tm(a)!==tm(u))return!1;for(let c in a)if(a.hasOwnProperty(c)&&(u[c]===void 0||!pt(a[c],u[c])))return!1;return!0}(r,e);default:return q(52216,{left:r})}}function es(r,e){return(r.values||[]).find(t=>pt(t,e))!==void 0}function rn(r,e){if(r===e)return 0;let t=nn(r),n=nn(e);if(t!==n)return G(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return G(r.booleanValue,e.booleanValue);case 2:return function(s,a){let u=ue(s.integerValue||s.doubleValue),c=ue(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return nm(r.timestampValue,e.timestampValue);case 4:return nm(Zi(r),Zi(e));case 5:return nc(r.stringValue,e.stringValue);case 6:return function(s,a){let u=Rt(s),c=Rt(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){let u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=G(u[h],c[h]);if(f!==0)return f}return G(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){let u=G(ue(s.latitude),ue(a.latitude));return u!==0?u:G(ue(s.longitude),ue(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return rm(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,c,h,f;let g=s.fields||{},y=a.fields||{},A=(u=g[Dr])===null||u===void 0?void 0:u.arrayValue,x=(c=y[Dr])===null||c===void 0?void 0:c.arrayValue,k=G(((h=A?.values)===null||h===void 0?void 0:h.length)||0,((f=x?.values)===null||f===void 0?void 0:f.length)||0);return k!==0?k:rm(A,x)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===Qt.mapValue&&a===Qt.mapValue)return 0;if(s===Qt.mapValue)return 1;if(a===Qt.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let g=0;g<c.length&&g<f.length;++g){let y=nc(c[g],f[g]);if(y!==0)return y;let A=rn(u[c[g]],h[f[g]]);if(A!==0)return A}return G(c.length,f.length)}(r.mapValue,e.mapValue);default:throw q(23264,{le:t})}}function nm(r,e){if(typeof r=="string"&&typeof e=="string"&&r.length===e.length)return G(r,e);let t=St(r),n=St(e),i=G(t.seconds,n.seconds);return i!==0?i:G(t.nanos,n.nanos)}function rm(r,e){let t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){let s=rn(t[i],n[i]);if(s)return s}return G(t.length,n.length)}function Vr(r){return fc(r)}function fc(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){let n=St(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(t){return Rt(t).toBase64()}(r.bytesValue):"referenceValue"in r?function(t){return F.fromName(t).toString()}(r.referenceValue):"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(let s of t.values||[])i?i=!1:n+=",",n+=fc(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){let n=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${fc(t.fields[a])}`;return i+"}"}(r.mapValue):q(61005,{value:r})}function go(r){switch(nn(r)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let e=Sa(r);return e?16+go(e):16;case 5:return 2*r.stringValue.length;case 6:return Rt(r.bytesValue).approximateByteSize();case 7:return r.referenceValue.length;case 9:return function(n){return(n.values||[]).reduce((i,s)=>i+go(s),0)}(r.arrayValue);case 10:case 11:return function(n){let i=0;return fn(n.fields,(s,a)=>{i+=s.length+go(a)}),i}(r.mapValue);default:throw q(13486,{value:r})}}function Nn(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function mc(r){return!!r&&"integerValue"in r}function ts(r){return!!r&&"arrayValue"in r}function im(r){return!!r&&"nullValue"in r}function sm(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function po(r){return!!r&&"mapValue"in r}function Ra(r){var e,t;return((t=(((e=r?.mapValue)===null||e===void 0?void 0:e.fields)||{})[dh])===null||t===void 0?void 0:t.stringValue)===fh}function ji(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let e={mapValue:{fields:{}}};return fn(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ji(n)),e}if(r.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ji(r.arrayValue.values[t]);return e}return Object.assign({},r)}function kg(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue===xg}var Ng={mapValue:{fields:{[dh]:{stringValue:fh},[Dr]:{arrayValue:{}}}}};function Xw(r){return"nullValue"in r?mo:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?Nn(tn.empty(),F.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Ra(r)?Ng:{mapValue:{}}:q(35942,{value:r})}function Jw(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?Nn(tn.empty(),F.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?Ng:"mapValue"in r?Ra(r)?{mapValue:{}}:Qt:q(61959,{value:r})}function om(r,e){let t=rn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function am(r,e){let t=rn(r.value,e.value);return t!==0?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}var xe=class r{constructor(e){this.value=e}static empty(){return new r({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!po(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ji(t)}setAll(e){let t=me.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){let c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=ji(a):i.push(u.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){let t=this.field(e.popLast());po(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];po(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){fn(t,(i,s)=>e[i]=s);for(let i of n)delete e[i]}clone(){return new r(ji(this.value))}};function Og(r){let e=[];return fn(r.fields,(t,n)=>{let i=new me([t]);if(po(n)){let s=Og(n.mapValue).fields;if(s.length===0)e.push(i);else for(let a of s)e.push(i.child(a))}else e.push(i)}),new Xe(e)}var Te=class r{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new r(e,0,j.min(),j.min(),j.min(),xe.empty(),0)}static newFoundDocument(e,t,n,i){return new r(e,1,t,j.min(),n,i,0)}static newNoDocument(e,t){return new r(e,2,t,j.min(),j.min(),xe.empty(),0)}static newUnknownDocument(e,t){return new r(e,3,t,j.min(),j.min(),xe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(j.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=xe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=xe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof r&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var yt=class{constructor(e,t){this.position=e,this.inclusive=t}};function um(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){let s=e[i],a=r.position[i];if(s.field.isKeyField()?n=F.comparator(F.fromName(a.referenceValue),t.key):n=rn(a,t.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function cm(r,e){if(r===null)return e===null;if(e===null||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!pt(r.position[t],e.position[t]))return!1;return!0}var On=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Yw(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}var Do=class{},H=class r extends Do{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,n):new yc(e,t,n):t==="array-contains"?new vc(e,n):t==="in"?new Vo(e,n):t==="not-in"?new Tc(e,n):t==="array-contains-any"?new Ec(e,n):new r(e,t,n)}static createKeyFieldInFilter(e,t,n){return t==="in"?new _c(e,n):new wc(e,n)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(rn(t,this.value)):t!==null&&nn(this.value)===nn(t)&&this.matchesComparison(rn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return q(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},te=class r extends Do{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new r(e,t)}matches(e){return xr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function xr(r){return r.op==="and"}function gc(r){return r.op==="or"}function mh(r){return Fg(r)&&xr(r)}function Fg(r){for(let e of r.filters)if(e instanceof te)return!1;return!0}function pc(r){if(r instanceof H)return r.field.canonicalString()+r.op.toString()+Vr(r.value);if(mh(r))return r.filters.map(e=>pc(e)).join(",");{let e=r.filters.map(t=>pc(t)).join(",");return`${r.op}(${e})`}}function Mg(r,e){return r instanceof H?function(n,i){return i instanceof H&&n.op===i.op&&n.field.isEqual(i.field)&&pt(n.value,i.value)}(r,e):r instanceof te?function(n,i){return i instanceof te&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Mg(a,i.filters[u]),!0):!1}(r,e):void q(19439)}function Lg(r,e){let t=r.filters.concat(e);return te.create(t,r.op)}function qg(r){return r instanceof H?function(t){return`${t.field.canonicalString()} ${t.op} ${Vr(t.value)}`}(r):r instanceof te?function(t){return t.op.toString()+" {"+t.getFilters().map(qg).join(" ,")+"}"}(r):"Filter"}var yc=class extends H{constructor(e,t,n){super(e,t,n),this.key=F.fromName(n.referenceValue)}matches(e){let t=F.comparator(e.key,this.key);return this.matchesComparison(t)}},_c=class extends H{constructor(e,t){super(e,"in",t),this.keys=Ug("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},wc=class extends H{constructor(e,t){super(e,"not-in",t),this.keys=Ug("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function Ug(r,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(n=>F.fromName(n.referenceValue))}var vc=class extends H{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ts(t)&&es(t.arrayValue,this.value)}},Vo=class extends H{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&es(this.value.arrayValue,t)}},Tc=class extends H{constructor(e,t){super(e,"not-in",t)}matches(e){if(es(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!es(this.value.arrayValue,t)}},Ec=class extends H{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!ts(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>es(this.value.arrayValue,n))}};var Ic=class{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.Pe=null}};function Ac(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Ic(r,e,t,n,i,s,a)}function Fn(r){let e=L(r);if(e.Pe===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>pc(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),_s(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>Vr(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>Vr(n)).join(",")),e.Pe=t}return e.Pe}function vs(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!Yw(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Mg(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!cm(r.startAt,e.startAt)&&cm(r.endAt,e.endAt)}function xo(r){return F.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ko(r,e){return r.filters.filter(t=>t instanceof H&&t.field.isEqual(e))}function lm(r,e,t){let n=mo,i=!0;for(let s of ko(r,e)){let a=mo,u=!0;switch(s.op){case"<":case"<=":a=Xw(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=mo}om({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];om({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}function hm(r,e,t){let n=Qt,i=!0;for(let s of ko(r,e)){let a=Qt,u=!0;switch(s.op){case">=":case">":a=Jw(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Qt}am({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(t!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){let a=t.position[s];am({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}}return{value:n,inclusive:i}}var rt=class{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function jg(r,e,t,n,i,s,a,u){return new rt(r,e,t,n,i,s,a,u)}function Wr(r){return new rt(r)}function dm(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function gh(r){return r.collectionGroup!==null}function Tr(r){let e=L(r);if(e.Te===null){e.Te=[];let t=new Set;for(let s of e.explicitOrderBy)e.Te.push(s),t.add(s.field.canonicalString());let n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new re(me.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.Te.push(new On(s,n))}),t.has(me.keyField().canonicalString())||e.Te.push(new On(me.keyField(),n))}return e.Te}function qe(r){let e=L(r);return e.Ie||(e.Ie=Zw(e,Tr(r))),e.Ie}function Zw(r,e){if(r.limitType==="F")return Ac(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new On(i.field,s)});let t=r.endAt?new yt(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new yt(r.startAt.position,r.startAt.inclusive):null;return Ac(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}function bc(r,e){let t=r.filters.concat([e]);return new rt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function No(r,e,t){return new rt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function Ts(r,e){return vs(qe(r),qe(e))&&r.limitType===e.limitType}function Bg(r){return`${Fn(qe(r))}|lt:${r.limitType}`}function gr(r){return`Query(target=${function(t){let n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>qg(i)).join(", ")}]`),_s(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>Vr(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>Vr(i)).join(",")),`Target(${n})`}(qe(r))}; limitType=${r.limitType})`}function Es(r,e){return e.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):F.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(let s of Tr(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,e)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&function(n,i){return!(n.startAt&&!function(a,u,c){let h=um(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,Tr(n),i)||n.endAt&&!function(a,u,c){let h=um(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,Tr(n),i))}(r,e)}function zg(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function $g(r){return(e,t)=>{let n=!1;for(let i of Tr(r)){let s=ev(i,e,t);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function ev(r,e,t){let n=r.field.isKeyField()?F.comparator(e.key,t.key):function(s,a,u){let c=a.data.field(s),h=u.data.field(s);return c!==null&&h!==null?rn(c,h):q(42886)}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return q(19790,{direction:r.dir})}}var it=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return n.length===1?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){fn(this.inner,(t,n)=>{for(let[i,s]of n)e(i,s)})}isEmpty(){return Sg(this.inner)}size(){return this.innerSize}};var tv=new ae(F.comparator);function $e(){return tv}var Gg=new ae(F.comparator);function Fi(...r){let e=Gg;for(let t of r)e=e.insert(t.key,t);return e}function Kg(r){let e=Gg;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function ht(){return Bi()}function Wg(){return Bi()}function Bi(){return new it(r=>r.toString(),(r,e)=>r.isEqual(e))}var nv=new ae(F.comparator),rv=new re(F.comparator);function Q(...r){let e=rv;for(let t of r)e=e.add(t);return e}var iv=new re(G);function ph(){return iv}function yh(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qi(e)?"-0":e}}function Qg(r){return{integerValue:""+r}}function Hg(r,e){return gg(e)?Qg(e):yh(r,e)}var kr=class{constructor(){this._=void 0}};function sv(r,e,t){return r instanceof sn?function(i,s){let a={fields:{[Cg]:{stringValue:Pg},[Vg]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ba(s)&&(s=Sa(s)),s&&(a.fields[Dg]=s),{mapValue:a}}(t,e):r instanceof Pt?Jg(r,e):r instanceof Ct?Yg(r,e):function(i,s){let a=Xg(i,s),u=fm(a)+fm(i.Ee);return mc(a)&&mc(i.Ee)?Qg(u):yh(i.serializer,u)}(r,e)}function ov(r,e,t){return r instanceof Pt?Jg(r,e):r instanceof Ct?Yg(r,e):t}function Xg(r,e){return r instanceof on?function(n){return mc(n)||function(s){return!!s&&"doubleValue"in s}(n)}(e)?e:{integerValue:0}:null}var sn=class extends kr{},Pt=class extends kr{constructor(e){super(),this.elements=e}};function Jg(r,e){let t=Zg(e);for(let n of r.elements)t.some(i=>pt(i,n))||t.push(n);return{arrayValue:{values:t}}}var Ct=class extends kr{constructor(e){super(),this.elements=e}};function Yg(r,e){let t=Zg(e);for(let n of r.elements)t=t.filter(i=>!pt(i,n));return{arrayValue:{values:t}}}var on=class extends kr{constructor(e,t){super(),this.serializer=e,this.Ee=t}};function fm(r){return ue(r.integerValue||r.doubleValue)}function Zg(r){return ts(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var Mn=class{constructor(e,t){this.field=e,this.transform=t}};function av(r,e){return r.field.isEqual(e.field)&&function(n,i){return n instanceof Pt&&i instanceof Pt||n instanceof Ct&&i instanceof Ct?Ir(n.elements,i.elements,pt):n instanceof on&&i instanceof on?pt(n.Ee,i.Ee):n instanceof sn&&i instanceof sn}(r.transform,e.transform)}var Sc=class{constructor(e,t){this.version=e,this.transformResults=t}},de=class r{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new r}static exists(e){return new r(void 0,e)}static updateTime(e){return new r(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function yo(r,e){return r.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(r.updateTime):r.exists===void 0||r.exists===e.isFoundDocument()}var Nr=class{};function ep(r,e){if(!r.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return r.isNoDocument()?new un(r.key,de.none()):new an(r.key,r.data,de.none());{let t=r.data,n=xe.empty(),i=new re(me.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new st(r.key,n,new Xe(i.toArray()),de.none())}}function uv(r,e,t){r instanceof an?function(i,s,a){let u=i.value.clone(),c=gm(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof st?function(i,s,a){if(!yo(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=gm(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(tp(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function zi(r,e,t,n){return r instanceof an?function(s,a,u,c){if(!yo(s.precondition,a))return u;let h=s.value.clone(),f=pm(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof st?function(s,a,u,c){if(!yo(s.precondition,a))return u;let h=pm(s.fieldTransforms,c,a),f=a.data;return f.setAll(tp(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,e,t,n):function(s,a,u){return yo(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,e,t)}function cv(r,e){let t=null;for(let n of r.fieldTransforms){let i=e.data.field(n.field),s=Xg(n.transform,i||null);s!=null&&(t===null&&(t=xe.empty()),t.set(n.field,s))}return t||null}function mm(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&Ir(n,i,(s,a)=>av(s,a))}(r.fieldTransforms,e.fieldTransforms)&&(r.type===0?r.value.isEqual(e.value):r.type!==1||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask))}var an=class extends Nr{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},st=class extends Nr{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function tp(r){let e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let n=r.data.field(t);e.set(t,n)}}),e}function gm(r,e,t){let n=new Map;U(r.length===t.length,32656,{Ae:t.length,Re:r.length});for(let i=0;i<t.length;i++){let s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,ov(a,u,t[i]))}return n}function pm(r,e,t){let n=new Map;for(let i of r){let s=i.transform,a=t.data.field(i.field);n.set(i.field,sv(s,a,e))}return n}var un=class extends Nr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ns=class extends Nr{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var rs=class{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&uv(s,e,n[i])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=zi(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=zi(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=Wg();return this.mutations.forEach(i=>{let s=e.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;let c=ep(a,u);c!==null&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument(j.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&Ir(this.mutations,e.mutations,(t,n)=>mm(t,n))&&Ir(this.baseMutations,e.baseMutations,(t,n)=>mm(t,n))}},Rc=class r{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){U(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let i=function(){return nv}(),s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(e,t,n,i)}};var is=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var Pc=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ye,J;function np(r){switch(r){case R.OK:return q(64938);case R.CANCELLED:case R.UNKNOWN:case R.DEADLINE_EXCEEDED:case R.RESOURCE_EXHAUSTED:case R.INTERNAL:case R.UNAVAILABLE:case R.UNAUTHENTICATED:return!1;case R.INVALID_ARGUMENT:case R.NOT_FOUND:case R.ALREADY_EXISTS:case R.PERMISSION_DENIED:case R.FAILED_PRECONDITION:case R.ABORTED:case R.OUT_OF_RANGE:case R.UNIMPLEMENTED:case R.DATA_LOSS:return!0;default:return q(15467,{code:r})}}function rp(r){if(r===void 0)return fe("GRPC error has no .code"),R.UNKNOWN;switch(r){case ye.OK:return R.OK;case ye.CANCELLED:return R.CANCELLED;case ye.UNKNOWN:return R.UNKNOWN;case ye.DEADLINE_EXCEEDED:return R.DEADLINE_EXCEEDED;case ye.RESOURCE_EXHAUSTED:return R.RESOURCE_EXHAUSTED;case ye.INTERNAL:return R.INTERNAL;case ye.UNAVAILABLE:return R.UNAVAILABLE;case ye.UNAUTHENTICATED:return R.UNAUTHENTICATED;case ye.INVALID_ARGUMENT:return R.INVALID_ARGUMENT;case ye.NOT_FOUND:return R.NOT_FOUND;case ye.ALREADY_EXISTS:return R.ALREADY_EXISTS;case ye.PERMISSION_DENIED:return R.PERMISSION_DENIED;case ye.FAILED_PRECONDITION:return R.FAILED_PRECONDITION;case ye.ABORTED:return R.ABORTED;case ye.OUT_OF_RANGE:return R.OUT_OF_RANGE;case ye.UNIMPLEMENTED:return R.UNIMPLEMENTED;case ye.DATA_LOSS:return R.DATA_LOSS;default:return q(39323,{code:r})}}(J=ye||(ye={}))[J.OK=0]="OK",J[J.CANCELLED=1]="CANCELLED",J[J.UNKNOWN=2]="UNKNOWN",J[J.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",J[J.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",J[J.NOT_FOUND=5]="NOT_FOUND",J[J.ALREADY_EXISTS=6]="ALREADY_EXISTS",J[J.PERMISSION_DENIED=7]="PERMISSION_DENIED",J[J.UNAUTHENTICATED=16]="UNAUTHENTICATED",J[J.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",J[J.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",J[J.ABORTED=10]="ABORTED",J[J.OUT_OF_RANGE=11]="OUT_OF_RANGE",J[J.UNIMPLEMENTED=12]="UNIMPLEMENTED",J[J.INTERNAL=13]="INTERNAL",J[J.UNAVAILABLE=14]="UNAVAILABLE",J[J.DATA_LOSS=15]="DATA_LOSS";var ym=null;var lv=new Et([4294967295,4294967295],0);function _m(r){let e=rh().encode(r),t=new Mu;return t.update(e),new Uint8Array(t.digest())}function wm(r){let e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Et([t,n],0),new Et([i,s],0)]}var Cc=class r{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Vn(`Invalid padding: ${t}`);if(n<0)throw new Vn(`Invalid hash count: ${n}`);if(e.length>0&&this.hashCount===0)throw new Vn(`Invalid hash count: ${n}`);if(e.length===0&&t!==0)throw new Vn(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=Et.fromNumber(this.fe)}pe(e,t,n){let i=e.add(t.multiply(Et.fromNumber(n)));return i.compare(lv)===1&&(i=new Et([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.fe===0)return!1;let t=_m(e),[n,i]=wm(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(n,i,s);if(!this.ye(a))return!1}return!0}static create(e,t,n){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new r(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(this.fe===0)return;let t=_m(e),[n,i]=wm(t);for(let s=0;s<this.hashCount;s++){let a=this.pe(n,i,s);this.we(a)}}we(e){let t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}},Vn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ss=class r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let i=new Map;return i.set(e,os.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new r(j.min(),i,new ae(G),$e(),Q())}},os=class r{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new r(n,t,Q(),Q(),Q())}};var Er=class{constructor(e,t,n,i){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=i}},Oo=class{constructor(e,t){this.targetId=e,this.De=t}},Fo=class{constructor(e,t,n=pe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}},Mo=class{constructor(){this.ve=0,this.Ce=vm(),this.Fe=pe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Q(),t=Q(),n=Q();return this.Ce.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:q(38017,{changeType:s})}}),new os(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=vm()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,U(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},Dc=class{constructor(e){this.We=e,this.Ge=new Map,this.ze=$e(),this.je=oo(),this.Je=oo(),this.He=new ae(G)}Ye(e){for(let t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(let t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,t=>{let n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:q(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach((n,i)=>{this.nt(i)&&t(i)})}it(e){let t=e.targetId,n=e.De.count,i=this.st(t);if(i){let s=i.target;if(xo(s))if(n===0){let a=new F(s.path);this.Xe(t,a,Te.newNoDocument(a,j.min()))}else U(n===1,20013,{expectedCount:n});else{let a=this.ot(t);if(a!==n){let u=this._t(e),c=u?this.ut(u,e,a):1;if(c!==0){this.rt(t);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,h)}ym?.ct(function(f,g,y,A,x){var k,V,z,B,M,$;let K={localCacheCount:f,existenceFilterCount:g.count,databaseId:y.database,projectId:y.projectId},W=g.unchangedNames;return W&&(K.bloomFilter={applied:x===0,hashCount:(k=W?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(B=(z=(V=W?.bits)===null||V===void 0?void 0:V.bitmap)===null||z===void 0?void 0:z.length)!==null&&B!==void 0?B:0,padding:($=(M=W?.bits)===null||M===void 0?void 0:M.padding)!==null&&$!==void 0?$:0,mightContain:v=>{var p;return(p=A?.mightContain(v))!==null&&p!==void 0&&p}}),K}(a,e.De,this.We.lt(),u,c))}}}}_t(e){let t=e.De.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t,a,u;try{a=Rt(n).toUint8Array()}catch(c){if(c instanceof Co)return Ke("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Cc(a,i,s)}catch(c){return Ke(c instanceof Vn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.fe===0?null:u}ut(e,t,n){return t.De.count===n-this.ht(e,t.targetId)?0:2}ht(e,t){let n=this.We.getRemoteKeysForTarget(t),i=0;return n.forEach(s=>{let a=this.We.lt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Xe(t,s,null),i++)}),i}Pt(e){let t=new Map;this.Ge.forEach((s,a)=>{let u=this.st(a);if(u){if(s.current&&xo(u.target)){let c=new F(u.target.path);this.Tt(c).has(a)||this.It(a,c)||this.Xe(a,c,Te.newNoDocument(c,e))}s.Ne&&(t.set(a,s.Le()),s.ke())}});let n=Q();this.Je.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{let h=this.st(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ze.forEach((s,a)=>a.setReadTime(e));let i=new ss(e,t,this.He,this.ze,n);return this.ze=$e(),this.je=oo(),this.Je=oo(),this.He=new ae(G),i}Ze(e,t){if(!this.nt(e))return;let n=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;let i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){let t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Mo,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new re(G),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new re(G),this.je=this.je.insert(e,t)),t}nt(e){let t=this.st(e)!==null;return t||N("WatchChangeAggregator","Detected inactive target",e),t}st(e){let t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Mo),this.We.getRemoteKeysForTarget(e).forEach(t=>{this.Xe(e,t,null)})}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}};function oo(){return new ae(F.comparator)}function vm(){return new ae(F.comparator)}var hv={asc:"ASCENDING",desc:"DESCENDING"},dv={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},fv={and:"AND",or:"OR"},Vc=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function xc(r,e){return r.useProto3Json||_s(e)?e:{value:e}}function Or(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ip(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function mv(r,e){return Or(r,e.toTimestamp())}function ge(r){return U(!!r,49232),j.fromTimestamp(function(t){let n=St(t);return new se(n.seconds,n.nanos)}(r))}function _h(r,e){return kc(r,e).canonicalString()}function kc(r,e){let t=function(i){return new X(["projects",i.projectId,"databases",i.database])}(r).child("documents");return e===void 0?t:t.child(e)}function sp(r){let e=X.fromString(r);return U(gp(e),10190,{key:e.toString()}),e}function as(r,e){return _h(r.databaseId,e.path)}function ft(r,e){let t=sp(e);if(t.get(1)!==r.databaseId.projectId)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new D(R.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new F(up(t))}function op(r,e){return _h(r.databaseId,e)}function ap(r){let e=sp(r);return e.length===4?X.emptyPath():up(e)}function Nc(r){return new X(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function up(r){return U(r.length>4&&r.get(4)==="documents",29091,{key:r.toString()}),r.popFirst(5)}function Tm(r,e,t){return{name:as(r,e),fields:t.value.mapValue.fields}}function cp(r,e,t){let n=ft(r,e.name),i=ge(e.updateTime),s=e.createTime?ge(e.createTime):j.min(),a=new xe({mapValue:{fields:e.fields}}),u=Te.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function gv(r,e){return"found"in e?function(n,i){U(!!i.found,43571),i.found.name,i.found.updateTime;let s=ft(n,i.found.name),a=ge(i.found.updateTime),u=i.found.createTime?ge(i.found.createTime):j.min(),c=new xe({mapValue:{fields:i.found.fields}});return Te.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){U(!!i.missing,3894),U(!!i.readTime,22933);let s=ft(n,i.missing),a=ge(i.readTime);return Te.newNoDocument(s,a)}(r,e):q(7234,{result:e})}function pv(r,e){let t;if("targetChange"in e){e.targetChange;let n=function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:q(39313,{state:h})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(U(f===void 0||typeof f=="string",58123),pe.fromBase64String(f||"")):(U(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),pe.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){let f=h.code===void 0?R.UNKNOWN:rp(h.code);return new D(f,h.message||"")}(a);t=new Fo(n,i,s,u||null)}else if("documentChange"in e){e.documentChange;let n=e.documentChange;n.document,n.document.name,n.document.updateTime;let i=ft(r,n.document.name),s=ge(n.document.updateTime),a=n.document.createTime?ge(n.document.createTime):j.min(),u=new xe({mapValue:{fields:n.document.fields}}),c=Te.newFoundDocument(i,s,a,u),h=n.targetIds||[],f=n.removedTargetIds||[];t=new Er(h,f,c.key,c)}else if("documentDelete"in e){e.documentDelete;let n=e.documentDelete;n.document;let i=ft(r,n.document),s=n.readTime?ge(n.readTime):j.min(),a=Te.newNoDocument(i,s),u=n.removedTargetIds||[];t=new Er([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;let n=e.documentRemove;n.document;let i=ft(r,n.document),s=n.removedTargetIds||[];t=new Er([],s,i,null)}else{if(!("filter"in e))return q(11601,{At:e});{e.filter;let n=e.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new Pc(i,s),u=n.targetId;t=new Oo(u,a)}}return t}function us(r,e){let t;if(e instanceof an)t={update:Tm(r,e.key,e.value)};else if(e instanceof un)t={delete:as(r,e.key)};else if(e instanceof st)t={update:Tm(r,e.key,e.data),updateMask:Ev(e.fieldMask)};else{if(!(e instanceof ns))return q(16599,{Rt:e.type});t={verify:as(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof sn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Pt)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ct)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof on)return{fieldPath:a.field.canonicalString(),increment:u.Ee};throw q(20930,{transform:a.transform})}(0,n))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:mv(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:q(27497)}(r,e.precondition)),t}function Oc(r,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?de.updateTime(ge(s.updateTime)):s.exists!==void 0?de.exists(s.exists):de.none()}(e.currentDocument):de.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;if("setToServerValue"in u)U(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),c=new sn;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new Pt(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Ct(f)}else"increment"in u?c=new on(a,u.increment):q(16584,{proto:u});let h=me.fromServerFormat(u.fieldPath);return new Mn(h,c)}(r,i)):[];if(e.update){e.update.name;let i=ft(r,e.update.name),s=new xe({mapValue:{fields:e.update.fields}});if(e.updateMask){let a=function(c){let h=c.fieldPaths||[];return new Xe(h.map(f=>me.fromServerFormat(f)))}(e.updateMask);return new st(i,s,a,t,n)}return new an(i,s,t,n)}if(e.delete){let i=ft(r,e.delete);return new un(i,t)}if(e.verify){let i=ft(r,e.verify);return new ns(i,t)}return q(1463,{proto:e})}function yv(r,e){return r&&r.length>0?(U(e!==void 0,14353),r.map(t=>function(i,s){let a=i.updateTime?ge(i.updateTime):ge(s);return a.isEqual(j.min())&&(a=ge(s)),new Sc(a,i.transformResults||[])}(t,e))):[]}function lp(r,e){return{documents:[op(r,e.path)]}}function hp(r,e){let t={structuredQuery:{}},n=e.path,i;e.collectionGroup!==null?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=op(r,i);let s=function(h){if(h.length!==0)return mp(te.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let a=function(h){if(h.length!==0)return h.map(f=>function(y){return{field:pr(y.field),direction:wv(y.dir)}}(f))}(e.orderBy);a&&(t.structuredQuery.orderBy=a);let u=xc(r,e.limit);return u!==null&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{Vt:t,parent:i}}function dp(r){let e=ap(r.parent),t=r.structuredQuery,n=t.from?t.from.length:0,i=null;if(n>0){U(n===1,65062);let f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(g){let y=fp(g);return y instanceof te&&mh(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=function(g){return g.map(y=>function(x){return new On(yr(x.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(x.direction))}(y))}(t.orderBy));let u=null;t.limit&&(u=function(g){let y;return y=typeof g=="object"?g.value:g,_s(y)?null:y}(t.limit));let c=null;t.startAt&&(c=function(g){let y=!!g.before,A=g.values||[];return new yt(A,y)}(t.startAt));let h=null;return t.endAt&&(h=function(g){let y=!g.before,A=g.values||[];return new yt(A,y)}(t.endAt)),jg(e,i,a,s,u,"F",c,h)}function _v(r,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return q(28987,{purpose:i})}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function fp(r){return r.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let n=yr(t.unaryFilter.field);return H.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=yr(t.unaryFilter.field);return H.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=yr(t.unaryFilter.field);return H.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=yr(t.unaryFilter.field);return H.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return q(61313);default:return q(60726)}}(r):r.fieldFilter!==void 0?function(t){return H.create(yr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return q(58110);default:return q(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(t){return te.create(t.compositeFilter.filters.map(n=>fp(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return q(1026)}}(t.compositeFilter.op))}(r):q(30097,{filter:r})}function wv(r){return hv[r]}function vv(r){return dv[r]}function Tv(r){return fv[r]}function pr(r){return{fieldPath:r.canonicalString()}}function yr(r){return me.fromServerFormat(r.fieldPath)}function mp(r){return r instanceof H?function(t){if(t.op==="=="){if(sm(t.value))return{unaryFilter:{field:pr(t.field),op:"IS_NAN"}};if(im(t.value))return{unaryFilter:{field:pr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(sm(t.value))return{unaryFilter:{field:pr(t.field),op:"IS_NOT_NAN"}};if(im(t.value))return{unaryFilter:{field:pr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:pr(t.field),op:vv(t.op),value:t.value}}}(r):r instanceof te?function(t){let n=t.getFilters().map(i=>mp(i));return n.length===1?n[0]:{compositeFilter:{op:Tv(t.op),filters:n}}}(r):q(54877,{filter:r})}function Ev(r){let e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function gp(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Fr=class r{constructor(e,t,n,i,s=j.min(),a=j.min(),u=pe.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new r(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Lo=class{constructor(e){this.gt=e}};function Iv(r,e){let t;if(e.document)t=cp(r.gt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let n=F.fromSegments(e.noDocument.path),i=qn(e.noDocument.readTime);t=Te.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return q(56709);{let n=F.fromSegments(e.unknownDocument.path),i=qn(e.unknownDocument.version);t=Te.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){let s=new se(i[0],i[1]);return j.fromTimestamp(s)}(e.readTime)),t}function Em(r,e){let t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:qo(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document=function(s,a){return{name:as(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Or(s,a.version.toTimestamp()),createTime:Or(s,a.createTime.toTimestamp())}}(r.gt,e);else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:Ln(e.version)};else{if(!e.isUnknownDocument())return q(57904,{document:e});n.unknownDocument={path:t.path.toArray(),version:Ln(e.version)}}return n}function qo(r){let e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function Ln(r){let e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qn(r){let e=new se(r.seconds,r.nanoseconds);return j.fromTimestamp(e)}function Rn(r,e){let t=(e.baseMutations||[]).map(s=>Oc(r.gt,s));for(let s=0;s<e.mutations.length-1;++s){let a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let u=e.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let n=e.mutations.map(s=>Oc(r.gt,s)),i=se.fromMillis(e.localWriteTimeMs);return new rs(e.batchId,i,t,n)}function Mi(r){let e=qn(r.readTime),t=r.lastLimboFreeSnapshotVersion!==void 0?qn(r.lastLimboFreeSnapshotVersion):j.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){let a=s.documents.length;return U(a===1,1966,{count:a}),qe(Wr(ap(s.documents[0])))}(r.query):function(s){return qe(dp(s))}(r.query),new Fr(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,pe.fromBase64String(r.resumeToken))}function pp(r,e){let t=Ln(e.snapshotVersion),n=Ln(e.lastLimboFreeSnapshotVersion),i;i=xo(e.target)?lp(r.gt,e.target):hp(r.gt,e.target).Vt;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Fn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function wh(r){let e=dp({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?No(e,e.limit,"L"):e}function zu(r,e){return new is(e.largestBatchId,Oc(r.gt,e.overlayMutation))}function Im(r,e){let t=e.path.lastSegment();return[r,ke(e.path.popLast()),t]}function Am(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:Ln(n.readTime),documentKey:ke(n.documentKey.path),largestBatchId:n.largestBatchId}}var Fc=class{getBundleMetadata(e,t){return bm(e).get(t).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:qn(s.createTime),version:s.version}}(n)})}saveBundleMetadata(e,t){return bm(e).put(function(i){return{bundleId:i.id,createTime:Ln(ge(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Sm(e).get(t).next(n=>{if(n)return function(s){return{name:s.name,query:wh(s.bundledQuery),readTime:qn(s.readTime)}}(n)})}saveNamedQuery(e,t){return Sm(e).put(function(i){return{name:i.name,readTime:Ln(ge(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function bm(r){return Ie(r,Ea)}function Sm(r){return Ie(r,Ia)}var Uo=class r{constructor(e,t){this.serializer=e,this.userId=t}static yt(e,t){let n=t.uid||"";return new r(e,n)}getOverlay(e,t){return xi(e).get(Im(this.userId,t)).next(n=>n?zu(this.serializer,n):null)}getOverlays(e,t){let n=ht();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){let i=[];return n.forEach((s,a)=>{let u=new is(t,a);i.push(this.wt(e,u))}),S.waitFor(i)}removeOverlaysForBatchId(e,t,n){let i=new Set;t.forEach(a=>i.add(ke(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(xi(e).Y(lc,u))}),S.waitFor(s)}getOverlaysForCollection(e,t,n){let i=ht(),s=ke(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return xi(e).j(lc,a).next(u=>{for(let c of u){let h=zu(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){let s=ht(),a,u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return xi(e).X({index:Tg,range:u},(c,h,f)=>{let g=zu(this.serializer,h);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}wt(e,t){return xi(e).put(function(i,s,a){let[u,c,h]=Im(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:us(i.gt,a.mutation)}}(this.serializer,this.userId,t))}};function xi(r){return Ie(r,Aa)}var Mc=class{St(e){return Ie(e,lh)}getSessionToken(e){return this.St(e).get("sessionToken").next(t=>{let n=t?.value;return n?pe.fromUint8Array(n):pe.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.St(e).put({name:"sessionToken",value:t.toUint8Array()})}};var At=class{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(ue(e.integerValue));else if("doubleValue"in e){let n=ue(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),Qi(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),typeof n=="string"&&(n=St(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(Rt(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?kg(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Ra(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):q(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){let n=e.fields||{};this.Ct(t,55);for(let i of Object.keys(n))this.xt(i,t),this.Dt(n[i],t)}Lt(e,t){var n,i;let s=e.fields||{};this.Ct(t,53);let a=Dr,u=((i=(n=s[a].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.length)||0;this.Ct(t,15),t.Ft(ue(u)),this.xt(a,t),this.Dt(s[a],t)}qt(e,t){let n=e.values||[];this.Ct(t,50);for(let i of n)this.Dt(i,t)}Bt(e,t){this.Ct(t,37),F.fromName(e).path.forEach(n=>{this.Ct(t,60),this.$t(n,t)})}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}};At.Ut=new At;var lr=255;function Av(r){if(r===0)return 8;let e=0;return r>>4||(e+=4,r<<=4),r>>6||(e+=2,r<<=2),r>>7||(e+=1),e}function Rm(r){let e=64-function(n){let i=0;for(let s=0;s<8;++s){let a=Av(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(e/8)}var Lc=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.Wt(n.value),n=t.next();this.Gt()}zt(e){let t=e[Symbol.iterator](),n=t.next();for(;!n.done;)this.jt(n.value),n=t.next();this.Jt()}Ht(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.Wt(n);else if(n<2048)this.Wt(960|n>>>6),this.Wt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.Wt(480|n>>>12),this.Wt(128|63&n>>>6),this.Wt(128|63&n);else{let i=t.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(e){for(let t of e){let n=t.charCodeAt(0);if(n<128)this.jt(n);else if(n<2048)this.jt(960|n>>>6),this.jt(128|63&n);else if(t<"\uD800"||"\uDBFF"<t)this.jt(480|n>>>12),this.jt(128|63&n>>>6),this.jt(128|63&n);else{let i=t.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(e){let t=this.Xt(e),n=Rm(t);this.en(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}tn(e){let t=this.Xt(e),n=Rm(t);this.en(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}nn(){this.rn(lr),this.rn(255)}sn(){this._n(lr),this._n(255)}reset(){this.position=0}seed(e){this.en(e.length),this.buffer.set(e,this.position),this.position+=e.length}an(){return this.buffer.slice(0,this.position)}Xt(e){let t=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Wt(e){let t=255&e;t===0?(this.rn(0),this.rn(255)):t===lr?(this.rn(lr),this.rn(0)):this.rn(t)}jt(e){let t=255&e;t===0?(this._n(0),this._n(255)):t===lr?(this._n(lr),this._n(0)):this._n(e)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(e){this.en(1),this.buffer[this.position++]=e}_n(e){this.en(1),this.buffer[this.position++]=~e}en(e){let t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},qc=class{constructor(e){this.un=e}Nt(e){this.un.Kt(e)}Mt(e){this.un.Ht(e)}Ft(e){this.un.Zt(e)}vt(){this.un.nn()}},Uc=class{constructor(e){this.un=e}Nt(e){this.un.zt(e)}Mt(e){this.un.Yt(e)}Ft(e){this.un.tn(e)}vt(){this.un.sn()}},Pn=class{constructor(){this.un=new Lc,this.cn=new qc(this.un),this.ln=new Uc(this.un)}seed(e){this.un.seed(e)}hn(e){return e===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var Cn=class r{constructor(e,t,n,i){this.Pn=e,this.Tn=t,this.In=n,this.dn=i}En(){let e=this.dn.length,t=e===0||this.dn[e-1]===255?e+1:e,n=new Uint8Array(t);return n.set(this.dn,0),t!==e?n.set([0],this.dn.length):++n[n.length-1],new r(this.Pn,this.Tn,this.In,n)}An(e,t,n){return{indexId:this.Pn,uid:e,arrayValue:_o(this.In),directionalValue:_o(this.dn),orderedDocumentKey:_o(t),documentKey:n.path.toArray()}}Rn(e,t,n){let i=this.An(e,t,n);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function $t(r,e){let t=r.Pn-e.Pn;return t!==0?t:(t=Pm(r.In,e.In),t!==0?t:(t=Pm(r.dn,e.dn),t!==0?t:F.comparator(r.Tn,e.Tn)))}function Pm(r,e){for(let t=0;t<r.length&&t<e.length;++t){let n=r[t]-e[t];if(n!==0)return n}return r.length-e.length}function _o(r){return vu()?function(t){let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}(r):r}function Cm(r){return typeof r!="string"?r:function(t){let n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(r)}var jo=class{constructor(e){this.Vn=new re((t,n)=>me.comparator(t.field,n.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.mn=e.orderBy,this.fn=[];for(let t of e.filters){let n=t;n.isInequality()?this.Vn=this.Vn.add(n):this.fn.push(n)}}get gn(){return this.Vn.size>1}pn(e){if(U(e.collectionGroup===this.collectionId,49279),this.gn)return!1;let t=rc(e);if(t!==void 0&&!this.yn(t))return!1;let n=An(e),i=new Set,s=0,a=0;for(;s<n.length&&this.yn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Vn.size>0){let u=this.Vn.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=n[s];if(!this.wn(u,c)||!this.Sn(this.mn[a++],c))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.mn.length||!this.Sn(this.mn[a++],u))return!1}return!0}bn(){if(this.gn)return null;let e=new re(me.comparator),t=[];for(let n of this.fn)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")t.push(new vr(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new vr(n.field,0))}for(let n of this.mn)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new vr(n.field,n.dir==="asc"?0:1)));return new br(br.UNKNOWN_ID,this.collectionId,t,Wi.empty())}yn(e){for(let t of this.fn)if(this.wn(t,e))return!0;return!1}wn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let n=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===n}Sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function yp(r){var e,t;if(U(r instanceof H||r instanceof te,20012),r instanceof H){if(r instanceof Vo){let i=((t=(e=r.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>H.create(r.field,"==",s)))||[];return te.create(i,"or")}return r}let n=r.filters.map(i=>yp(i));return te.create(n,r.op)}function bv(r){if(r.getFilters().length===0)return[];let e=zc(yp(r));return U(_p(e),7391),jc(e)||Bc(e)?[e]:e.getFilters()}function jc(r){return r instanceof H}function Bc(r){return r instanceof te&&mh(r)}function _p(r){return jc(r)||Bc(r)||function(t){if(t instanceof te&&gc(t)){for(let n of t.getFilters())if(!jc(n)&&!Bc(n))return!1;return!0}return!1}(r)}function zc(r){if(U(r instanceof H||r instanceof te,34018),r instanceof H)return r;if(r.filters.length===1)return zc(r.filters[0]);let e=r.filters.map(n=>zc(n)),t=te.create(e,r.op);return t=Bo(t),_p(t)?t:(U(t instanceof te,64498),U(xr(t),40251),U(t.filters.length>1,57927),t.filters.reduce((n,i)=>vh(n,i)))}function vh(r,e){let t;return U(r instanceof H||r instanceof te,38388),U(e instanceof H||e instanceof te,25473),t=r instanceof H?e instanceof H?function(i,s){return te.create([i,s],"and")}(r,e):Dm(r,e):e instanceof H?Dm(e,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0,48005),xr(i)&&xr(s))return Lg(i,s.getFilters());let a=gc(i)?i:s,u=gc(i)?s:i,c=a.filters.map(h=>vh(h,u));return te.create(c,"or")}(r,e),Bo(t)}function Dm(r,e){if(xr(e))return Lg(e,r.getFilters());{let t=e.filters.map(n=>vh(r,n));return te.create(t,"or")}}function Bo(r){if(U(r instanceof H||r instanceof te,11850),r instanceof H)return r;let e=r.getFilters();if(e.length===1)return Bo(e[0]);if(Fg(r))return r;let t=e.map(i=>Bo(i)),n=[];return t.forEach(i=>{i instanceof H?n.push(i):i instanceof te&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:te.create(n,r.op)}var $c=class{constructor(){this.Dn=new cs}addToCollectionParentIndex(e,t){return this.Dn.add(t),S.resolve()}getCollectionParents(e,t){return S.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return S.resolve()}deleteFieldIndex(e,t){return S.resolve()}deleteAllFieldIndexes(e){return S.resolve()}createTargetIndexes(e,t){return S.resolve()}getDocumentsMatchingTarget(e,t){return S.resolve(null)}getIndexType(e,t){return S.resolve(0)}getFieldIndexes(e,t){return S.resolve([])}getNextCollectionGroupToUpdate(e){return S.resolve(null)}getMinOffset(e,t){return S.resolve(Ye.min())}getMinOffsetFromCollectionGroup(e,t){return S.resolve(Ye.min())}updateCollectionGroup(e,t,n){return S.resolve()}updateIndexEntries(e,t){return S.resolve()}},cs=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new re(X.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){let t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new re(X.comparator)).toArray()}};var Vm="IndexedDbIndexManager",ao=new Uint8Array(0),Gc=class{constructor(e,t){this.databaseId=t,this.vn=new cs,this.Cn=new it(n=>Fn(n),(n,i)=>vs(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.vn.has(t)){let n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.vn.add(t)});let s={collectionId:n,parent:ke(i)};return xm(e).put(s)}return S.resolve()}getCollectionParents(e,t){let n=[],i=IDBKeyRange.bound([t,""],[ug(t),""],!1,!0);return xm(e).j(i).next(s=>{for(let a of s){if(a.collectionId!==t)break;n.push(lt(a.parent))}return n})}addFieldIndex(e,t){let n=ki(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;let s=n.add(i);if(t.indexState){let a=dr(e);return s.next(u=>{a.put(Am(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let n=ki(e),i=dr(e),s=hr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=ki(e),n=hr(e),i=dr(e);return t.Y().next(()=>n.Y()).next(()=>i.Y())}createTargetIndexes(e,t){return S.forEach(this.Fn(t),n=>this.getIndexType(e,n).next(i=>{if(i===0||i===1){let s=new jo(n).bn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let n=hr(e),i=!0,s=new Map;return S.forEach(this.Fn(t),a=>this.Mn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=Q(),u=[];return S.forEach(s,(c,h)=>{N(Vm,`Using index ${function(M){return`id=${M.indexId}|cg=${M.collectionGroup}|f=${M.fields.map($=>`${$.fieldPath}:${$.kind}`).join(",")}`}(c)} to execute ${Fn(t)}`);let f=function(M,$){let K=rc($);if(K===void 0)return null;for(let W of ko(M,K.fieldPath))switch(W.op){case"array-contains-any":return W.value.arrayValue.values||[];case"array-contains":return[W.value]}return null}(h,c),g=function(M,$){let K=new Map;for(let W of An($))for(let v of ko(M,W.fieldPath))switch(v.op){case"==":case"in":K.set(W.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return K.set(W.fieldPath.canonicalString(),v.value),Array.from(K.values())}return null}(h,c),y=function(M,$){let K=[],W=!0;for(let v of An($)){let p=v.kind===0?lm(M,v.fieldPath,M.startAt):hm(M,v.fieldPath,M.startAt);K.push(p.value),W&&(W=p.inclusive)}return new yt(K,W)}(h,c),A=function(M,$){let K=[],W=!0;for(let v of An($)){let p=v.kind===0?hm(M,v.fieldPath,M.endAt):lm(M,v.fieldPath,M.endAt);K.push(p.value),W&&(W=p.inclusive)}return new yt(K,W)}(h,c),x=this.xn(c,h,y),k=this.xn(c,h,A),V=this.On(c,h,g),z=this.Nn(c.indexId,f,x,y.inclusive,k,A.inclusive,V);return S.forEach(z,B=>n.H(B,t.limit).next(M=>{M.forEach($=>{let K=F.fromSegments($.documentKey);a.has(K)||(a=a.add(K),u.push(K))})}))}).next(()=>u)}return S.resolve(null)})}Fn(e){let t=this.Cn.get(e);return t||(e.filters.length===0?t=[e]:t=bv(te.create(e.filters,"and")).map(n=>Ac(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.Cn.set(e,t),t)}Nn(e,t,n,i,s,a,u){let c=(t!=null?t.length:1)*Math.max(n.length,s.length),h=c/(t!=null?t.length:1),f=[];for(let g=0;g<c;++g){let y=t?this.Bn(t[g/h]):ao,A=this.Ln(e,y,n[g%h],i),x=this.kn(e,y,s[g%h],a),k=u.map(V=>this.Ln(e,y,V,!0));f.push(...this.createRange(A,x,k))}return f}Ln(e,t,n,i){let s=new Cn(e,F.empty(),t,n);return i?s:s.En()}kn(e,t,n,i){let s=new Cn(e,F.empty(),t,n);return i?s.En():s}Mn(e,t){let n=new jo(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(let u of s)n.pn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2,i=this.Fn(t);return S.forEach(i,s=>this.Mn(e,s).next(a=>{a?n!==0&&a.fields.length<function(c){let h=new re(me.comparator),f=!1;for(let g of c.filters)for(let y of g.getFlattenedFilters())y.field.isKeyField()||(y.op==="array-contains"||y.op==="array-contains-any"?f=!0:h=h.add(y.field));for(let g of c.orderBy)g.field.isKeyField()||(h=h.add(g.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(t)&&i.length>1&&n===2?1:n)}qn(e,t){let n=new Pn;for(let i of An(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let a=n.hn(i.kind);At.Ut.bt(s,a)}return n.an()}Bn(e){let t=new Pn;return At.Ut.bt(e,t.hn(0)),t.an()}Qn(e,t){let n=new Pn;return At.Ut.bt(Nn(this.databaseId,t),n.hn(function(s){let a=An(s);return a.length===0?0:a[a.length-1].kind}(e))),n.an()}On(e,t,n){if(n===null)return[];let i=[];i.push(new Pn);let s=0;for(let a of An(e)){let u=n[s++];for(let c of i)if(this.$n(t,a.fieldPath)&&ts(u))i=this.Un(i,a,u);else{let h=c.hn(a.kind);At.Ut.bt(u,h)}}return this.Kn(i)}xn(e,t,n){return this.On(e,t,n.position)}Kn(e){let t=[];for(let n=0;n<e.length;++n)t[n]=e[n].an();return t}Un(e,t,n){let i=[...e],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let c=new Pn;c.seed(u.an()),At.Ut.bt(a,c.hn(t.kind)),s.push(c)}return s}$n(e,t){return!!e.filters.find(n=>n instanceof H&&n.field.isEqual(t)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(e,t){let n=ki(e),i=dr(e);return(t?n.j(cc,IDBKeyRange.bound(t,t)):n.j()).next(s=>{let a=[];return S.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,g){let y=g?new Wi(g.sequenceNumber,new Ye(qn(g.readTime),new F(lt(g.documentKey)),g.largestBatchId)):Wi.empty(),A=f.fields.map(([x,k])=>new vr(me.fromServerFormat(x),k));return new br(f.indexId,f.collectionGroup,A,y)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:G(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){let i=ki(e),s=dr(e);return this.Wn(e).next(a=>i.j(cc,IDBKeyRange.bound(t,t)).next(u=>S.forEach(u,c=>s.put(Am(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){let n=new Map;return S.forEach(t,(i,s)=>{let a=n.get(i.collectionGroup);return(a?S.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),S.forEach(u,c=>this.Gn(e,i,c).next(h=>{let f=this.zn(s,c);return h.isEqual(f)?S.resolve():this.jn(e,s,c,h,f)}))))})}Jn(e,t,n,i){return hr(e).put(i.An(this.uid,this.Qn(n,t.key),t.key))}Hn(e,t,n,i){return hr(e).delete(i.Rn(this.uid,this.Qn(n,t.key),t.key))}Gn(e,t,n){let i=hr(e),s=new re($t);return i.X({index:vg,range:IDBKeyRange.only([n.indexId,this.uid,_o(this.Qn(n,t))])},(a,u)=>{s=s.add(new Cn(n.indexId,t,Cm(u.arrayValue),Cm(u.directionalValue)))}).next(()=>s)}zn(e,t){let n=new re($t),i=this.qn(t,e);if(i==null)return n;let s=rc(t);if(s!=null){let a=e.data.field(s.fieldPath);if(ts(a))for(let u of a.arrayValue.values||[])n=n.add(new Cn(t.indexId,e.key,this.Bn(u),i))}else n=n.add(new Cn(t.indexId,e.key,ao,i));return n}jn(e,t,n,i,s){N(Vm,"Updating index entries for document '%s'",t.key);let a=[];return function(c,h,f,g,y){let A=c.getIterator(),x=h.getIterator(),k=cr(A),V=cr(x);for(;k||V;){let z=!1,B=!1;if(k&&V){let M=f(k,V);M<0?B=!0:M>0&&(z=!0)}else k!=null?B=!0:z=!0;z?(g(V),V=cr(x)):B?(y(k),k=cr(A)):(k=cr(A),V=cr(x))}}(i,s,$t,u=>{a.push(this.Jn(e,t,n,u))},u=>{a.push(this.Hn(e,t,n,u))}),S.waitFor(a)}Wn(e){let t=1;return dr(e).X({index:wg,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>$t(a,u)).filter((a,u,c)=>!u||$t(a,c[u-1])!==0);let i=[];i.push(e);for(let a of n){let u=$t(a,e),c=$t(a,t);if(u===0)i[0]=e.En();else if(u>0&&c<0)i.push(a),i.push(a.En());else if(c>0)break}i.push(t);let s=[];for(let a=0;a<i.length;a+=2){if(this.Yn(i[a],i[a+1]))return[];let u=i[a].Rn(this.uid,ao,F.empty()),c=i[a+1].Rn(this.uid,ao,F.empty());s.push(IDBKeyRange.bound(u,c))}return s}Yn(e,t){return $t(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(km)}getMinOffset(e,t){return S.mapArray(this.Fn(t),n=>this.Mn(e,n).next(i=>i||q(44426))).next(km)}};function xm(r){return Ie(r,Ji)}function hr(r){return Ie(r,Ui)}function ki(r){return Ie(r,ch)}function dr(r){return Ie(r,qi)}function km(r){U(r.length!==0,28825);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;oh(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ye(e.readTime,e.documentKey,t)}var Nm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},wp=41943040,ze=class r{static withCacheSize(e){return new r(e,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}};function vp(r,e,t){let n=r.store(nt),i=r.store(Sr),s=[],a=IDBKeyRange.only(t.batchId),u=0,c=n.X({range:a},(f,g,y)=>(u++,y.delete()));s.push(c.next(()=>{U(u===1,47070,{batchId:t.batchId})}));let h=[];for(let f of t.mutations){let g=pg(e,f.key.path,t.batchId);s.push(i.delete(g)),h.push(f.key)}return S.waitFor(s).next(()=>h)}function zo(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw q(14731);e=r.noDocument}return JSON.stringify(e).length}ze.DEFAULT_COLLECTION_PERCENTILE=10,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ze.DEFAULT=new ze(wp,ze.DEFAULT_COLLECTION_PERCENTILE,ze.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ze.DISABLED=new ze(-1,0,0);var $o=class r{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Zn={}}static yt(e,t,n,i){U(e.uid!=="",64387);let s=e.isAuthenticated()?e.uid:"";return new r(s,t,n,i)}checkEmpty(e){let t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gt(e).X({index:Dn,range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){let s=_r(e),a=Gt(e);return a.add({}).next(u=>{U(typeof u=="number",49019);let c=new rs(u,t,n,i),h=function(A,x,k){let V=k.baseMutations.map(B=>us(A.gt,B)),z=k.mutations.map(B=>us(A.gt,B));return{userId:x,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:V,mutations:z}}(this.serializer,this.userId,c),f=[],g=new re((y,A)=>G(y.canonicalString(),A.canonicalString()));for(let y of i){let A=pg(this.userId,y.key.path,u);g=g.add(y.key.path.popLast()),f.push(a.put(h)),f.push(s.put(A,bw))}return g.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.Zn[u]=c.keys()}),S.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return Gt(e).get(t).next(n=>n?(U(n.userId===this.userId,48,"Unexpected user for mutation batch",{userId:n.userId,batchId:t}),Rn(this.serializer,n)):null)}Xn(e,t){return this.Zn[t]?S.resolve(this.Zn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){let i=n.keys();return this.Zn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Gt(e).X({index:Dn,range:i},(a,u,c)=>{u.userId===this.userId&&(U(u.batchId>=n,47524,{er:n}),s=Rn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=Xt;return Gt(e).X({index:Dn,range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Xt],[this.userId,Number.POSITIVE_INFINITY]);return Gt(e).j(Dn,t).next(n=>n.map(i=>Rn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let n=ho(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return _r(e).X({range:i},(a,u,c)=>{let[h,f,g]=a,y=lt(f);if(h===this.userId&&t.path.isEqual(y))return Gt(e).get(g).next(A=>{if(!A)throw q(61480,{tr:a,batchId:g});U(A.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:A.userId,batchId:g}),s.push(Rn(this.serializer,A))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new re(G),i=[];return t.forEach(s=>{let a=ho(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=_r(e).X({range:u},(h,f,g)=>{let[y,A,x]=h,k=lt(A);y===this.userId&&s.path.isEqual(k)?n=n.add(x):g.done()});i.push(c)}),S.waitFor(i).next(()=>this.nr(e,n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=ho(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new re(G);return _r(e).X({range:a},(c,h,f)=>{let[g,y,A]=c,x=lt(y);g===this.userId&&n.isPrefixOf(x)?x.length===i&&(u=u.add(A)):f.done()}).next(()=>this.nr(e,u))}nr(e,t){let n=[],i=[];return t.forEach(s=>{i.push(Gt(e).get(s).next(a=>{if(a===null)throw q(35274,{batchId:s});U(a.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:a.userId,batchId:s}),n.push(Rn(this.serializer,a))}))}),S.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return vp(e.ce,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.rr(t.batchId)}),S.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}rr(e){delete this.Zn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return S.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return _r(e).X({range:n},(s,a,u)=>{if(s[0]===this.userId){let c=lt(s[1]);i.push(c)}else u.done()}).next(()=>{U(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(e,t){return Tp(e,this.userId,t)}sr(e){return Ep(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Xt,lastStreamToken:""})}};function Tp(r,e,t){let n=ho(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return _r(r).X({range:s,Z:!0},(u,c,h)=>{let[f,g,y]=u;f===e&&g===i&&(a=!0),h.done()}).next(()=>a)}function Gt(r){return Ie(r,nt)}function _r(r){return Ie(r,Sr)}function Ep(r){return Ie(r,Hi)}var Mr=class r{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new r(0)}static ur(){return new r(-1)}};var Kc=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.cr(e).next(t=>{let n=new Mr(t.highestTargetId);return t.highestTargetId=n.next(),this.lr(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.cr(e).next(t=>j.fromTimestamp(new se(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.cr(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.cr(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.lr(e,i)))}addTargetData(e,t){return this.hr(e,t).next(()=>this.cr(e).next(n=>(n.targetCount+=1,this.Pr(t,n),this.lr(e,n))))}updateTargetData(e,t){return this.hr(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>fr(e).delete(t.targetId)).next(()=>this.cr(e)).next(n=>(U(n.targetCount>0,8065),n.targetCount-=1,this.lr(e,n)))}removeTargets(e,t,n){let i=0,s=[];return fr(e).X((a,u)=>{let c=Mi(u);c.sequenceNumber<=t&&n.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>S.waitFor(s)).next(()=>i)}forEachTarget(e,t){return fr(e).X((n,i)=>{let s=Mi(i);t(s)})}cr(e){return Om(e).get(Ro).next(t=>(U(t!==null,2888),t))}lr(e,t){return Om(e).put(Ro,t)}hr(e,t){return fr(e).put(pp(this.serializer,t))}Pr(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.cr(e).next(t=>t.targetCount)}getTargetData(e,t){let n=Fn(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return fr(e).X({range:i,index:_g},(a,u,c)=>{let h=Mi(u);vs(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){let i=[],s=Wt(e);return t.forEach(a=>{let u=ke(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),S.waitFor(i)}removeMatchingKeys(e,t,n){let i=Wt(e);return S.forEach(t,s=>{let a=ke(s.path);return S.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){let n=Wt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){let n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Wt(e),s=Q();return i.X({range:n,Z:!0},(a,u,c)=>{let h=lt(a[1]),f=new F(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){let n=ke(t.path),i=IDBKeyRange.bound([n],[ug(n)],!1,!0),s=0;return Wt(e).X({index:uh,Z:!0,range:i},([a,u],c,h)=>{a!==0&&(s++,h.done())}).next(()=>s>0)}Et(e,t){return fr(e).get(t).next(n=>n?Mi(n):null)}};function fr(r){return Ie(r,Rr)}function Om(r){return Ie(r,kn)}function Wt(r){return Ie(r,Pr)}var Fm="LruGarbageCollector",Sv=1048576;function Mm([r,e],[t,n]){let i=G(r,t);return i===0?G(e,n):i}var Wc=class{constructor(e){this.Tr=e,this.buffer=new re(Mm),this.Ir=0}dr(){return++this.Ir}Er(e){let t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{let n=this.buffer.last();Mm(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}},Go=class{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(e){N(Fm,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>C(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){dn(t)?N(Fm,"Ignoring IndexedDB error during garbage collection: ",t):yield hn(t)}yield this.Rr(3e5)}))}},Qc=class{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(t===0)return S.resolve(He.ue);let n=new Wc(t);return this.Vr.forEachTarget(e,i=>n.Er(i.sequenceNumber)).next(()=>this.Vr.gr(e,i=>n.Er(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),S.resolve(Nm)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Nm):this.pr(e,t))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,i,s,a,u,c,h,f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(e,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(e,n,t))).next(g=>(s=g,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(g=>(h=Date.now(),mr()<=ut.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${g} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),S.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function Ip(r,e){return new Qc(r,e)}var Hc=class{constructor(e,t){this.db=e,this.garbageCollector=Ip(this,t)}mr(e){let t=this.yr(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}yr(e){let t=0;return this.gr(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}gr(e,t){return this.wr(e,(n,i)=>t(i))}addReference(e,t,n){return uo(e,n)}removeReference(e,t,n){return uo(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return uo(e,t)}Sr(e,t){return function(i,s){let a=!1;return Ep(i).ee(u=>Tp(i,u,s).next(c=>(c&&(a=!0),S.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(e,(a,u)=>{if(u<=t){let c=this.Sr(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,j.min()),Wt(e).delete(function(g){return[0,ke(g.path)]}(a))))});i.push(c)}}).next(()=>S.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return uo(e,t)}wr(e,t){let n=Wt(e),i,s=He.ue;return n.X({index:uh},([a,u],{path:c,sequenceNumber:h})=>{a===0?(s!==He.ue&&t(new F(lt(i)),s),s=h,i=c):s=He.ue}).next(()=>{s!==He.ue&&t(new F(lt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function uo(r,e){return Wt(r).put(function(n,i){return{targetId:0,path:ke(n.path),sequenceNumber:i}}(e,r.currentSequenceNumber))}var Ko=class{constructor(){this.changes=new it(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Te.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return n!==void 0?S.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Xc=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return In(e).put(n)}removeEntry(e,t,n){return In(e).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],qo(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.br(e,n)))}getEntry(e,t){let n=Te.newInvalidDocument(t);return In(e).X({index:fo,range:IDBKeyRange.only(Ni(t))},(i,s)=>{n=this.Dr(t,s)}).next(()=>n)}vr(e,t){let n={size:0,document:Te.newInvalidDocument(t)};return In(e).X({index:fo,range:IDBKeyRange.only(Ni(t))},(i,s)=>{n={document:this.Dr(t,s),size:zo(s)}}).next(()=>n)}getEntries(e,t){let n=$e();return this.Cr(e,t,(i,s)=>{let a=this.Dr(i,s);n=n.insert(i,a)}).next(()=>n)}Fr(e,t){let n=$e(),i=new ae(F.comparator);return this.Cr(e,t,(s,a)=>{let u=this.Dr(s,a);n=n.insert(s,u),i=i.insert(s,zo(a))}).next(()=>({documents:n,Mr:i}))}Cr(e,t,n){if(t.isEmpty())return S.resolve();let i=new re(Um);t.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(Ni(i.first()),Ni(i.last())),a=i.getIterator(),u=a.getNext();return In(e).X({index:fo,range:s},(c,h,f)=>{let g=F.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Um(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.G(Ni(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){let a=t.path,u=[a.popLast().toArray(),a.lastSegment(),qo(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return In(e).j(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=$e();for(let g of h){let y=this.Dr(F.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);y.isFoundDocument()&&(Es(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=$e(),a=qm(t,n),u=qm(t,Ye.max());return In(e).X({index:yg,range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{let g=this.Dr(F.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new Jc(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Lm(e).get(uc).next(t=>(U(!!t,20021),t))}br(e,t){return Lm(e).put(uc,t)}Dr(e,t){if(t){let n=Iv(this.serializer,t);if(!(n.isNoDocument()&&n.version.isEqual(j.min())))return n}return Te.newInvalidDocument(e)}};function Ap(r){return new Xc(r)}var Jc=class extends Ko{constructor(e,t){super(),this.Or=e,this.trackRemovals=t,this.Nr=new it(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){let t=[],n=0,i=new re((s,a)=>G(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.Nr.get(s);if(t.push(this.Or.removeEntry(e,s,u.readTime)),a.isValidDocument()){let c=Em(this.Or.serializer,a);i=i.add(s.path.popLast());let h=zo(c);n+=h-u.size,t.push(this.Or.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){let c=Em(this.Or.serializer,a.convertToNoDocument(j.min()));t.push(this.Or.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.Or.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Or.updateMetadata(e,n)),S.waitFor(t)}getFromCache(e,t){return this.Or.vr(e,t).next(n=>(this.Nr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.Or.Fr(e,t).next(({documents:n,Mr:i})=>(i.forEach((s,a)=>{this.Nr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function Lm(r){return Ie(r,Xi)}function In(r){return Ie(r,So)}function Ni(r){let e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function qm(r,e){let t=e.documentKey.path.toArray();return[r,qo(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Um(r,e){let t=r.path.toArray(),n=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=G(t[s],n[s]),i)return i;return i=G(t.length,n.length),i||(i=G(t[t.length-2],n[n.length-2]),i||G(t[t.length-1],n[n.length-1]))}var Yc=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Wo=class{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(n!==null&&zi(n.mutation,i,Xe.empty(),se.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,Q()).next(()=>n))}getLocalViewOfDocuments(e,t,n=Q()){let i=ht();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Fi();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){let n=ht();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,Q()))}populateOverlays(e,t,n){let i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=$e(),a=Bi(),u=function(){return Bi()}();return t.forEach((c,h)=>{let f=n.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof st)?s=s.insert(h.key,h):f!==void 0?(a.set(h.key,f.mutation.getFieldMask()),zi(f.mutation,h,f.mutation.getFieldMask(),se.now())):a.set(h.key,Xe.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var g;return u.set(h,new Yc(f,(g=a.get(h))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(e,t){let n=Bi(),i=new ae((a,u)=>a-u),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(let u of a)u.keys().forEach(c=>{let h=t.get(c);if(h===null)return;let f=n.get(c)||Xe.empty();f=u.applyToLocalView(h,f),n.set(c,f);let g=(i.get(u.batchId)||Q()).add(c);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,g=Wg();f.forEach(y=>{if(!s.has(y)){let A=ep(t.get(y),n.get(y));A!==null&&g.set(y,A),s=s.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,g))}return S.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gh(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):S.resolve(ht()),u=Ar,c=s;return a.next(h=>S.forEach(h,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?S.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{c=c.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,Q())).next(f=>({batchId:u,changes:Kg(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(n=>{let i=Fi();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){let s=t.collectionGroup,a=Fi();return this.indexManager.getCollectionParents(e,s).next(u=>S.forEach(u,c=>{let h=function(g,y){return new rt(y,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((g,y)=>{a=a.insert(g,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{let f=h.getKey();a.get(f)===null&&(a=a.insert(f,Te.newInvalidDocument(f)))});let u=Fi();return a.forEach((c,h)=>{let f=s.get(c);f!==void 0&&zi(f.mutation,h,Xe.empty(),se.now()),Es(t,h)&&(u=u.insert(c,h))}),u})}};var Zc=class{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return S.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ge(i.createTime)}}(t)),S.resolve()}getNamedQuery(e,t){return S.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(i){return{name:i.name,query:wh(i.bundledQuery),readTime:ge(i.readTime)}}(t)),S.resolve()}};var el=class{constructor(){this.overlays=new ae(F.comparator),this.kr=new Map}getOverlay(e,t){return S.resolve(this.overlays.get(t))}getOverlays(e,t){let n=ht();return S.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.wt(e,t,s)}),S.resolve()}removeOverlaysForBatchId(e,t,n){let i=this.kr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(n)),S.resolve()}getOverlaysForCollection(e,t,n){let i=ht(),s=t.length+1,a=new F(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return S.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new ae((h,f)=>h-f),a=this.overlays.getIterator();for(;a.hasNext();){let h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);f===null&&(f=ht(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=ht(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return S.resolve(u)}wt(e,t,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.kr.get(i.largestBatchId).delete(n.key);this.kr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new is(t,n));let s=this.kr.get(t);s===void 0&&(s=Q(),this.kr.set(t,s)),this.kr.set(t,s.add(n.key))}};var tl=class{constructor(){this.sessionToken=pe.EMPTY_BYTE_STRING}getSessionToken(e){return S.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,S.resolve()}};var ls=class{constructor(){this.qr=new re(_e.Qr),this.$r=new re(_e.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){let n=new _e(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Wr(new _e(e,t))}Gr(e,t){e.forEach(n=>this.removeReference(n,t))}zr(e){let t=new F(new X([])),n=new _e(t,e),i=new _e(t,e+1),s=[];return this.$r.forEachInRange([n,i],a=>{this.Wr(a),s.push(a.key)}),s}jr(){this.qr.forEach(e=>this.Wr(e))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){let t=new F(new X([])),n=new _e(t,e),i=new _e(t,e+1),s=Q();return this.$r.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){let t=new _e(e,0),n=this.qr.firstAfterOrEqual(t);return n!==null&&e.isEqual(n.key)}},_e=class{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return F.comparator(e.key,t.key)||G(e.Hr,t.Hr)}static Ur(e,t){return G(e.Hr,t.Hr)||F.comparator(e.key,t.key)}};var nl=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new re(_e.Qr)}checkEmpty(e){return S.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,n,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new rs(s,t,n,i);this.mutationQueue.push(a);for(let u of i)this.Yr=this.Yr.add(new _e(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return S.resolve(a)}lookupMutationBatch(e,t){return S.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){let n=t+1,i=this.Xr(n),s=i<0?0:i;return S.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return S.resolve(this.mutationQueue.length===0?Xt:this.er-1)}getAllMutationBatches(e){return S.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new _e(t,0),i=new _e(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([n,i],a=>{let u=this.Zr(a.Hr);s.push(u)}),S.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new re(G);return t.forEach(i=>{let s=new _e(i,0),a=new _e(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,a],u=>{n=n.add(u.Hr)})}),S.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,i=n.length+1,s=n;F.isDocumentKey(s)||(s=s.child(""));let a=new _e(new F(s),0),u=new re(G);return this.Yr.forEachWhile(c=>{let h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Hr)),!0)},a),S.resolve(this.ei(u))}ei(e){let t=[];return e.forEach(n=>{let i=this.Zr(n);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){U(this.ti(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let n=this.Yr;return S.forEach(t.mutations,i=>{let s=new _e(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.Yr=n})}rr(e){}containsKey(e,t){let n=new _e(t,0),i=this.Yr.firstAfterOrEqual(n);return S.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,S.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Zr(e){let t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var rl=class{constructor(e){this.ni=e,this.docs=function(){return new ae(F.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return S.resolve(n?n.document.mutableCopy():Te.newInvalidDocument(t))}getEntries(e,t){let n=$e();return t.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():Te.newInvalidDocument(i))}),S.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=$e(),a=t.path,u=new F(a.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||oh(dg(f),n)<=0||(i.has(f.key)||Es(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return S.resolve(s)}getAllFromCollectionGroup(e,t,n,i){q(9500)}ri(e,t){return S.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new il(this)}getSize(e){return S.resolve(this.size)}},il=class extends Ko{constructor(e){super(),this.Or=e}applyChanges(e){let t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(n)}),S.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}};var sl=class{constructor(e){this.persistence=e,this.ii=new it(t=>Fn(t),vs),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.si=0,this.oi=new ls,this.targetCount=0,this._i=Mr.ar()}forEachTarget(e,t){return this.ii.forEach((n,i)=>t(i)),S.resolve()}getLastRemoteSnapshotVersion(e){return S.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return S.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),S.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),S.resolve()}hr(e){this.ii.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this._i=new Mr(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,S.resolve()}updateTargetData(e,t){return this.hr(t),S.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,S.resolve()}removeTargets(e,t,n){let i=0,s=[];return this.ii.forEach((a,u)=>{u.sequenceNumber<=t&&n.get(u.targetId)===null&&(this.ii.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),S.waitFor(s).next(()=>i)}getTargetCount(e){return S.resolve(this.targetCount)}getTargetData(e,t){let n=this.ii.get(t)||null;return S.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),S.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),S.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),S.resolve()}getMatchingKeysForTargetId(e,t){let n=this.oi.Jr(t);return S.resolve(n)}containsKey(e,t){return S.resolve(this.oi.containsKey(t))}};var hs=class{constructor(e,t){this.ai={},this.overlays={},this.ui=new He(0),this.ci=!1,this.ci=!0,this.li=new tl,this.referenceDelegate=e(this),this.hi=new sl(this),this.indexManager=new $c,this.remoteDocumentCache=function(i){return new rl(i)}(n=>this.referenceDelegate.Pi(n)),this.serializer=new Lo(t),this.Ti=new Zc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new el,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new nl(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){N("MemoryPersistence","Starting transaction:",e);let i=new ol(this.ui.next());return this.referenceDelegate.Ii(),n(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(e,t){return S.or(Object.values(this.ai).map(n=>()=>n.containsKey(e,t)))}},ol=class extends Io{constructor(e){super(),this.currentSequenceNumber=e}},Qo=class r{constructor(e){this.persistence=e,this.Ai=new ls,this.Ri=null}static Vi(e){return new r(e)}get mi(){if(this.Ri)return this.Ri;throw q(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),S.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),S.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),S.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach(i=>this.mi.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}Ii(){this.Ri=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return S.forEach(this.mi,n=>{let i=F.fromPath(n);return this.fi(e,i).next(s=>{s||t.removeEntry(i,j.min())})}).next(()=>(this.Ri=null,t.apply(e)))}updateLimboDocument(e,t){return this.fi(e,t).next(n=>{n?this.mi.delete(t.toString()):this.mi.add(t.toString())})}Pi(e){return 0}fi(e,t){return S.or([()=>S.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}},Ho=class r{constructor(e,t){this.persistence=e,this.gi=new it(n=>ke(n.path),(n,i)=>n.isEqual(i)),this.garbageCollector=Ip(this,t)}static Vi(e,t){return new r(e,t)}Ii(){}di(e){return S.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){let t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}yr(e){let t=0;return this.gr(e,n=>{t++}).next(()=>t)}gr(e,t){return S.forEach(this.gi,(n,i)=>this.Sr(e,n,i).next(s=>s?S.resolve():t(i)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,a=>this.Sr(e,a,t).next(u=>{u||(n++,s.removeEntry(a,j.min()))})).next(()=>s.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),S.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),S.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),S.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),S.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=go(e.data.value)),t}Sr(e,t,n){return S.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let i=this.gi.get(t);return S.resolve(i!==void 0&&i>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}};var al=class{constructor(e){this.serializer=e}q(e,t,n,i){let s=new Ao("createOrUpgrade",t);n<1&&i>=1&&(function(c){c.createObjectStore(ws)}(e),function(c){c.createObjectStore(Hi,{keyPath:Aw}),c.createObjectStore(nt,{keyPath:Zf,autoIncrement:!0}).createIndex(Dn,em,{unique:!0}),c.createObjectStore(Sr)}(e),jm(e),function(c){c.createObjectStore(bn)}(e));let a=S.resolve();return n<3&&i>=3&&(n!==0&&(function(c){c.deleteObjectStore(Pr),c.deleteObjectStore(Rr),c.deleteObjectStore(kn)}(e),jm(e)),a=a.next(()=>function(c){let h=c.store(kn),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return h.put(Ro,f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(c,h){return h.store(nt).j().next(g=>{c.deleteObjectStore(nt),c.createObjectStore(nt,{keyPath:Zf,autoIncrement:!0}).createIndex(Dn,em,{unique:!0});let y=h.store(nt),A=g.map(x=>y.put(x));return S.waitFor(A)})}(e,s))),a=a.next(()=>{(function(c){c.createObjectStore(Cr,{keyPath:kw})})(e)})),n<5&&i>=5&&(a=a.next(()=>this.pi(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore(Xi)}(e),this.yi(s)))),n<7&&i>=7&&(a=a.next(()=>this.wi(s))),n<8&&i>=8&&(a=a.next(()=>this.Si(e,s))),n<9&&i>=9&&(a=a.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),n<10&&i>=10&&(a=a.next(()=>this.bi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore(Ea,{keyPath:Nw})})(e),function(c){c.createObjectStore(Ia,{keyPath:Ow})}(e)})),n<12&&i>=12&&(a=a.next(()=>{(function(c){let h=c.createObjectStore(Aa,{keyPath:Bw});h.createIndex(lc,zw,{unique:!1}),h.createIndex(Tg,$w,{unique:!1})})(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){let h=c.createObjectStore(So,{keyPath:Sw});h.createIndex(fo,Rw),h.createIndex(yg,Pw)}(e)).next(()=>this.Di(e,s)).next(()=>e.deleteObjectStore(bn))),n<14&&i>=14&&(a=a.next(()=>this.Ci(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore(ch,{keyPath:Fw,autoIncrement:!0}).createIndex(cc,Mw,{unique:!1}),c.createObjectStore(qi,{keyPath:Lw}).createIndex(wg,qw,{unique:!1}),c.createObjectStore(Ui,{keyPath:Uw}).createIndex(vg,jw,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore(qi).clear()}).next(()=>{t.objectStore(Ui).clear()})),n<17&&i>=17&&(a=a.next(()=>{(function(c){c.createObjectStore(lh,{keyPath:Gw})})(e)})),n<18&&i>=18&&vu()&&(a=a.next(()=>{t.objectStore(qi).clear()}).next(()=>{t.objectStore(Ui).clear()})),a}yi(e){let t=0;return e.store(bn).X((n,i)=>{t+=zo(i)}).next(()=>{let n={byteSize:t};return e.store(Xi).put(uc,n)})}pi(e){let t=e.store(Hi),n=e.store(nt);return t.j().next(i=>S.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,Xt],[s.userId,s.lastAcknowledgedBatchId]);return n.j(Dn,a).next(u=>S.forEach(u,c=>{U(c.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let h=Rn(this.serializer,c);return vp(e,s.userId,h).next(()=>{})}))}))}wi(e){let t=e.store(Pr),n=e.store(bn);return e.store(kn).get(Ro).next(i=>{let s=[];return n.X((a,u)=>{let c=new X(a),h=function(g){return[0,ke(g)]}(c);s.push(t.get(h).next(f=>f?S.resolve():(g=>t.put({targetId:0,path:ke(g),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>S.waitFor(s))})}Si(e,t){e.createObjectStore(Ji,{keyPath:xw});let n=t.store(Ji),i=new cs,s=a=>{if(i.add(a)){let u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:ke(c)})}};return t.store(bn).X({Z:!0},(a,u)=>{let c=new X(a);return s(c.popLast())}).next(()=>t.store(Sr).X({Z:!0},([a,u,c],h)=>{let f=lt(u);return s(f.popLast())}))}bi(e){let t=e.store(Rr);return t.X((n,i)=>{let s=Mi(i),a=pp(this.serializer,s);return t.put(a)})}Di(e,t){let n=t.store(bn),i=[];return n.X((s,a)=>{let u=t.store(So),c=function(g){return g.document?new F(X.fromString(g.document.name).popFirst(5)):g.noDocument?F.fromSegments(g.noDocument.path):g.unknownDocument?F.fromSegments(g.unknownDocument.path):q(36783)}(a).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(h))}).next(()=>S.waitFor(i))}Ci(e,t){let n=t.store(nt),i=Ap(this.serializer),s=new hs(Qo.Vi,this.serializer.gt);return n.j().next(a=>{let u=new Map;return a.forEach(c=>{var h;let f=(h=u.get(c.userId))!==null&&h!==void 0?h:Q();Rn(this.serializer,c).keys().forEach(g=>f=f.add(g)),u.set(c.userId,f)}),S.forEach(u,(c,h)=>{let f=new we(h),g=Uo.yt(this.serializer,f),y=s.getIndexManager(f),A=$o.yt(f,this.serializer,y,s.referenceDelegate);return new Wo(i,A,g,y).recalculateAndSaveOverlaysForDocumentKeys(new Yi(t,He.ue),c).next()})})}};function jm(r){r.createObjectStore(Pr,{keyPath:Dw}).createIndex(uh,Vw,{unique:!0}),r.createObjectStore(Rr,{keyPath:"targetId"}).createIndex(_g,Cw,{unique:!0}),r.createObjectStore(kn)}var Kt="IndexedDbPersistence",$u=18e5,Gu=5e3,Ku="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",bp="main",ul=class r{constructor(e,t,n,i,s,a,u,c,h,f,g=18){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.Fi=s,this.window=a,this.document=u,this.Mi=h,this.xi=f,this.Oi=g,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=y=>Promise.resolve(),!r.C())throw new D(R.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Hc(this,i),this.Qi=t+bp,this.serializer=new Lo(c),this.$i=new en(this.Qi,this.Oi,new al(this.serializer)),this.li=new Mc,this.hi=new Kc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Ap(this.serializer),this.Ti=new Fc,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&fe(Kt,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,Ku);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.hi.getHighestSequenceNumber(e))}).then(e=>{this.ui=new He(e,this.Mi)}).then(()=>{this.ci=!0}).catch(e=>(this.$i&&this.$i.close(),Promise.reject(e)))}ji(e){return this.qi=t=>C(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.$i.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Fi.enqueueAndForget(()=>C(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>co(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(e).next(t=>{t||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(e)).next(t=>this.isPrimary&&!t?this.Yi(e).next(()=>!1):!!t&&this.Zi(e).next(()=>!0))).catch(e=>{if(dn(e))return N(Kt,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N(Kt,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Fi.enqueueRetryable(()=>this.qi(e)),this.isPrimary=e})}Ji(e){return Oi(e).get(ur).next(t=>S.resolve(this.Xi(t)))}es(e){return co(e).delete(this.clientId)}ts(){return C(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,$u)){this.ki=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let n=Ie(t,Cr);return n.j().next(i=>{let s=this.rs(i,$u),a=i.filter(u=>s.indexOf(u)===-1);return S.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ui)for(let t of e)this.Ui.removeItem(this.ss(t.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(e){return!!e&&e.ownerId===this.clientId}Hi(e){return this.xi?S.resolve(!0):Oi(e).get(ur).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,Gu)&&!this._s(t.ownerId)){if(this.Xi(t)&&this.networkEnabled)return!0;if(!this.Xi(t)){if(!t.allowTabSynchronization)throw new D(R.FAILED_PRECONDITION,Ku);return!1}}return!(!this.networkEnabled||!this.inForeground)||co(e).j().next(n=>this.rs(n,Gu).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&N(Kt,`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return C(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[ws,Cr],e=>{let t=new Yi(e,He.ue);return this.Yi(t).next(()=>this.es(t))}),this.$i.close(),this.hs()})}rs(e,t){return e.filter(n=>this.ns(n.updateTimeMs,t)&&!this._s(n.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",e=>co(e).j().next(t=>this.rs(t,$u).map(n=>n.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(e,t){return $o.yt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Gc(e,this.serializer.gt.databaseId)}getDocumentOverlayCache(e){return Uo.yt(this.serializer,e)}getBundleCache(){return this.Ti}runTransaction(e,t,n){N(Kt,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===18?Qw:c===17?bg:c===16?Ww:c===15?hh:c===14?Ag:c===13?Ig:c===12?Kw:c===11?Eg:void q(60245)}(this.Oi),a;return this.$i.runTransaction(e,i,s,u=>(a=new Yi(u,this.ui?this.ui.next():He.ue),t==="readwrite-primary"?this.Ji(a).next(c=>!!c||this.Hi(a)).next(c=>{if(!c)throw fe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new D(R.FAILED_PRECONDITION,fg);return n(a)}).next(c=>this.Zi(a).next(()=>c)):this.Ts(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ts(e){return Oi(e).get(ur).next(t=>{if(t!==null&&this.ns(t.leaseTimestampMs,Gu)&&!this._s(t.ownerId)&&!this.Xi(t)&&!(this.xi||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(R.FAILED_PRECONDITION,Ku)})}Zi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Oi(e).put(ur,t)}static C(){return en.C()}Yi(e){let t=Oi(e);return t.get(ur).next(n=>this.Xi(n)?(N(Kt,"Releasing primary lease."),t.delete(ur)):S.resolve())}ns(e,t){let n=Date.now();return!(e<n-t)&&(!(e>n)||(fe(`Detected an update time that is in the future: ${e} > ${n}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Ni=()=>{this.us();let t=/(?:Version|Mobile)\/1[456]/;wu()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(e){var t;try{let n=((t=this.Ui)===null||t===void 0?void 0:t.getItem(this.ss(e)))!==null;return N(Kt,`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return fe(Kt,"Failed to get zombied client id.",n),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(e){fe("Failed to set zombie client id.",e)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function Oi(r){return Ie(r,ws)}function co(r){return Ie(r,Cr)}function Th(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}var cl=class r{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=i}static Es(e,t){let n=Q(),i=Q();for(let s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(e,t.fromCache,n,i)}};var ll=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Xo=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=function(){return wu()?8:mg(bi())>0?6:4}()}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,i){let s={result:null};return this.ps(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ys(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new ll;return this.ws(e,t,a).next(u=>{if(s.result=u,this.Rs)return this.Ss(e,t,a,u.size)})}).next(()=>s.result)}Ss(e,t,n,i){return n.documentReadCount<this.Vs?(mr()<=ut.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",gr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),S.resolve()):(mr()<=ut.DEBUG&&N("QueryEngine","Query:",gr(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.fs*i?(mr()<=ut.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",gr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,qe(t))):S.resolve())}ps(e,t){if(dm(t))return S.resolve(null);let n=qe(t);return this.indexManager.getIndexType(e,n).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=No(t,null,"F"),n=qe(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{let a=Q(...s);return this.gs.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{let h=this.bs(t,u);return this.Ds(t,h,a,c.readTime)?this.ps(e,No(t,null,"F")):this.vs(e,h,t,c)}))})))}ys(e,t,n,i){return dm(t)||i.isEqual(j.min())?S.resolve(null):this.gs.getDocuments(e,n).next(s=>{let a=this.bs(t,s);return this.Ds(t,a,n,i)?S.resolve(null):(mr()<=ut.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),gr(t)),this.vs(e,a,t,hg(i,Ar)).next(u=>u))})}bs(e,t){let n=new re($g(e));return t.forEach((i,s)=>{Es(e,s)&&(n=n.add(s))}),n}Ds(e,t,n,i){if(e.limit===null)return!1;if(n.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,n){return mr()<=ut.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",gr(t)),this.gs.getDocumentsMatchingQuery(e,t,Ye.min(),n)}vs(e,t,n,i){return this.gs.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}};var Eh="LocalStore",Rv=3e8,hl=class{constructor(e,t,n,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new ae(G),this.Ms=new it(s=>Fn(s),vs),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Wo(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Fs))}};function Sp(r,e,t,n){return new hl(r,e,t,n)}function Rp(r,e){return C(this,null,function*(){let t=L(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.Ns(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],c=Q();for(let h of i){a.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of s){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({Bs:h,removedBatchIds:a,addedBatchIds:u}))})})})}function Pv(r,e){let t=L(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=e.batch.keys(),s=t.Os.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){let g=h.batch,y=g.keys(),A=S.resolve();return y.forEach(x=>{A=A.next(()=>f.getEntry(c,x)).next(k=>{let V=h.docVersions.get(x);U(V!==null,48541),k.version.compareTo(V)<0&&(g.applyToRemoteDocument(k,h),k.isValidDocument()&&(k.setReadTime(h.commitVersion),f.addEntry(k)))})}),A.next(()=>u.mutationQueue.removeMutationBatch(c,g))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=Q();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}function Pp(r){let e=L(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.hi.getLastRemoteSnapshotVersion(t))}function Cv(r,e){let t=L(r),n=e.snapshotVersion,i=t.Fs;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=t.Os.newChangeBuffer({trackRemovals:!0});i=t.Fs;let u=[];e.targetChanges.forEach((f,g)=>{let y=i.get(g);if(!y)return;u.push(t.hi.removeMatchingKeys(s,f.removedDocuments,g).next(()=>t.hi.addMatchingKeys(s,f.addedDocuments,g)));let A=y.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(g)!==null?A=A.withResumeToken(pe.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):f.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(f.resumeToken,n)),i=i.insert(g,A),function(k,V,z){return k.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=Rv?!0:z.addedDocuments.size+z.modifiedDocuments.size+z.removedDocuments.size>0}(y,A,f)&&u.push(t.hi.updateTargetData(s,A))});let c=$e(),h=Q();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Cp(s,a,e.documentUpdates).next(f=>{c=f.Ls,h=f.ks})),!n.isEqual(j.min())){let f=t.hi.getLastRemoteSnapshotVersion(s).next(g=>t.hi.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return S.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.Fs=i,s))}function Cp(r,e,t){let n=Q(),i=Q();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=$e();return t.forEach((u,c)=>{let h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(j.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):N(Eh,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ls:a,ks:i}})}function Dv(r,e){let t=L(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(e===void 0&&(e=Xt),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function Lr(r,e){let t=L(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.hi.getTargetData(n,e).next(s=>s?(i=s,S.resolve(i)):t.hi.allocateTargetId(n).next(a=>(i=new Fr(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.hi.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=t.Fs.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.Fs=t.Fs.insert(n.targetId,n),t.Ms.set(e,n.targetId)),n})}function qr(r,e,t){return C(this,null,function*(){let n=L(r),i=n.Fs.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!dn(a))throw a;N(Eh,`Failed to update sequence numbers for target ${e}: ${a}`)}n.Fs=n.Fs.remove(e),n.Ms.delete(i.target)})}function Jo(r,e,t){let n=L(r),i=j.min(),s=Q();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){let g=L(c),y=g.Ms.get(f);return y!==void 0?S.resolve(g.Fs.get(y)):g.hi.getTargetData(h,f)}(n,a,qe(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.hi.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.Cs.getDocumentsMatchingQuery(a,e,t?i:j.min(),t?s:Q())).next(u=>(xp(n,zg(e),u),{documents:u,qs:s})))}function Dp(r,e){let t=L(r),n=L(t.hi),i=t.Fs.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.Et(s,e).next(a=>a?a.target:null))}function Vp(r,e){let t=L(r),n=t.xs.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Os.getAllFromCollectionGroup(i,e,hg(n,Ar),Number.MAX_SAFE_INTEGER)).then(i=>(xp(t,e,i),i))}function xp(r,e,t){let n=r.xs.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.xs.set(e,n)}function Vv(r,e,t,n){return C(this,null,function*(){let i=L(r),s=Q(),a=$e();for(let h of t){let f=e.Qs(h.metadata.name);h.document&&(s=s.add(f));let g=e.$s(h);g.setReadTime(e.Us(h.metadata.readTime)),a=a.insert(f,g)}let u=i.Os.newChangeBuffer({trackRemovals:!0}),c=yield Lr(i,function(f){return qe(Wr(X.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Cp(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.hi.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.hi.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ls,f.ks)).next(()=>f.Ls)))})}function xv(n,i){return C(this,arguments,function*(r,e,t=Q()){let s=yield Lr(r,qe(wh(e.bundledQuery))),a=L(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let c=ge(e.readTime);if(s.snapshotVersion.compareTo(c)>=0)return a.Ti.saveNamedQuery(u,e);let h=s.withResumeToken(pe.EMPTY_BYTE_STRING,c);return a.Fs=a.Fs.insert(h.targetId,h),a.hi.updateTargetData(u,h).next(()=>a.hi.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.hi.addMatchingKeys(u,t,s.targetId)).next(()=>a.Ti.saveNamedQuery(u,e))})})}var kp="firestore_clients";function Bm(r,e){return`${kp}_${r}_${e}`}var Np="firestore_mutations";function zm(r,e,t){let n=`${Np}_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}var Op="firestore_targets";function Wu(r,e){return`${Op}_${r}_${e}`}var ct="SharedClientState",Yo=class r{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Ks(e,t,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new D(i.error.code,i.error.message))),a?new r(e,t,i.state,s):(fe(ct,`Failed to parse mutation state for ID '${t}': ${n}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},$i=class r{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Ks(e,t){let n=JSON.parse(t),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new D(n.error.code,n.error.message))),s?new r(e,n.state,i):(fe(ct,`Failed to parse target state for ID '${e}': ${t}`),null)}Ws(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Zo=class r{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ks(e,t){let n=JSON.parse(t),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=ph();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=gg(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(e,s):(fe(ct,`Failed to parse client data for instance '${e}': ${t}`),null)}},dl=class r{constructor(e,t){this.clientId=e,this.onlineState=t}static Ks(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new r(t.clientId,t.onlineState):(fe(ct,`Failed to parse online state: ${e}`),null)}},ds=class{constructor(){this.activeTargetIds=ph()}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},Gi=class{constructor(e,t,n,i,s){this.window=e,this.Fi=t,this.persistenceKey=n,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new ae(G),this.started=!1,this.Zs=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=Bm(this.persistenceKey,this.js),this.eo=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new ds),this.no=new RegExp(`^${kp}_${a}_([^_]*)$`),this.ro=new RegExp(`^${Np}_${a}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Op}_${a}_(\\d+)$`),this.so=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.oo=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(e){return!(!e||!e.localStorage)}start(){return C(this,null,function*(){let e=yield this.syncEngine.Ps();for(let n of e){if(n===this.js)continue;let i=this.getItem(Bm(this.persistenceKey,n));if(i){let s=Zo.Ks(n,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let t=this.storage.getItem(this.so);if(t){let n=this.ao(t);n&&this.uo(n)}for(let n of this.Zs)this.Hs(n);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.eo,JSON.stringify(e))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(e){let t=!1;return this.Ys.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.lo(e,"pending")}updateMutationState(e,t,n){this.lo(e,t,n),this.ho(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){let i=this.storage.getItem(Wu(this.persistenceKey,e));if(i){let s=$i.Ks(e,i);s&&(n=s.state)}}return t&&this.Po.Gs(e),this._o(),n}removeLocalQueryTarget(e){this.Po.zs(e),this._o()}isLocalQueryTarget(e){return this.Po.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Wu(this.persistenceKey,e))}updateQueryState(e,t,n){this.To(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.ho(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Io(e)}notifyBundleLoaded(e){this.Eo(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return N(ct,"READ",e,t),t}setItem(e,t){N(ct,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){N(ct,"REMOVE",e),this.storage.removeItem(e)}Hs(e){let t=e;if(t.storageArea===this.storage){if(N(ct,"EVENT",t.key,t.newValue),t.key===this.Xs)return void fe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>C(this,null,function*(){if(this.started){if(t.key!==null){if(this.no.test(t.key)){if(t.newValue==null){let n=this.Ao(t.key);return this.Ro(n,null)}{let n=this.Vo(t.key,t.newValue);if(n)return this.Ro(n.clientId,n)}}else if(this.ro.test(t.key)){if(t.newValue!==null){let n=this.mo(t.key,t.newValue);if(n)return this.fo(n)}}else if(this.io.test(t.key)){if(t.newValue!==null){let n=this.po(t.key,t.newValue);if(n)return this.yo(n)}}else if(t.key===this.so){if(t.newValue!==null){let n=this.ao(t.newValue);if(n)return this.uo(n)}}else if(t.key===this.eo){let n=function(s){let a=He.ue;if(s!=null)try{let u=JSON.parse(s);U(typeof u=="number",30636,{wo:s}),a=u}catch(u){fe(ct,"Failed to read sequence number from WebStorage",u)}return a}(t.newValue);n!==He.ue&&this.sequenceNumberHandler(n)}else if(t.key===this.oo){let n=this.So(t.newValue);yield Promise.all(n.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(t)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(e,t,n){let i=new Yo(this.currentUser,e,t,n),s=zm(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Ws())}ho(e){let t=zm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Io(e){let t={clientId:this.js,onlineState:e};this.storage.setItem(this.so,JSON.stringify(t))}To(e,t,n){let i=Wu(this.persistenceKey,e),s=new $i(e,t,n);this.setItem(i,s.Ws())}Eo(e){let t=JSON.stringify(Array.from(e));this.setItem(this.oo,t)}Ao(e){let t=this.no.exec(e);return t?t[1]:null}Vo(e,t){let n=this.Ao(e);return Zo.Ks(n,t)}mo(e,t){let n=this.ro.exec(e),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return Yo.Ks(new we(s),i,t)}po(e,t){let n=this.io.exec(e),i=Number(n[1]);return $i.Ks(i,t)}ao(e){return dl.Ks(e)}So(e){return JSON.parse(e)}fo(e){return C(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Do(e.batchId,e.state,e.error);N(ct,`Ignoring mutation for non-active user ${e.user.uid}`)})}yo(e){return this.syncEngine.vo(e.targetId,e.state,e.error)}Ro(e,t){let n=t?this.Ys.insert(e,t):this.Ys.remove(e),i=this.co(this.Ys),s=this.co(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.Co(a,u).then(()=>{this.Ys=n})}uo(e){this.Ys.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}co(e){let t=ph();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},ea=class{constructor(){this.Fo=new ds,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new ds,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var fl=class{xo(e){}shutdown(){}};var $m="ConnectivityMonitor",ta=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){N($m,"Network connectivity changed: AVAILABLE");for(let e of this.ko)e(0)}Lo(){N($m,"Network connectivity changed: UNAVAILABLE");for(let e of this.ko)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var lo=null;function ml(){return lo===null?lo=function(){return 268435456+Math.round(2147483648*Math.random())}():lo++,"0x"+lo.toString(16)}var Qu="RestConnection",kv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},gl=class{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${i}`,this.Ko=this.databaseId.database===dc?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Wo(e,t,n,i,s){let a=ml(),u=this.Go(e,t.toUriEncodedString());N(Qu,`Sending RPC '${e}' ${a}:`,u,n);let c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,i,s);let{host:h}=new URL(u),f=_u(h);return this.jo(e,u,c,n,f).then(g=>(N(Qu,`Received RPC '${e}' ${a}: `,g),g),g=>{throw Ke(Qu,`RPC '${e}' ${a} failed with error: `,g,"url: ",u,"request:",n),g})}Jo(e,t,n,i,s,a){return this.Wo(e,t,n,i,s)}zo(e,t,n){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Kr}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),n&&n.headers.forEach((i,s)=>e[s]=i)}Go(e,t){let n=kv[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}};var pl=class{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}};var Ve="WebChannelConnection",yl=class extends gl{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,i,s){let a=ml();return new Promise((u,c)=>{let h=new Lu;h.setWithCredentials(!0),h.listenOnce(qu.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Vi.NO_ERROR:let g=h.getResponseJson();N(Ve,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),u(g);break;case Vi.TIMEOUT:N(Ve,`RPC '${e}' ${a} timed out`),c(new D(R.DEADLINE_EXCEEDED,"Request time out"));break;case Vi.HTTP_ERROR:let y=h.getStatus();if(N(Ve,`RPC '${e}' ${a} failed with status:`,y,"response text:",h.getResponseText()),y>0){let A=h.getResponseJson();Array.isArray(A)&&(A=A[0]);let x=A?.error;if(x&&x.status&&x.message){let k=function(z){let B=z.toLowerCase().replace(/_/g,"-");return Object.values(R).indexOf(B)>=0?B:R.UNKNOWN}(x.status);c(new D(k,x.message))}else c(new D(R.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new D(R.UNAVAILABLE,"Connection failed."));break;default:q(9055,{c_:e,streamId:a,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{N(Ve,`RPC '${e}' ${a} completed.`)}});let f=JSON.stringify(i);N(Ve,`RPC '${e}' ${a} sending request:`,i),h.send(t,"POST",f,n,15)})}P_(e,t,n){let i=ml(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Bu(),u=ju(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;let f=s.join("");N(Ve,`Creating RPC '${e}' stream ${i}: ${f}`,c);let g=a.createWebChannel(f,c);this.T_(g);let y=!1,A=!1,x=new pl({Ho:V=>{A?N(Ve,`Not sending because RPC '${e}' stream ${i} is closed:`,V):(y||(N(Ve,`Opening RPC '${e}' stream ${i} transport.`),g.open(),y=!0),N(Ve,`RPC '${e}' stream ${i} sending:`,V),g.send(V))},Yo:()=>g.close()}),k=(V,z,B)=>{V.listen(z,M=>{try{B(M)}catch($){setTimeout(()=>{throw $},0)}})};return k(g,ar.EventType.OPEN,()=>{A||(N(Ve,`RPC '${e}' stream ${i} transport opened.`),x.s_())}),k(g,ar.EventType.CLOSE,()=>{A||(A=!0,N(Ve,`RPC '${e}' stream ${i} transport closed`),x.__(),this.I_(g))}),k(g,ar.EventType.ERROR,V=>{A||(A=!0,Ke(Ve,`RPC '${e}' stream ${i} transport errored. Name:`,V.name,"Message:",V.message),x.__(new D(R.UNAVAILABLE,"The operation could not be completed")))}),k(g,ar.EventType.MESSAGE,V=>{var z;if(!A){let B=V.data[0];U(!!B,16349);let M=B,$=M?.error||((z=M[0])===null||z===void 0?void 0:z.error);if($){N(Ve,`RPC '${e}' stream ${i} received error:`,$);let K=$.status,W=function(w){let T=ye[w];if(T!==void 0)return rp(T)}(K),v=$.message;W===void 0&&(W=R.INTERNAL,v="Unknown error status: "+K+" with message "+$.message),A=!0,x.__(new D(W,v)),g.close()}else N(Ve,`RPC '${e}' stream ${i} received:`,B),x.a_(B)}}),k(u,Uu.STAT_EVENT,V=>{V.stat===so.PROXY?N(Ve,`RPC '${e}' stream ${i} detected buffering proxy`):V.stat===so.NOPROXY&&N(Ve,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{x.o_()},0),x}terminate(){this.u_.forEach(e=>e.close()),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter(t=>t===e)}};function Fp(){return typeof window<"u"?window:null}function wo(){return typeof document<"u"?document:null}function Is(r){return new Vc(r,!0)}var fs=class{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();let t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-n);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),e())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Gm="PersistentStream",na=class{constructor(e,t,n,i,s,a,u,c){this.Fi=e,this.w_=n,this.S_=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new fs(e,t)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return C(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(e){this.q_(),this.stream.send(e)}L_(){return C(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(e,t){return C(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,e!==4?this.F_.reset():t&&t.code===R.RESOURCE_EXHAUSTED?(fe(t.toString()),fe("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===R.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.n_(t)})}U_(){}auth(){this.state=1;let e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.b_===t&&this.W_(n,i)},n=>{e(()=>{let i=new D(R.UNKNOWN,"Fetching auth token failed: "+n.message);return this.G_(i)})})}W_(e,t){let n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo(()=>{n(()=>this.listener.Zo())}),this.stream.e_(()=>{n(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{n(()=>this.G_(i))}),this.stream.onMessage(i=>{n(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>C(this,null,function*(){this.state=0,this.start()}))}G_(e){return N(Gm,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget(()=>this.b_===e?t():(N(Gm,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},_l=class extends na{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();let t=pv(this.serializer,e),n=function(s){if(!("targetChange"in s))return j.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?j.min():a.readTime?ge(a.readTime):j.min()}(e);return this.listener.J_(t,n)}H_(e){let t={};t.database=Nc(this.serializer),t.addTarget=function(s,a){let u,c=a.target;if(u=xo(c)?{documents:lp(s,c)}:{query:hp(s,c).Vt},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=ip(s,a.resumeToken);let h=xc(s,a.expectedCount);h!==null&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo(j.min())>0){u.readTime=Or(s,a.snapshotVersion.toTimestamp());let h=xc(s,a.expectedCount);h!==null&&(u.expectedCount=h)}return u}(this.serializer,e);let n=_v(this.serializer,e);n&&(t.labels=n),this.k_(t)}Y_(e){let t={};t.database=Nc(this.serializer),t.removeTarget=e,this.k_(t)}},wl=class extends na{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return U(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,U(!e.writeResults||e.writeResults.length===0,55816),this.listener.ea()}onNext(e){U(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();let t=yv(e.writeResults,e.commitTime),n=ge(e.commitTime);return this.listener.ta(n,t)}na(){let e={};e.database=Nc(this.serializer),this.k_(e)}X_(e){let t={streamToken:this.lastStreamToken,writes:e.map(n=>us(this.serializer,n))};this.k_(t)}};var vl=class{},Tl=class extends vl{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Wo(e,kc(t,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(R.UNKNOWN,s.toString())})}Jo(e,t,n,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Jo(e,kc(t,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===R.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new D(R.UNKNOWN,a.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},El=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(e){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,e==="Online"&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(fe(t),this._a=!1):N("OnlineStateTracker",t)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var Un="RemoteStore",Il=class{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(a=>{n.enqueueAndForget(()=>C(this,null,function*(){mn(this)&&(N(Un,"Restarting streams for network reachability change."),yield function(c){return C(this,null,function*(){let h=L(c);h.Ia.add(4),yield Qr(h),h.Aa.set("Unknown"),h.Ia.delete(4),yield As(h)})}(this))}))}),this.Aa=new El(n,i)}};function As(r){return C(this,null,function*(){if(mn(r))for(let e of r.da)yield e(!0)})}function Qr(r){return C(this,null,function*(){for(let e of r.da)yield e(!1)})}function Pa(r,e){let t=L(r);t.Ta.has(e.targetId)||(t.Ta.set(e.targetId,e),bh(t)?Ah(t):Xr(t).x_()&&Ih(t,e))}function Ur(r,e){let t=L(r),n=Xr(t);t.Ta.delete(e),n.x_()&&Mp(t,e),t.Ta.size===0&&(n.x_()?n.B_():mn(t)&&t.Aa.set("Unknown"))}function Ih(r,e){if(r.Ra.$e(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Xr(r).H_(e)}function Mp(r,e){r.Ra.$e(e),Xr(r).Y_(e)}function Ah(r){r.Ra=new Dc({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),Et:e=>r.Ta.get(e)||null,lt:()=>r.datastore.serializer.databaseId}),Xr(r).start(),r.Aa.aa()}function bh(r){return mn(r)&&!Xr(r).M_()&&r.Ta.size>0}function mn(r){return L(r).Ia.size===0}function Lp(r){r.Ra=void 0}function Nv(r){return C(this,null,function*(){r.Aa.set("Online")})}function Ov(r){return C(this,null,function*(){r.Ta.forEach((e,t)=>{Ih(r,e)})})}function Fv(r,e){return C(this,null,function*(){Lp(r),bh(r)?(r.Aa.la(e),Ah(r)):r.Aa.set("Unknown")})}function Mv(r,e,t){return C(this,null,function*(){if(r.Aa.set("Online"),e instanceof Fo&&e.state===2&&e.cause)try{yield function(i,s){return C(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.Ta.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.Ta.delete(u),i.Ra.removeTarget(u))})}(r,e)}catch(n){N(Un,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield ra(r,n)}else if(e instanceof Er?r.Ra.Ye(e):e instanceof Oo?r.Ra.it(e):r.Ra.et(e),!t.isEqual(j.min()))try{let n=yield Pp(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){let u=s.Ra.Pt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.Ta.get(h);f&&s.Ta.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{let f=s.Ta.get(c);if(!f)return;s.Ta.set(c,f.withResumeToken(pe.EMPTY_BYTE_STRING,f.snapshotVersion)),Mp(s,c);let g=new Fr(f.target,c,h,f.sequenceNumber);Ih(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){N(Un,"Failed to raise snapshot:",n),yield ra(r,n)}})}function ra(r,e,t){return C(this,null,function*(){if(!dn(e))throw e;r.Ia.add(1),yield Qr(r),r.Aa.set("Offline"),t||(t=()=>Pp(r.localStore)),r.asyncQueue.enqueueRetryable(()=>C(null,null,function*(){N(Un,"Retrying IndexedDB access"),yield t(),r.Ia.delete(1),yield As(r)}))})}function qp(r,e){return e().catch(t=>ra(r,t,e))}function Hr(r){return C(this,null,function*(){let e=L(r),t=cn(e),n=e.Pa.length>0?e.Pa[e.Pa.length-1].batchId:Xt;for(;Lv(e);)try{let i=yield Dv(e.localStore,n);if(i===null){e.Pa.length===0&&t.B_();break}n=i.batchId,qv(e,i)}catch(i){yield ra(e,i)}Up(e)&&jp(e)})}function Lv(r){return mn(r)&&r.Pa.length<10}function qv(r,e){r.Pa.push(e);let t=cn(r);t.x_()&&t.Z_&&t.X_(e.mutations)}function Up(r){return mn(r)&&!cn(r).M_()&&r.Pa.length>0}function jp(r){cn(r).start()}function Uv(r){return C(this,null,function*(){cn(r).na()})}function jv(r){return C(this,null,function*(){let e=cn(r);for(let t of r.Pa)e.X_(t.mutations)})}function Bv(r,e,t){return C(this,null,function*(){let n=r.Pa.shift(),i=Rc.from(n,e,t);yield qp(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield Hr(r)})}function zv(r,e){return C(this,null,function*(){e&&cn(r).Z_&&(yield function(n,i){return C(this,null,function*(){if(function(a){return np(a)&&a!==R.ABORTED}(i.code)){let s=n.Pa.shift();cn(n).N_(),yield qp(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Hr(n)}})}(r,e)),Up(r)&&jp(r)})}function Km(r,e){return C(this,null,function*(){let t=L(r);t.asyncQueue.verifyOperationInProgress(),N(Un,"RemoteStore received new credentials");let n=mn(t);t.Ia.add(3),yield Qr(t),n&&t.Aa.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.Ia.delete(3),yield As(t)})}function Al(r,e){return C(this,null,function*(){let t=L(r);e?(t.Ia.delete(2),yield As(t)):e||(t.Ia.add(2),yield Qr(t),t.Aa.set("Unknown"))})}function Xr(r){return r.Va||(r.Va=function(t,n,i){let s=L(t);return s.ia(),new _l(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Zo:Nv.bind(null,r),e_:Ov.bind(null,r),n_:Fv.bind(null,r),J_:Mv.bind(null,r)}),r.da.push(e=>C(null,null,function*(){e?(r.Va.N_(),bh(r)?Ah(r):r.Aa.set("Unknown")):(yield r.Va.stop(),Lp(r))}))),r.Va}function cn(r){return r.ma||(r.ma=function(t,n,i){let s=L(t);return s.ia(),new wl(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Zo:()=>Promise.resolve(),e_:Uv.bind(null,r),n_:zv.bind(null,r),ea:jv.bind(null,r),ta:Bv.bind(null,r)}),r.da.push(e=>C(null,null,function*(){e?(r.ma.N_(),yield Hr(r)):(yield r.ma.stop(),r.Pa.length>0&&(N(Un,`Stopping write stream with ${r.Pa.length} pending writes`),r.Pa=[]))}))),r.ma}var bl=class r{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Ee,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){let a=Date.now()+n,u=new r(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(R.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Jr(r,e){if(fe("AsyncQueue",`${e}: ${r}`),dn(r))return new D(R.UNAVAILABLE,`${e}: ${r}`);throw r}var ia=class r{static emptySet(e){return new r(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||F.comparator(t.key,n.key):(t,n)=>F.comparator(t.key,n.key),this.keyedMap=Fi(),this.sortedSet=new ae(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof r)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let n=new r;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}};var sa=class{constructor(){this.fa=new ae(F.comparator)}track(e){let t=e.doc.key,n=this.fa.get(t);n?e.type!==0&&n.type===3?this.fa=this.fa.insert(t,e):e.type===3&&n.type!==1?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):e.type===2&&n.type===2?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):e.type===2&&n.type===0?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):e.type===1&&n.type===0?this.fa=this.fa.remove(t):e.type===1&&n.type===2?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):e.type===0&&n.type===1?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):q(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){let e=[];return this.fa.inorderTraversal((t,n)=>{e.push(n)}),e}},jr=class r{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){let a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new r(e,t,ia.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Ts(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}};var Sl=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(e=>e.ba())}},Rl=class{constructor(){this.queries=Wm(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(t,n){let i=L(t),s=i.queries;i.queries=Wm(),s.forEach((a,u)=>{for(let c of u.wa)c.onError(n)})})(this,new D(R.ABORTED,"Firestore shutting down"))}};function Wm(){return new it(r=>Bg(r),Ts)}function Sh(r,e){return C(this,null,function*(){let t=L(r),n=3,i=e.query,s=t.queries.get(i);s?!s.Sa()&&e.ba()&&(n=2):(s=new Sl,n=e.ba()?0:1);try{switch(n){case 0:s.ya=yield t.onListen(i,!0);break;case 1:s.ya=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){let u=Jr(a,`Initialization of query '${gr(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.wa.push(e),e.va(t.onlineState),s.ya&&e.Ca(s.ya)&&Ph(t)})}function Rh(r,e){return C(this,null,function*(){let t=L(r),n=e.query,i=3,s=t.queries.get(n);if(s){let a=s.wa.indexOf(e);a>=0&&(s.wa.splice(a,1),s.wa.length===0?i=e.ba()?0:1:!s.Sa()&&e.ba()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})}function $v(r,e){let t=L(r),n=!1;for(let i of e){let s=i.query,a=t.queries.get(s);if(a){for(let u of a.wa)u.Ca(i)&&(n=!0);a.ya=i}}n&&Ph(t)}function Gv(r,e,t){let n=L(r),i=n.queries.get(e);if(i)for(let s of i.wa)s.onError(t);n.queries.delete(e)}function Ph(r){r.Da.forEach(e=>{e.next()})}var Pl,Qm;(Qm=Pl||(Pl={})).Fa="default",Qm.Cache="cache";var ms=class{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){let n=[];for(let i of e.docChanges)i.type!==3&&n.push(i);e=new jr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache||!this.ba())return!0;let n=t!=="Offline";return(!this.options.ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Na(e){if(e.docChanges.length>0)return!0;let t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}La(e){e=jr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==Pl.Cache}};var Cl=class{constructor(e,t){this.qa=e,this.byteLength=t}Qa(){return"metadata"in this.qa}};var oa=class{constructor(e){this.serializer=e}Qs(e){return ft(this.serializer,e)}$s(e){return e.metadata.exists?cp(this.serializer,e.document,!1):Te.newNoDocument(this.Qs(e.metadata.name),this.Us(e.metadata.readTime))}Us(e){return ge(e)}},Dl=class{constructor(e,t){this.$a=e,this.serializer=t,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=Bp(e)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.qa.namedQuery)this.Ua.push(e.qa.namedQuery);else if(e.qa.documentMetadata){this.Ka.push({metadata:e.qa.documentMetadata}),e.qa.documentMetadata.exists||++t;let n=X.fromString(e.qa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.qa.document&&(this.Ka[this.Ka.length-1].document=e.qa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}Ga(e){let t=new Map,n=new oa(this.serializer);for(let i of e)if(i.metadata.queries){let s=n.Qs(i.metadata.name);for(let a of i.metadata.queries){let u=(t.get(a)||Q()).add(s);t.set(a,u)}}return t}za(e){return C(this,null,function*(){let t=yield Vv(e,new oa(this.serializer),this.Ka,this.$a.id),n=this.Ga(this.documents);for(let i of this.Ua)yield xv(e,i,n.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:t}})}};function Bp(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var aa=class{constructor(e){this.key=e}},ua=class{constructor(e){this.key=e}},ca=class{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Q(),this.mutatedKeys=Q(),this.Xa=$g(e),this.eu=new ia(this.Xa)}get tu(){return this.Ha}nu(e,t){let n=t?t.ru:new sa,i=t?t.eu:this.eu,s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,g)=>{let y=i.get(f),A=Es(this.query,g)?g:null,x=!!y&&this.mutatedKeys.has(y.key),k=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations),V=!1;y&&A?y.data.isEqual(A.data)?x!==k&&(n.track({type:3,doc:A}),V=!0):this.iu(y,A)||(n.track({type:2,doc:A}),V=!0,(c&&this.Xa(A,c)>0||h&&this.Xa(A,h)<0)&&(u=!0)):!y&&A?(n.track({type:0,doc:A}),V=!0):y&&!A&&(n.track({type:1,doc:y}),V=!0,(c||h)&&(u=!0)),V&&(A?(a=a.add(A),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{eu:a,ru:n,Ds:u,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){let s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;let a=e.ru.pa();a.sort((f,g)=>function(A,x){let k=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return q(20277,{At:V})}};return k(A)-k(x)}(f.type,g.type)||this.Xa(f.doc,g.doc)),this.su(n),i=i!=null&&i;let u=t&&!i?this.ou():[],c=this.Za.size===0&&this.current&&!i?1:0,h=c!==this.Ya;return this.Ya=c,a.length!==0||h?{snapshot:new jr(this.query,e.eu,s,a,e.mutatedKeys,c===0,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new sa,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=e.current)}ou(){if(!this.current)return[];let e=this.Za;this.Za=Q(),this.eu.forEach(n=>{this.au(n.key)&&(this.Za=this.Za.add(n.key))});let t=[];return e.forEach(n=>{this.Za.has(n)||t.push(new ua(n))}),this.Za.forEach(n=>{e.has(n)||t.push(new aa(n))}),t}uu(e){this.Ha=e.qs,this.Za=Q();let t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return jr.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},gn="SyncEngine",Vl=class{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}},xl=class{constructor(e){this.key=e,this.lu=!1}},kl=class{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.hu={},this.Pu=new it(u=>Bg(u),Ts),this.Tu=new Map,this.Iu=new Set,this.du=new ae(F.comparator),this.Eu=new Map,this.Au=new ls,this.Ru={},this.Vu=new Map,this.mu=Mr.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function Kv(r,e,t=!0){return C(this,null,function*(){let n=Ca(r),i,s=n.Pu.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield zp(n,e,t,!0),i})}function Wv(r,e){return C(this,null,function*(){let t=Ca(r);yield zp(t,e,!0,!1)})}function zp(r,e,t,n){return C(this,null,function*(){let i=yield Lr(r.localStore,qe(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t),u;return n&&(u=yield Ch(r,e,s,a==="current",i.resumeToken)),r.isPrimaryClient&&t&&Pa(r.remoteStore,i),u})}function Ch(r,e,t,n,i){return C(this,null,function*(){r.gu=(g,y,A)=>function(k,V,z,B){return C(this,null,function*(){let M=V.view.nu(z);M.Ds&&(M=yield Jo(k.localStore,V.query,!1).then(({documents:v})=>V.view.nu(v,M)));let $=B&&B.targetChanges.get(V.targetId),K=B&&B.targetMismatches.get(V.targetId)!=null,W=V.view.applyChanges(M,k.isPrimaryClient,$,K);return Nl(k,V.targetId,W._u),W.snapshot})}(r,g,y,A);let s=yield Jo(r.localStore,e,!0),a=new ca(e,s.qs),u=a.nu(s.documents),c=os.createSynthesizedTargetChangeForCurrentChange(t,n&&r.onlineState!=="Offline",i),h=a.applyChanges(u,r.isPrimaryClient,c);Nl(r,t,h._u);let f=new Vl(e,t,a);return r.Pu.set(e,f),r.Tu.has(t)?r.Tu.get(t).push(e):r.Tu.set(t,[e]),h.snapshot})}function Qv(r,e,t){return C(this,null,function*(){let n=L(r),i=n.Pu.get(e),s=n.Tu.get(i.targetId);if(s.length>1)return n.Tu.set(i.targetId,s.filter(a=>!Ts(a,e))),void n.Pu.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield qr(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&Ur(n.remoteStore,i.targetId),Br(n,i.targetId)}).catch(hn))):(Br(n,i.targetId),yield qr(n.localStore,i.targetId,!0))})}function Hv(r,e){return C(this,null,function*(){let t=L(r),n=t.Pu.get(e),i=t.Tu.get(n.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),Ur(t.remoteStore,n.targetId))})}function Xv(r,e,t){return C(this,null,function*(){let n=kh(r);try{let i=yield function(a,u){let c=L(a),h=se.now(),f=u.reduce((A,x)=>A.add(x.key),Q()),g,y;return c.persistence.runTransaction("Locally write mutations","readwrite",A=>{let x=$e(),k=Q();return c.Os.getEntries(A,f).next(V=>{x=V,x.forEach((z,B)=>{B.isValidDocument()||(k=k.add(z))})}).next(()=>c.localDocuments.getOverlayedDocuments(A,x)).next(V=>{g=V;let z=[];for(let B of u){let M=cv(B,g.get(B.key).overlayedDocument);M!=null&&z.push(new st(B.key,M,Og(M.value.mapValue),de.exists(!0)))}return c.mutationQueue.addMutationBatch(A,h,z,u)}).next(V=>{y=V;let z=V.applyToLocalDocumentSet(g,k);return c.documentOverlayCache.saveOverlays(A,V.batchId,z)})}).then(()=>({batchId:y.batchId,changes:Kg(g)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.Ru[a.currentUser.toKey()];h||(h=new ae(G)),h=h.insert(u,c),a.Ru[a.currentUser.toKey()]=h}(n,i.batchId,t),yield xt(n,i.changes),yield Hr(n.remoteStore)}catch(i){let s=Jr(i,"Failed to persist write");t.reject(s)}})}function $p(r,e){return C(this,null,function*(){let t=L(r);try{let n=yield Cv(t.localStore,e);e.targetChanges.forEach((i,s)=>{let a=t.Eu.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?a.lu=!0:i.modifiedDocuments.size>0?U(a.lu,14607):i.removedDocuments.size>0&&(U(a.lu,42227),a.lu=!1))}),yield xt(t,n,e)}catch(n){yield hn(n)}})}function Hm(r,e,t){let n=L(r);if(n.isPrimaryClient&&t===0||!n.isPrimaryClient&&t===1){let i=[];n.Pu.forEach((s,a)=>{let u=a.view.va(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){let c=L(a);c.onlineState=u;let h=!1;c.queries.forEach((f,g)=>{for(let y of g.wa)y.va(u)&&(h=!0)}),h&&Ph(c)}(n.eventManager,e),i.length&&n.hu.J_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Jv(r,e,t){return C(this,null,function*(){let n=L(r);n.sharedClientState.updateQueryState(e,"rejected",t);let i=n.Eu.get(e),s=i&&i.key;if(s){let a=new ae(F.comparator);a=a.insert(s,Te.newNoDocument(s,j.min()));let u=Q().add(s),c=new ss(j.min(),new Map,new ae(G),a,u);yield $p(n,c),n.du=n.du.remove(s),n.Eu.delete(e),xh(n)}else yield qr(n.localStore,e,!1).then(()=>Br(n,e,t)).catch(hn)})}function Yv(r,e){return C(this,null,function*(){let t=L(r),n=e.batch.batchId;try{let i=yield Pv(t.localStore,e);Vh(t,n,null),Dh(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield xt(t,i)}catch(i){yield hn(i)}})}function Zv(r,e,t){return C(this,null,function*(){let n=L(r);try{let i=yield function(a,u){let c=L(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(g=>(U(g!==null,37113),f=g.keys(),c.mutationQueue.removeMutationBatch(h,g))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);Vh(n,e,t),Dh(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield xt(n,i)}catch(i){yield hn(i)}})}function eT(r,e){return C(this,null,function*(){let t=L(r);mn(t.remoteStore)||N(gn,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=L(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(n===Xt)return void e.resolve();let i=t.Vu.get(n)||[];i.push(e),t.Vu.set(n,i)}catch(n){let i=Jr(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Dh(r,e){(r.Vu.get(e)||[]).forEach(t=>{t.resolve()}),r.Vu.delete(e)}function Vh(r,e,t){let n=L(r),i=n.Ru[n.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ru[n.currentUser.toKey()]=i}}function Br(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(let n of r.Tu.get(e))r.Pu.delete(n),t&&r.hu.pu(n,t);r.Tu.delete(e),r.isPrimaryClient&&r.Au.zr(e).forEach(n=>{r.Au.containsKey(n)||Gp(r,n)})}function Gp(r,e){r.Iu.delete(e.path.canonicalString());let t=r.du.get(e);t!==null&&(Ur(r.remoteStore,t),r.du=r.du.remove(e),r.Eu.delete(t),xh(r))}function Nl(r,e,t){for(let n of t)n instanceof aa?(r.Au.addReference(n.key,e),tT(r,n)):n instanceof ua?(N(gn,"Document no longer in limbo: "+n.key),r.Au.removeReference(n.key,e),r.Au.containsKey(n.key)||Gp(r,n.key)):q(19791,{yu:n})}function tT(r,e){let t=e.key,n=t.path.canonicalString();r.du.get(t)||r.Iu.has(n)||(N(gn,"New document in limbo: "+t),r.Iu.add(n),xh(r))}function xh(r){for(;r.Iu.size>0&&r.du.size<r.maxConcurrentLimboResolutions;){let e=r.Iu.values().next().value;r.Iu.delete(e);let t=new F(X.fromString(e)),n=r.mu.next();r.Eu.set(n,new xl(t)),r.du=r.du.insert(t,n),Pa(r.remoteStore,new Fr(qe(Wr(t.path)),n,"TargetPurposeLimboResolution",He.ue))}}function xt(r,e,t){return C(this,null,function*(){let n=L(r),i=[],s=[],a=[];n.Pu.isEmpty()||(n.Pu.forEach((u,c)=>{a.push(n.gu(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){let g=h?!h.fromCache:(f=t?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,g?"current":"not-current")}if(h){i.push(h);let g=cl.Es(c.targetId,h);s.push(g)}}))}),yield Promise.all(a),n.hu.J_(i),yield function(c,h){return C(this,null,function*(){let f=L(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>S.forEach(h,y=>S.forEach(y.Is,A=>f.persistence.referenceDelegate.addReference(g,y.targetId,A)).next(()=>S.forEach(y.ds,A=>f.persistence.referenceDelegate.removeReference(g,y.targetId,A)))))}catch(g){if(!dn(g))throw g;N(Eh,"Failed to update sequence numbers: "+g)}for(let g of h){let y=g.targetId;if(!g.fromCache){let A=f.Fs.get(y),x=A.snapshotVersion,k=A.withLastLimboFreeSnapshotVersion(x);f.Fs=f.Fs.insert(y,k)}}})}(n.localStore,s))})}function nT(r,e){return C(this,null,function*(){let t=L(r);if(!t.currentUser.isEqual(e)){N(gn,"User change. New user:",e.toKey());let n=yield Rp(t.localStore,e);t.currentUser=e,function(s,a){s.Vu.forEach(u=>{u.forEach(c=>{c.reject(new D(R.CANCELLED,a))})}),s.Vu.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield xt(t,n.Bs)}})}function rT(r,e){let t=L(r),n=t.Eu.get(e);if(n&&n.lu)return Q().add(n.key);{let i=Q(),s=t.Tu.get(e);if(!s)return i;for(let a of s){let u=t.Pu.get(a);i=i.unionWith(u.view.tu)}return i}}function iT(r,e){return C(this,null,function*(){let t=L(r),n=yield Jo(t.localStore,e.query,!0),i=e.view.uu(n);return t.isPrimaryClient&&Nl(t,e.targetId,i._u),i})}function sT(r,e){return C(this,null,function*(){let t=L(r);return Vp(t.localStore,e).then(n=>xt(t,n))})}function oT(r,e,t,n){return C(this,null,function*(){let i=L(r),s=yield function(u,c){let h=L(u),f=L(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.Xn(g,c).next(y=>y?h.localDocuments.getDocuments(g,y):S.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Hr(i.remoteStore):t==="acknowledged"||t==="rejected"?(Vh(i,e,n||null),Dh(i,e),function(u,c){L(L(u).mutationQueue).rr(c)}(i.localStore,e)):q(6720,"Unknown batchState",{wu:t}),yield xt(i,s)):N(gn,"Cannot apply mutation batch with id: "+e)})}function aT(r,e){return C(this,null,function*(){let t=L(r);if(Ca(t),kh(t),e===!0&&t.fu!==!0){let n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Xm(t,n.toArray());t.fu=!0,yield Al(t.remoteStore,!0);for(let s of i)Pa(t.remoteStore,s)}else if(e===!1&&t.fu!==!1){let n=[],i=Promise.resolve();t.Tu.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Br(t,a),qr(t.localStore,a,!0))),Ur(t.remoteStore,a)}),yield i,yield Xm(t,n),function(a){let u=L(a);u.Eu.forEach((c,h)=>{Ur(u.remoteStore,h)}),u.Au.jr(),u.Eu=new Map,u.du=new ae(F.comparator)}(t),t.fu=!1,yield Al(t.remoteStore,!1)}})}function Xm(r,e,t){return C(this,null,function*(){let n=L(r),i=[],s=[];for(let a of e){let u,c=n.Tu.get(a);if(c&&c.length!==0){u=yield Lr(n.localStore,qe(c[0]));for(let h of c){let f=n.Pu.get(h),g=yield iT(n,f);g.snapshot&&s.push(g.snapshot)}}else{let h=yield Dp(n.localStore,a);u=yield Lr(n.localStore,h),yield Ch(n,Kp(h),a,!1,u.resumeToken)}i.push(u)}return n.hu.J_(s),i})}function Kp(r){return jg(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function uT(r){return function(t){return L(L(t).persistence).Ps()}(L(r).localStore)}function cT(r,e,t,n){return C(this,null,function*(){let i=L(r);if(i.fu)return void N(gn,"Ignoring unexpected query state notification.");let s=i.Tu.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let a=yield Vp(i.localStore,zg(s[0])),u=ss.createSynthesizedRemoteEventForCurrentChange(e,t==="current",pe.EMPTY_BYTE_STRING);yield xt(i,a,u);break}case"rejected":yield qr(i.localStore,e,!0),Br(i,e,n);break;default:q(64155,t)}})}function lT(r,e,t){return C(this,null,function*(){let n=Ca(r);if(n.fu){for(let i of e){if(n.Tu.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){N(gn,"Adding an already active target "+i);continue}let s=yield Dp(n.localStore,i),a=yield Lr(n.localStore,s);yield Ch(n,Kp(s),a.targetId,!1,a.resumeToken),Pa(n.remoteStore,a)}for(let i of t)n.Tu.has(i)&&(yield qr(n.localStore,i,!1).then(()=>{Ur(n.remoteStore,i),Br(n,i)}).catch(hn))}})}function Ca(r){let e=L(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=$p.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rT.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Jv.bind(null,e),e.hu.J_=$v.bind(null,e.eventManager),e.hu.pu=Gv.bind(null,e.eventManager),e}function kh(r){let e=L(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Yv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Zv.bind(null,e),e}function hT(r,e,t){let n=L(r);(function(s,a,u){return C(this,null,function*(){try{let c=yield a.getMetadata();if(yield function(A,x){let k=L(A),V=ge(x.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",z=>k.Ti.getBundleMetadata(z,x.id)).then(z=>!!z&&z.createTime.compareTo(V)>=0)}(s.localStore,c))return yield a.close(),u._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(c)),Promise.resolve(new Set);u._updateProgress(Bp(c));let h=new Dl(c,a.serializer),f=yield a.Su();for(;f;){let y=yield h.Wa(f);y&&u._updateProgress(y),f=yield a.Su()}let g=yield h.za(s.localStore);return yield xt(s,g.Ja,void 0),yield function(A,x){let k=L(A);return k.persistence.runTransaction("Save bundle","readwrite",V=>k.Ti.saveBundleMetadata(V,x))}(s.localStore,c),u._completeWith(g.progress),Promise.resolve(g.ja)}catch(c){return Ke(gn,`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var Nh=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){return C(this,null,function*(){this.serializer=Is(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Du(t),yield this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Cu(t,this.localStore),this.indexBackfillerScheduler=this.Fu(t,this.localStore)})}Cu(t,n){return null}Fu(t,n){return null}vu(t){return Sp(this.persistence,new Xo,t.initialUser,this.serializer)}Du(t){return new hs(Qo.Vi,this.serializer)}bu(t){return new ea}terminate(){return C(this,null,function*(){var t,n;(t=this.gcScheduler)===null||t===void 0||t.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return r.provider={build:()=>new r},r})(),Ol=class extends Nh{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){U(this.persistence.referenceDelegate instanceof Ho,46915);let n=this.persistence.referenceDelegate.garbageCollector;return new Go(n,e.asyncQueue,t)}Du(e){let t=this.cacheSizeBytes!==void 0?ze.withCacheSize(this.cacheSizeBytes):ze.DEFAULT;return new hs(n=>Ho.Vi(n,t),this.serializer)}},la=class r extends Nh{constructor(e,t,n){super(),this.Mu=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){return C(this,null,function*(){yield du(r.prototype,this,"initialize").call(this,e),yield this.Mu.initialize(this,e),yield kh(this.Mu.syncEngine),yield Hr(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(e){return Sp(this.persistence,new Xo,e.initialUser,this.serializer)}Cu(e,t){let n=this.persistence.referenceDelegate.garbageCollector;return new Go(n,e.asyncQueue,t)}Fu(e,t){let n=new ac(t,this.persistence);return new oc(e.asyncQueue,n)}Du(e){let t=Th(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?ze.withCacheSize(this.cacheSizeBytes):ze.DEFAULT;return new ul(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Fp(),wo(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(e){return new ea}},Fl=class r extends la{constructor(e,t){super(e,t,!1),this.Mu=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return C(this,null,function*(){yield du(r.prototype,this,"initialize").call(this,e);let t=this.Mu.syncEngine;this.sharedClientState instanceof Gi&&(this.sharedClientState.syncEngine={Do:oT.bind(null,t),vo:cT.bind(null,t),Co:lT.bind(null,t),Ps:uT.bind(null,t),bo:sT.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.ji(n=>C(this,null,function*(){yield aT(this.Mu.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}bu(e){let t=Fp();if(!Gi.C(t))throw new D(R.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=Th(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Gi(t,e.asyncQueue,n,e.clientId,e.initialUser)}},Oh=(()=>{class r{initialize(t,n){return C(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>Hm(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=nT.bind(null,this.syncEngine),yield Al(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Rl}()}createDatastore(t){let n=Is(t.databaseInfo.databaseId),i=function(a){return new yl(a)}(t.databaseInfo);return function(a,u,c,h){return new Tl(a,u,c,h)}(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return function(i,s,a,u,c){return new Il(i,s,a,u,c)}(this.localStore,this.datastore,t.asyncQueue,n=>Hm(this.syncEngine,n,0),function(){return ta.C()?new ta:new fl}())}createSyncEngine(t,n){return function(s,a,u,c,h,f,g){let y=new kl(s,a,u,c,h,f);return g&&(y.fu=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){return C(this,null,function*(){var t,n;yield function(s){return C(this,null,function*(){let a=L(s);N(Un,"RemoteStore shutting down."),a.Ia.add(5),yield Qr(a),a.Ea.shutdown(),a.Aa.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()})}}return r.provider={build:()=>new r},r})();function Jm(r,e=10240){let t=0;return{read(){return C(this,null,function*(){if(t<r.byteLength){let i={value:r.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return C(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var zr=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):fe("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout(()=>{this.muted||e(t)},0)}};var Ml=class{constructor(e,t){this.Nu=e,this.serializer=t,this.metadata=new Ee,this.buffer=new Uint8Array,this.Bu=function(){return new TextDecoder("utf-8")}(),this.Lu().then(n=>{n&&n.Qa()?this.metadata.resolve(n.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.qa)}`))},n=>this.metadata.reject(n))}close(){return this.Nu.cancel()}getMetadata(){return C(this,null,function*(){return this.metadata.promise})}Su(){return C(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return C(this,null,function*(){let e=yield this.ku();if(e===null)return null;let t=this.Bu.decode(e),n=Number(t);isNaN(n)&&this.qu(`length string (${t}) is not valid number`);let i=yield this.Qu(n);return new Cl(JSON.parse(i),e.length+n)})}$u(){return this.buffer.findIndex(e=>e===123)}ku(){return C(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let e=this.$u();e<0&&this.qu("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}Qu(e){return C(this,null,function*(){for(;this.buffer.length<e;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let t=this.Bu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}qu(e){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${e}`)}Uu(){return C(this,null,function*(){let e=yield this.Nu.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var Ll=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new D(R.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return C(this,null,function*(){let a=L(i),u={documents:s.map(g=>as(a.serializer,g))},c=yield a.Jo("BatchGetDocuments",a.serializer.databaseId,X.emptyPath(),u,s.length),h=new Map;c.forEach(g=>{let y=gv(a.serializer,g);h.set(y.key.toString(),y)});let f=[];return s.forEach(g=>{let y=h.get(g.toString());U(!!y,55234,{key:g}),f.push(y)}),f})}(this.datastore,e);return t.forEach(n=>this.recordVersion(n)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new un(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return C(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,n)=>{let i=F.fromPath(n);this.mutations.push(new ns(i,this.precondition(i)))}),yield function(n,i){return C(this,null,function*(){let s=L(n),a={writes:i.map(u=>us(s.serializer,u))};yield s.Wo("Commit",s.serializer.databaseId,X.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw q(50498,{Wu:e.constructor.name});t=j.min()}let n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new D(R.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?de.exists(!1):de.updateTime(t):de.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new D(R.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return de.updateTime(t)}return de.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var ql=class{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Gu=n.maxAttempts,this.F_=new fs(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>C(this,null,function*(){let e=new Ll(this.datastore),t=this.Ju(e);t&&t.then(n=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.Hu(i)}))}).catch(n=>{this.Hu(n)})}))}Ju(e){try{let t=this.updateFunction(e);return!_s(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(e)}Yu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!np(t)}return!1}};var ln="FirestoreClient",Ul=class{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=we.UNAUTHENTICATED,this.clientId=Ki.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,a=>C(this,null,function*(){N(ln,"Received user=",a.uid),yield this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(n,a=>(N(ln,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ee;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>C(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let n=Jr(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}};function Hu(r,e){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),N(ln,"Initializing OfflineComponentProvider");let t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(i=>C(null,null,function*(){n.isEqual(i)||(yield Rp(e.localStore,i),n=i)})),e.persistence.setDatabaseDeletedListener(()=>{Ke("Terminating Firestore due to IndexedDb database deletion"),r.terminate().then(()=>{N("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Ke("Terminating Firestore due to IndexedDb database deletion failed",i)})}),r._offlineComponents=e})}function Ym(r,e){return C(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let t=yield Fh(r);N(ln,"Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>Km(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>Km(e.remoteStore,i)),r._onlineComponents=e})}function Fh(r){return C(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){N(ln,"Using user provided OfflineComponentProvider");try{yield Hu(r,r._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!function(i){return i.name==="FirebaseError"?i.code===R.FAILED_PRECONDITION||i.code===R.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(t))throw t;Ke("Error using user provided cache. Falling back to memory cache: "+t),yield Hu(r,new Nh)}}else N(ln,"Using default OfflineComponentProvider"),yield Hu(r,new Ol(void 0));return r._offlineComponents})}function Da(r){return C(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(N(ln,"Using user provided OnlineComponentProvider"),yield Ym(r,r._uninitializedComponentsProvider._online)):(N(ln,"Using default OnlineComponentProvider"),yield Ym(r,new Oh))),r._onlineComponents})}function Wp(r){return Fh(r).then(e=>e.persistence)}function Mh(r){return Fh(r).then(e=>e.localStore)}function Qp(r){return Da(r).then(e=>e.remoteStore)}function Lh(r){return Da(r).then(e=>e.syncEngine)}function dT(r){return Da(r).then(e=>e.datastore)}function $r(r){return C(this,null,function*(){let e=yield Da(r),t=e.eventManager;return t.onListen=Kv.bind(null,e.syncEngine),t.onUnlisten=Qv.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Wv.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Hv.bind(null,e.syncEngine),t})}function fT(r){return r.asyncQueue.enqueue(()=>C(null,null,function*(){let e=yield Wp(r),t=yield Qp(r);return e.setNetworkEnabled(!0),function(i){let s=L(i);return s.Ia.delete(0),As(s)}(t)}))}function mT(r){return r.asyncQueue.enqueue(()=>C(null,null,function*(){let e=yield Wp(r),t=yield Qp(r);return e.setNetworkEnabled(!1),function(i){return C(this,null,function*(){let s=L(i);s.Ia.add(0),yield Qr(s),s.Aa.set("Offline")})}(t)}))}function gT(r,e){let t=new Ee;return r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(i,s,a){return C(this,null,function*(){try{let u=yield function(h,f){let g=L(h);return g.persistence.runTransaction("read document","readonly",y=>g.localDocuments.getDocument(y,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new D(R.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Jr(u,`Failed to get document '${s} from cache`);a.reject(c)}})}(yield Mh(r),e,t)})),t.promise}function Hp(r,e,t={}){let n=new Ee;return r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(s,a,u,c,h){let f=new zr({next:y=>{f.Ou(),a.enqueueAndForget(()=>Rh(s,g));let A=y.docs.has(u);!A&&y.fromCache?h.reject(new D(R.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&y.fromCache&&c&&c.source==="server"?h.reject(new D(R.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new ms(Wr(u.path),f,{includeMetadataChanges:!0,ka:!0});return Sh(s,g)}(yield $r(r),r.asyncQueue,e,t,n)})),n.promise}function pT(r,e){let t=new Ee;return r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(i,s,a){return C(this,null,function*(){try{let u=yield Jo(i,s,!0),c=new ca(s,u.qs),h=c.nu(u.documents),f=c.applyChanges(h,!1);a.resolve(f.snapshot)}catch(u){let c=Jr(u,`Failed to execute query '${s} against cache`);a.reject(c)}})}(yield Mh(r),e,t)})),t.promise}function Xp(r,e,t={}){let n=new Ee;return r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(s,a,u,c,h){let f=new zr({next:y=>{f.Ou(),a.enqueueAndForget(()=>Rh(s,g)),y.fromCache&&c.source==="server"?h.reject(new D(R.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),g=new ms(u,f,{includeMetadataChanges:!0,ka:!0});return Sh(s,g)}(yield $r(r),r.asyncQueue,e,t,n)})),n.promise}function yT(r,e){let t=new zr(e);return r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(i,s){L(i).Da.add(s),s.next()}(yield $r(r),t)})),()=>{t.Ou(),r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return function(i,s){L(i).Da.delete(s)}(yield $r(r),t)}))}}function _T(r,e,t,n){let i=function(a,u){let c;return c=typeof a=="string"?rh().encode(a):a,function(f,g){return new Ml(f,g)}(function(f,g){if(f instanceof Uint8Array)return Jm(f,g);if(f instanceof ArrayBuffer)return Jm(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),u)}(t,Is(e));r.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){hT(yield Lh(r),i,n)}))}function wT(r,e){return r.asyncQueue.enqueue(()=>C(null,null,function*(){return function(n,i){let s=L(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Ti.getNamedQuery(a,i))}(yield Mh(r),e)}))}function Jp(r){let e={};return r.timeoutSeconds!==void 0&&(e.timeoutSeconds=r.timeoutSeconds),e}var Zm=new Map;var Yp="firestore.googleapis.com",eg=!0,ha=class{constructor(e){var t,n;if(e.host===void 0){if(e.ssl!==void 0)throw new D(R.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Yp,this.ssl=eg}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:eg;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=wp;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Sv)throw new D(R.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}sh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Jp((n=e.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(R.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},jn=class{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ha({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new D(R.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ha(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new Xu;switch(n.type){case"firstParty":return new ec(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new D(R.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return C(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let n=Zm.get(t);n&&(N("ComponentProvider","Removing Datastore"),Zm.delete(t),n.terminate())}(this),Promise.resolve()}};function Zp(r,e,t,n={}){var i;r=Z(r,jn);let s=_u(e),a=r._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:r._getEmulatorOptions()}),c=`${e}:${t}`;s&&(_f(`https://${c}`),vf("Firestore",!0)),a.host!==Yp&&a.host!==c&&Ke("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},a),{host:c,ssl:s,emulatorOptions:n});if(!Ys(h,u)&&(r._setSettings(h),n.mockUserToken)){let f,g;if(typeof n.mockUserToken=="string")f=n.mockUserToken,g=we.MOCK_USER;else{f=wf(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let y=n.mockUserToken.sub||n.mockUserToken.user_id;if(!y)throw new D(R.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");g=new we(y)}r._authCredentials=new Ju(new vo(f,g))}}var be=class r{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new r(this.firestore,e,this._query)}},ne=class r{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new mt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new r(this.firestore,e,this._key)}toJSON(){return{type:r._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(ys(t,r._jsonSchema))return new r(e,n||null,new F(X.fromString(t.referencePath)))}};ne._jsonSchemaVersion="firestore/documentReference/1.0",ne._jsonSchema={type:ve("string",ne._jsonSchemaVersion),referencePath:ve("string")};var mt=class r extends be{constructor(e,t,n){super(e,t,Wr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ne(this.firestore,null,new F(e))}withConverter(e){return new r(this.firestore,e,this._path)}};function qh(r,e,...t){if(r=ce(r),ih("collection","path",e),r instanceof jn){let n=X.fromString(e,...t);return Qf(n),new mt(r,null,n)}{if(!(r instanceof ne||r instanceof mt))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(X.fromString(e,...t));return Qf(n),new mt(r.firestore,null,n)}}function ey(r,e){if(r=Z(r,jn),ih("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(R.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new be(r,null,function(n){return new rt(X.emptyPath(),n)}(e))}function bs(r,e,...t){if(r=ce(r),arguments.length===1&&(e=Ki.newId()),ih("doc","path",e),r instanceof jn){let n=X.fromString(e,...t);return Wf(n),new ne(r,null,new F(n))}{if(!(r instanceof ne||r instanceof mt))throw new D(R.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(X.fromString(e,...t));return Wf(n),new ne(r.firestore,r instanceof mt?r.converter:null,new F(n))}}function Uh(r,e){return r=ce(r),e=ce(e),(r instanceof ne||r instanceof mt)&&(e instanceof ne||e instanceof mt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function jh(r,e){return r=ce(r),e=ce(e),r instanceof be&&e instanceof be&&r.firestore===e.firestore&&Ts(r._query,e._query)&&r.converter===e.converter}var tg="AsyncQueue",da=class{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new fs(this,"async_queue_retry"),this.oc=()=>{let n=wo();n&&N(tg,"Visibility state changed to "+n.visibilityState),this.F_.y_()},this._c=e;let t=wo();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;let t=wo();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise(()=>{});let t=new Ee;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Zu.push(e),this.cc()))}cc(){return C(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!dn(e))throw e;N(tg,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(e){let t=this._c.then(()=>(this.nc=!0,e().catch(n=>{throw this.tc=n,this.nc=!1,fe("INTERNAL UNHANDLED ERROR: ",ng(n)),n}).then(n=>(this.nc=!1,n))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);let i=bl.createAndSchedule(this,e,t,n,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&q(47125,{hc:ng(this.tc)})}verifyOperationInProgress(){}Pc(){return C(this,null,function*(){let e;do e=this._c,yield e;while(e!==this._c)})}Tc(e){for(let t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then(()=>{this.ec.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(let t of this.ec)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Pc()})}dc(e){this.sc.push(e)}lc(e){let t=this.ec.indexOf(e);this.ec.splice(t,1)}};function ng(r){let e=r.message||"";return r.stack&&(e=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),e}function jl(r){return function(t,n){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Bl=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ee,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var ty=-1,le=class extends jn{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new da,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return C(this,null,function*(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new da(e),this._firestoreClient=void 0,yield e}})}};function Se(r){if(r._terminated)throw new D(R.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||ny(r),r._firestoreClient}function ny(r){var e,t,n;let i=r._freezeSettings(),s=function(u,c,h,f){return new hc(u,c,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Jp(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)}(r._databaseId,((e=r._app)===null||e===void 0?void 0:e.options.appId)||"",r._persistenceKey,i);r._componentsProvider||!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Ul(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}}(r._componentsProvider))}function ry(r,e){Ke("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=r._freezeSettings();return sy(r,Oh.provider,{build:n=>new la(n,t.cacheSizeBytes,e?.forceOwnership)}),Promise.resolve()}function iy(r){return C(this,null,function*(){Ke("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings();sy(r,Oh.provider,{build:t=>new Fl(t,e.cacheSizeBytes)})})}function sy(r,e,t){if((r=Z(r,le))._firestoreClient||r._terminated)throw new D(R.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new D(R.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},ny(r)}function oy(r){if(r._initialized&&!r._terminated)throw new D(R.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ee;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>C(null,null,function*(){try{yield function(n){return C(this,null,function*(){if(!en.C())return Promise.resolve();let i=n+bp;yield en.delete(i)})}(Th(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function ay(r){return function(t){let n=new Ee;return t.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return eT(yield Lh(t),n)})),n.promise}(Se(r=Z(r,le)))}function uy(r){return fT(Se(r=Z(r,le)))}function cy(r){return mT(Se(r=Z(r,le)))}function ly(r,e){let t=Se(r=Z(r,le)),n=new Bl;return _T(t,r._databaseId,e,n),n}function hy(r,e){return wT(Se(r=Z(r,le)),e).then(t=>t?new be(r,null,t.query):null)}var Je=class r{constructor(e){this._byteString=e}static fromBase64String(e){try{return new r(pe.fromBase64String(e))}catch(t){throw new D(R.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new r(pe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:r._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ys(e,r._jsonSchema))return r.fromBase64String(e.bytes)}};Je._jsonSchemaVersion="firestore/bytes/1.0",Je._jsonSchema={type:ve("string",Je._jsonSchemaVersion),bytes:ve("string")};var ot=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(R.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new me(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Dt=class{constructor(e){this._methodName=e}};var gt=class r{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(R.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(R.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return G(this._lat,e._lat)||G(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:r._jsonSchemaVersion}}static fromJSON(e){if(ys(e,r._jsonSchema))return new r(e.latitude,e.longitude)}};gt._jsonSchemaVersion="firestore/geoPoint/1.0",gt._jsonSchema={type:ve("string",gt._jsonSchemaVersion),latitude:ve("number"),longitude:ve("number")};var Jt=class r{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}toJSON(){return{type:r._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ys(e,r._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(t=>typeof t=="number"))return new r(e.vectorValues);throw new D(R.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Jt._jsonSchemaVersion="firestore/vectorValue/1.0",Jt._jsonSchema={type:ve("string",Jt._jsonSchemaVersion),vectorValues:ve("object")};var vT=/^__.*__$/,zl=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return this.fieldMask!==null?new st(e,this.data,this.fieldMask,t,this.fieldTransforms):new an(e,this.data,t,this.fieldTransforms)}},fa=class{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new st(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function dy(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw q(40011,{Ec:r})}}var ma=class r{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new r(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:n,mc:!1});return i.fc(e),i}gc(e){var t;let n=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Rc({path:n,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return ga(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(e.length===0)throw this.wc("Document fields must not be empty");if(dy(this.Ec)&&vT.test(e))throw this.wc('Document fields cannot begin and end with "__"')}},$l=class{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Is(e)}Dc(e,t,n,i=!1){return new ma({Ec:e,methodName:t,bc:n,path:me.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function $n(r){let e=r._freezeSettings(),t=Is(r._databaseId);return new $l(r._databaseId,!!e.ignoreUndefinedProperties,t)}function Va(r,e,t,n,i,s={}){let a=r.Dc(s.merge||s.mergeFields?2:0,e,t,i);$h("Data must be an object, but it was:",a,n);let u=gy(n,a),c,h;if(s.merge)c=new Xe(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let y=Hl(e,g,t);if(!a.contains(y))throw new D(R.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);yy(f,y)||f.push(y)}c=new Xe(f),h=a.fieldTransforms.filter(g=>c.covers(g.field))}else c=null,h=a.fieldTransforms;return new zl(new xe(u),c,h)}var gs=class r extends Dt{_toFieldTransform(e){if(e.Ec!==2)throw e.Ec===1?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof r}};function fy(r,e,t){return new ma({Ec:3,bc:e.settings.bc,methodName:r._methodName,mc:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var Gl=class r extends Dt{_toFieldTransform(e){return new Mn(e.path,new sn)}isEqual(e){return e instanceof r}},Kl=class r extends Dt{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=fy(this,e,!0),n=this.vc.map(s=>Gn(s,t)),i=new Pt(n);return new Mn(e.path,i)}isEqual(e){return e instanceof r&&Ys(this.vc,e.vc)}},Wl=class r extends Dt{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){let t=fy(this,e,!0),n=this.vc.map(s=>Gn(s,t)),i=new Ct(n);return new Mn(e.path,i)}isEqual(e){return e instanceof r&&Ys(this.vc,e.vc)}},Ql=class r extends Dt{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){let t=new on(e.serializer,Hg(e.serializer,this.Cc));return new Mn(e.path,t)}isEqual(e){return e instanceof r&&this.Cc===e.Cc}};function Bh(r,e,t,n){let i=r.Dc(1,e,t);$h("Data must be an object, but it was:",i,n);let s=[],a=xe.empty();fn(n,(c,h)=>{let f=Gh(e,c,t);h=ce(h);let g=i.gc(f);if(h instanceof gs)s.push(f);else{let y=Gn(h,g);y!=null&&(s.push(f),a.set(f,y))}});let u=new Xe(s);return new fa(a,u,i.fieldTransforms)}function zh(r,e,t,n,i,s){let a=r.Dc(1,e,t),u=[Hl(e,n,t)],c=[i];if(s.length%2!=0)throw new D(R.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)u.push(Hl(e,s[y])),c.push(s[y+1]);let h=[],f=xe.empty();for(let y=u.length-1;y>=0;--y)if(!yy(h,u[y])){let A=u[y],x=c[y];x=ce(x);let k=a.gc(A);if(x instanceof gs)h.push(A);else{let V=Gn(x,k);V!=null&&(h.push(A),f.set(A,V))}}let g=new Xe(h);return new fa(f,g,a.fieldTransforms)}function my(r,e,t,n=!1){return Gn(t,r.Dc(n?4:3,e))}function Gn(r,e){if(py(r=ce(r)))return $h("Unsupported field value:",e,r),gy(r,e);if(r instanceof Dt)return function(n,i){if(!dy(i.Ec))throw i.wc(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(r===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.mc&&e.Ec!==4)throw e.wc("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let c=Gn(u,i.yc(a));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if((n=ce(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Hg(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=se.fromDate(n);return{timestampValue:Or(i.serializer,s)}}if(n instanceof se){let s=new se(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Or(i.serializer,s)}}if(n instanceof gt)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof Je)return{bytesValue:ip(i.serializer,n._byteString)};if(n instanceof ne){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.wc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:_h(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Jt)return function(a,u){return{mapValue:{fields:{[dh]:{stringValue:fh},[Dr]:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw u.wc("VectorValues must only contain numeric values.");return yh(u.serializer,h)})}}}}}}(n,i);throw i.wc(`Unsupported field value: ${Ta(n)}`)}(r,e)}function gy(r,e){let t={};return Sg(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):fn(r,(n,i)=>{let s=Gn(i,e.Vc(n));s!=null&&(t[n]=s)}),{mapValue:{fields:t}}}function py(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof se||r instanceof gt||r instanceof Je||r instanceof ne||r instanceof Dt||r instanceof Jt)}function $h(r,e,t){if(!py(t)||!cg(t)){let n=Ta(t);throw n==="an object"?e.wc(r+" a custom object"):e.wc(r+" "+n)}}function Hl(r,e,t){if((e=ce(e))instanceof ot)return e._internalPath;if(typeof e=="string")return Gh(r,e);throw ga("Field path arguments must be of type string or ",r,!1,void 0,t)}var TT=new RegExp("[~\\*/\\[\\]]");function Gh(r,e,t){if(e.search(TT)>=0)throw ga(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new ot(...e.split("."))._internalPath}catch{throw ga(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function ga(r,e,t,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new D(R.INVALID_ARGUMENT,u+r+c)}function yy(r,e){return r.some(t=>t.isEqual(e))}var Bn=class{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ne(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Xl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(xa("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Xl=class extends Bn{data(){return super.data()}};function xa(r,e){return typeof e=="string"?Gh(r,e):e instanceof ot?e._internalPath:e._delegate._internalPath}function _y(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new D(R.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ps=class{},zn=class extends ps{};function kt(r,e,...t){let n=[];e instanceof ps&&n.push(e),n=n.concat(t),function(s){let a=s.filter(c=>c instanceof Jl).length,u=s.filter(c=>c instanceof pa).length;if(a>1||a>0&&u>0)throw new D(R.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var pa=class r extends zn{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=this._parse(e);return Py(e._query,t),new be(e.firestore,e.converter,bc(e._query,t))}_parse(e){let t=$n(e.firestore);return function(s,a,u,c,h,f,g){let y;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new D(R.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){ig(g,f);let x=[];for(let k of g)x.push(rg(c,s,k));y={arrayValue:{values:x}}}else y=rg(c,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||ig(g,f),y=my(u,a,g,f==="in"||f==="not-in");return H.create(h,f,y)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function wy(r,e,t){let n=e,i=xa("where",r);return pa._create(i,n,t)}var Jl=class r extends ps{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new r(e,t)}_parse(e){let t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return t.length===1?t[0]:te.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let c of u)Py(a,c),a=bc(a,c)}(e._query,t),new be(e.firestore,e.converter,bc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Yl=class r extends zn{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new r(e,t)}_apply(e){let t=function(i,s,a){if(i.startAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(R.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new On(s,a)}(e._query,this._field,this._direction);return new be(e.firestore,e.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new rt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function vy(r,e="asc"){let t=e,n=xa("orderBy",r);return Yl._create(n,t)}var ya=class r extends zn{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){return new be(e.firestore,e.converter,No(e._query,this._limit,this._limitType))}};function Ty(r){return lg("limit",r),ya._create("limit",r,"F")}function Ey(r){return lg("limitToLast",r),ya._create("limitToLast",r,"L")}var _a=class r extends zn{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=Ry(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new rt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function Iy(...r){return _a._create("startAt",r,!0)}function Ay(...r){return _a._create("startAfter",r,!1)}var wa=class r extends zn{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new r(e,t,n)}_apply(e){let t=Ry(e,this.type,this._docOrFields,this._inclusive);return new be(e.firestore,e.converter,function(i,s){return new rt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function by(...r){return wa._create("endBefore",r,!1)}function Sy(...r){return wa._create("endAt",r,!0)}function Ry(r,e,t,n){if(t[0]=ce(t[0]),t[0]instanceof Bn)return function(s,a,u,c,h){if(!c)throw new D(R.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of Tr(s))if(g.field.isKeyField())f.push(Nn(a,c.key));else{let y=c.data.field(g.field);if(ba(y))throw new D(R.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(y===null){let A=g.field.canonicalString();throw new D(R.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}f.push(y)}return new yt(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{let i=$n(r.firestore);return function(a,u,c,h,f,g){let y=a.explicitOrderBy;if(f.length>y.length)throw new D(R.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let A=[];for(let x=0;x<f.length;x++){let k=f[x];if(y[x].field.isKeyField()){if(typeof k!="string")throw new D(R.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof k}`);if(!gh(a)&&k.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${k}' contains a slash.`);let V=a.path.child(X.fromString(k));if(!F.isDocumentKey(V))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);let z=new F(V);A.push(Nn(u,z))}else{let V=my(c,h,k);A.push(V)}}return new yt(A,g)}(r._query,r.firestore._databaseId,i,e,t,n)}}function rg(r,e,t){if(typeof(t=ce(t))=="string"){if(t==="")throw new D(R.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gh(e)&&t.indexOf("/")!==-1)throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let n=e.path.child(X.fromString(t));if(!F.isDocumentKey(n))throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return Nn(r,new F(n))}if(t instanceof ne)return Nn(r,t._key);throw new D(R.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ta(t)}.`)}function ig(r,e){if(!Array.isArray(r)||r.length===0)throw new D(R.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Py(r,e){let t=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(R.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var Gr=class{convertValue(e,t="none"){switch(nn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ue(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Rt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw q(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return fn(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;let s=(i=(n=(t=e.fields)===null||t===void 0?void 0:t[Dr].arrayValue)===null||n===void 0?void 0:n.values)===null||i===void 0?void 0:i.map(a=>ue(a.doubleValue));return new Jt(s)}convertGeoPoint(e){return new gt(ue(e.latitude),ue(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=Sa(e);return n==null?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Zi(e));default:return null}}convertTimestamp(e){let t=St(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=X.fromString(e);U(gp(n),9688,{name:e});let i=new tn(n.get(1),n.get(3)),s=new F(n.popFirst(5));return i.isEqual(t)||fe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function ka(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}var Zl=class extends Gr{constructor(e){super(),this.firestore=e}convertBytes(e){return new Je(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ne(this.firestore,null,t)}};var bt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},Ue=class r extends Bn{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Yt(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(xa("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new D(R.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=r._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}};Ue._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ue._jsonSchema={type:ve("string",Ue._jsonSchemaVersion),bundleSource:ve("string","DocumentSnapshot"),bundleName:ve("string"),bundle:ve("string")};var Yt=class extends Ue{data(e={}){return super.data(e)}},Ge=class r{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new bt(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new Yt(this._firestore,this._userDataWriter,n.key,n,new bt(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(R.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let c=new Yt(i._firestore,i._userDataWriter,u.doc.key,u.doc,new bt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new Yt(i._firestore,i._userDataWriter,u.doc.key,u.doc,new bt(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return u.type!==0&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:ET(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new D(R.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=r._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ki.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(t.push(s._document),n.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}};function ET(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return q(61501,{type:r})}}function Kh(r,e){return r instanceof Ue&&e instanceof Ue?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(r._document===null?e._document===null:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof Ge&&e instanceof Ge&&r._firestore===e._firestore&&jh(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function Cy(r){r=Z(r,ne);let e=Z(r.firestore,le);return Hp(Se(e),r._key).then(t=>Xh(e,r,t))}Ge._jsonSchemaVersion="firestore/querySnapshot/1.0",Ge._jsonSchema={type:ve("string",Ge._jsonSchemaVersion),bundleSource:ve("string","QuerySnapshot"),bundleName:ve("string"),bundle:ve("string")};var Vt=class extends Gr{constructor(e){super(),this.firestore=e}convertBytes(e){return new Je(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ne(this.firestore,null,t)}};function Dy(r){r=Z(r,ne);let e=Z(r.firestore,le),t=Se(e),n=new Vt(e);return gT(t,r._key).then(i=>new Ue(e,n,r._key,i,new bt(i!==null&&i.hasLocalMutations,!0),r.converter))}function Vy(r){r=Z(r,ne);let e=Z(r.firestore,le);return Hp(Se(e),r._key,{source:"server"}).then(t=>Xh(e,r,t))}function xy(r){r=Z(r,be);let e=Z(r.firestore,le),t=Se(e),n=new Vt(e);return _y(r._query),Xp(t,r._query).then(i=>new Ge(e,n,r,i))}function ky(r){r=Z(r,be);let e=Z(r.firestore,le),t=Se(e),n=new Vt(e);return pT(t,r._query).then(i=>new Ge(e,n,r,i))}function Ny(r){r=Z(r,be);let e=Z(r.firestore,le),t=Se(e),n=new Vt(e);return Xp(t,r._query,{source:"server"}).then(i=>new Ge(e,n,r,i))}function Wh(r,e,t){r=Z(r,ne);let n=Z(r.firestore,le),i=ka(r.converter,e,t);return Yr(n,[Va($n(n),"setDoc",r._key,i,r.converter!==null,t).toMutation(r._key,de.none())])}function Qh(r,e,t,...n){r=Z(r,ne);let i=Z(r.firestore,le),s=$n(i),a;return a=typeof(e=ce(e))=="string"||e instanceof ot?zh(s,"updateDoc",r._key,e,t,n):Bh(s,"updateDoc",r._key,e),Yr(i,[a.toMutation(r._key,de.exists(!0))])}function Oy(r){return Yr(Z(r.firestore,le),[new un(r._key,de.none())])}function Fy(r,e){let t=Z(r.firestore,le),n=bs(r),i=ka(r.converter,e);return Yr(t,[Va($n(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,de.exists(!1))]).then(()=>n)}function Hh(r,...e){var t,n,i;r=ce(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||jl(e[a])||(s=e[a++]);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(jl(e[a])){let g=e[a];e[a]=(t=g.next)===null||t===void 0?void 0:t.bind(g),e[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),e[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let c,h,f;if(r instanceof ne)h=Z(r.firestore,le),f=Wr(r._key.path),c={next:g=>{e[a]&&e[a](Xh(h,r,g))},error:e[a+1],complete:e[a+2]};else{let g=Z(r,be);h=Z(g.firestore,le),f=g._query;let y=new Vt(h);c={next:A=>{e[a]&&e[a](new Ge(h,y,g,A))},error:e[a+1],complete:e[a+2]},_y(r._query)}return function(y,A,x,k){let V=new zr(k),z=new ms(A,V,x);return y.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return Sh(yield $r(y),z)})),()=>{V.Ou(),y.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return Rh(yield $r(y),z)}))}}(Se(h),f,u,c)}function My(r,e){return yT(Se(r=Z(r,le)),jl(e)?e:{next:e})}function Yr(r,e){return function(n,i){let s=new Ee;return n.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){return Xv(yield Lh(n),i,s)})),s.promise}(Se(r),e)}function Xh(r,e,t){let n=t.docs.get(e._key),i=new Vt(r);return new Ue(r,i,e._key,n,new bt(t.hasPendingWrites,t.fromCache),e.converter)}var IT={maxAttempts:5};var va=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=$n(e)}set(e,t,n){this._verifyNotCommitted();let i=Ht(e,this._firestore),s=ka(i.converter,t,n),a=Va(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,de.none())),this}update(e,t,n,...i){this._verifyNotCommitted();let s=Ht(e,this._firestore),a;return a=typeof(t=ce(t))=="string"||t instanceof ot?zh(this._dataReader,"WriteBatch.update",s._key,t,n,i):Bh(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,de.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=Ht(e,this._firestore);return this._mutations=this._mutations.concat(new un(t._key,de.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(R.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ht(r,e){if((r=ce(r)).firestore!==e)throw new D(R.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var eh=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=$n(e)}get(e){let t=Ht(e,this._firestore),n=new Zl(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return q(24041);let s=i[0];if(s.isFoundDocument())return new Bn(this._firestore,n,s.key,s,t.converter);if(s.isNoDocument())return new Bn(this._firestore,n,t._key,null,t.converter);throw q(18433,{doc:s})})}set(e,t,n){let i=Ht(e,this._firestore),s=ka(i.converter,t,n),a=Va(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,n);return this._transaction.set(i._key,a),this}update(e,t,n,...i){let s=Ht(e,this._firestore),a;return a=typeof(t=ce(t))=="string"||t instanceof ot?zh(this._dataReader,"Transaction.update",s._key,t,n,i):Bh(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,a),this}delete(e){let t=Ht(e,this._firestore);return this._transaction.delete(t._key),this}};var th=class extends eh{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=Ht(e,this._firestore),n=new Vt(this._firestore);return super.get(e).then(i=>new Ue(this._firestore,n,t._key,i._document,new bt(!1,!1),t.converter))}};function Ly(r,e,t){r=Z(r,le);let n=Object.assign(Object.assign({},IT),t);return function(s){if(s.maxAttempts<1)throw new D(R.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let c=new Ee;return s.asyncQueue.enqueueAndForget(()=>C(null,null,function*(){let h=yield dT(s);new ql(s.asyncQueue,h,u,a,c).zu()})),c.promise}(Se(r),i=>e(new th(r,i)),n)}function qy(){return new gs("deleteField")}function Uy(){return new Gl("serverTimestamp")}function jy(...r){return new Kl("arrayUnion",r)}function By(...r){return new Wl("arrayRemove",r)}function zy(r){return new Ql("increment",r)}(function(e,t=!0){(function(i){Kr=i})(Af),Si(new En("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new le(new Yu(n.getProvider("auth-internal")),new tc(a,n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new D(R.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new tn(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),jt(zf,$f,e),jt(zf,$f,"esm2017")})();var AT="@firebase/firestore-compat",bT="0.3.53";function nd(r,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${r}(): You cannot specify both "merge" and "mergeFields".`);return e}function $y(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function Gy(){if(!Rg())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Na=class r{constructor(e){this._delegate=e}static fromBase64String(e){return Gy(),new r(Je.fromBase64String(e))}static fromUint8Array(e){return $y(),new r(Je.fromUint8Array(e))}toBase64(){return Gy(),this._delegate.toBase64()}toUint8Array(){return $y(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function Jh(r){return ST(r,["next","error","complete"])}function ST(r,e){if(typeof r!="object"||r===null)return!1;let t=r;for(let n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}var Yh=class{enableIndexedDbPersistence(e,t){return ry(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return iy(e._delegate)}clearIndexedDbPersistence(e){return oy(e._delegate)}},Oa=class{constructor(e,t,n){this._delegate=t,this._persistenceProvider=n,this.INTERNAL={delete:()=>this.terminate()},e instanceof tn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Ke("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,n={}){Zp(this._delegate,e,t,n)}enableNetwork(){return uy(this._delegate)}disableNetwork(){return cy(this._delegate)}enablePersistence(e){let t=!1,n=!1;return e&&(t=!!e.synchronizeTabs,n=!!e.experimentalForceOwningTab,sh("synchronizeTabs",t,"experimentalForceOwningTab",n)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return ay(this._delegate)}onSnapshotsInSync(e){return My(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new ti(this,qh(this._delegate,e))}catch(t){throw je(t,"collection()","Firestore.collection()")}}doc(e){try{return new _t(this,bs(this._delegate,e))}catch(t){throw je(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Hn(this,ey(this._delegate,e))}catch(t){throw je(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Ly(this._delegate,t=>e(new Fa(this,t)))}batch(){return Se(this._delegate),new Ma(new va(this._delegate,e=>Yr(this._delegate,e)))}loadBundle(e){return ly(this._delegate,e)}namedQuery(e){return hy(this._delegate,e).then(t=>t?new Hn(this,t):null)}},Zr=class extends Gr{constructor(e){super(),this.firestore=e}convertBytes(e){return new Na(new Je(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return _t.forKey(t,this.firestore,null)}};function RT(r){sg(r)}var Fa=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Zr(e)}get(e){let t=Kn(e);return this._delegate.get(t).then(n=>new Wn(this._firestore,new Ue(this._firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,t.converter)))}set(e,t,n){let i=Kn(e);return n?(nd("Transaction.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Kn(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Kn(e);return this._delegate.delete(t),this}},Ma=class{constructor(e){this._delegate=e}set(e,t,n){let i=Kn(e);return n?(nd("WriteBatch.set",n),this._delegate.set(i,t,n)):this._delegate.set(i,t),this}update(e,t,n,...i){let s=Kn(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,n,...i),this}delete(e){let t=Kn(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ei=class r{constructor(e,t,n){this._firestore=e,this._userDataWriter=t,this._delegate=n}fromFirestore(e,t){let n=new Yt(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Qn(this._firestore,n),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let n=r.INSTANCES,i=n.get(e);i||(i=new WeakMap,n.set(e,i));let s=i.get(t);return s||(s=new r(e,new Zr(e),t),i.set(t,s)),s}};ei.INSTANCES=new WeakMap;var _t=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zr(e)}static forPath(e,t,n){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new r(t,new ne(t._delegate,n,new F(e)))}static forKey(e,t,n){return new r(t,new ne(t._delegate,n,e))}get id(){return this._delegate.id}get parent(){return new ti(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new ti(this.firestore,qh(this._delegate,e))}catch(t){throw je(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ce(e),e instanceof ne?Uh(this._delegate,e):!1}set(e,t){t=nd("DocumentReference.set",t);try{return t?Wh(this._delegate,e,t):Wh(this._delegate,e)}catch(n){throw je(n,"setDoc()","DocumentReference.set()")}}update(e,t,...n){try{return arguments.length===1?Qh(this._delegate,e):Qh(this._delegate,e,t,...n)}catch(i){throw je(i,"updateDoc()","DocumentReference.update()")}}delete(){return Oy(this._delegate)}onSnapshot(...e){let t=Ky(e),n=Wy(e,i=>new Wn(this.firestore,new Ue(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Hh(this._delegate,t,n)}get(e){let t;return e?.source==="cache"?t=Dy(this._delegate):e?.source==="server"?t=Vy(this._delegate):t=Cy(this._delegate),t.then(n=>new Wn(this.firestore,new Ue(this.firestore._delegate,this._userDataWriter,n._key,n._document,n.metadata,this._delegate.converter)))}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(ei.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function je(r,e,t){return r.message=r.message.replace(e,t),r}function Ky(r){for(let e of r)if(typeof e=="object"&&!Jh(e))return e;return{}}function Wy(r,e){var t,n;let i;return Jh(r[0])?i=r[0]:Jh(r[1])?i=r[1]:typeof r[0]=="function"?i={next:r[0],error:r[1],complete:r[2]}:i={next:r[1],error:r[2],complete:r[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(n=i.complete)===null||n===void 0?void 0:n.bind(i)}}var Wn=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new _t(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Kh(this._delegate,e._delegate)}},Qn=class extends Wn{data(e){let t=this._delegate.data(e);return this._delegate._converter||ag(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Hn=class r{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Zr(e)}where(e,t,n){try{return new r(this.firestore,kt(this._delegate,wy(e,t,n)))}catch(i){throw je(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new r(this.firestore,kt(this._delegate,vy(e,t)))}catch(n){throw je(n,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new r(this.firestore,kt(this._delegate,Ty(e)))}catch(t){throw je(t,"limit()","Query.limit()")}}limitToLast(e){try{return new r(this.firestore,kt(this._delegate,Ey(e)))}catch(t){throw je(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new r(this.firestore,kt(this._delegate,Iy(...e)))}catch(t){throw je(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new r(this.firestore,kt(this._delegate,Ay(...e)))}catch(t){throw je(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new r(this.firestore,kt(this._delegate,by(...e)))}catch(t){throw je(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new r(this.firestore,kt(this._delegate,Sy(...e)))}catch(t){throw je(t,"endAt()","Query.endAt()")}}isEqual(e){return jh(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=ky(this._delegate):e?.source==="server"?t=Ny(this._delegate):t=xy(this._delegate),t.then(n=>new Ss(this.firestore,new Ge(this.firestore._delegate,this._userDataWriter,this._delegate,n._snapshot)))}onSnapshot(...e){let t=Ky(e),n=Wy(e,i=>new Ss(this.firestore,new Ge(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Hh(this._delegate,t,n)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(ei.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},Zh=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Qn(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Ss=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Hn(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Qn(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Zh(this._firestore,t))}forEach(e,t){this._delegate.forEach(n=>{e.call(t,new Qn(this._firestore,n))})}isEqual(e){return Kh(this._delegate,e._delegate)}},ti=class r extends Hn{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new _t(this.firestore,e):null}doc(e){try{return e===void 0?new _t(this.firestore,bs(this._delegate)):new _t(this.firestore,bs(this._delegate,e))}catch(t){throw je(t,"doc()","CollectionReference.doc()")}}add(e){return Fy(this._delegate,e).then(t=>new _t(this.firestore,t))}isEqual(e){return Uh(this._delegate,e._delegate)}withConverter(e){return new r(this.firestore,e?this._delegate.withConverter(ei.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Kn(r){return Z(r,ne)}var ed=class r{constructor(...e){this._delegate=new ot(...e)}static documentId(){return new r(me.keyField().canonicalString())}isEqual(e){return e=ce(e),e instanceof ot?this._delegate._internalPath.isEqual(e._internalPath):!1}};var td=class r{static serverTimestamp(){let e=Uy();return e._methodName="FieldValue.serverTimestamp",new r(e)}static delete(){let e=qy();return e._methodName="FieldValue.delete",new r(e)}static arrayUnion(...e){let t=jy(...e);return t._methodName="FieldValue.arrayUnion",new r(t)}static arrayRemove(...e){let t=By(...e);return t._methodName="FieldValue.arrayRemove",new r(t)}static increment(e){let t=zy(e);return t._methodName="FieldValue.increment",new r(t)}constructor(e){this._delegate=e}isEqual(e){return this._delegate.isEqual(e._delegate)}};var PT={Firestore:Oa,GeoPoint:gt,Timestamp:se,Blob:Na,Transaction:Fa,WriteBatch:Ma,DocumentReference:_t,DocumentSnapshot:Wn,Query:Hn,QueryDocumentSnapshot:Qn,QuerySnapshot:Ss,CollectionReference:ti,FieldPath:ed,FieldValue:td,setLogLevel:RT,CACHE_SIZE_UNLIMITED:ty};function CT(r,e){r.INTERNAL.registerComponent(new En("firestore-compat",t=>{let n=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(n,i)},"PUBLIC").setServiceProps(Object.assign({},PT)))}function DT(r){CT(r,(e,t)=>new Oa(e,t,new Yh)),r.registerVersion(AT,bT)}DT(Le);function VT(r,e=Gs){return new Lt(t=>{let n;return e!=null?e.schedule(()=>{n=r.onSnapshot({includeMetadataChanges:!0},t)}):n=r.onSnapshot({includeMetadataChanges:!0},t),()=>{n?.()}})}function Qy(r,e){return VT(r,e)}function xT(r,e){return Qy(r,e).pipe(Hs(void 0),Ws(),Fe(t=>{let[n,i]=t;return i.exists?n?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function sd(r,e){return Qy(r,e).pipe(Fe(t=>({payload:t,type:"query"})))}var La=class{ref;afs;injector=et(Tn);constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let n=this.ref.collection(e),{ref:i,query:s}=Zy(n,t);return new Ua(i,s,this.afs)}snapshotChanges(){return xT(this.ref,this.afs.schedulers.outsideAngular).pipe(Be(this.injector))}valueChanges(e={}){return this.snapshotChanges().pipe(Fe(({payload:t})=>e.idField?$s(Ti({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return qt(this.ref.get(e)).pipe(Be(this.injector))}};function qa(r,e){return sd(r,e).pipe(Hs(void 0),Ws(),Fe(t=>{let[n,i]=t,s=i.payload.docChanges(),a=s.map(u=>({type:u.type,payload:u}));return n&&JSON.stringify(n.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,c)=>{let h=s.find(g=>g.doc.ref.isEqual(u.ref)),f=n?.payload.docs.find(g=>g.ref.isEqual(u.ref));h&&JSON.stringify(h.doc.metadata)===JSON.stringify(u.metadata)||!h&&f&&JSON.stringify(f.metadata)===JSON.stringify(u.metadata)||a.push({type:"modified",payload:{oldIndex:c,newIndex:c,type:"modified",doc:u}})}),a}))}function Hy(r,e,t){return qa(r,t).pipe(Qs((n,i)=>kT(n,i.map(s=>s.payload),e),[]),hf(),Fe(n=>n.map(i=>({type:i.type,payload:i}))))}function kT(r,e,t){return e.forEach(n=>{t.indexOf(n.type)>-1&&(r=NT(r,n))}),r}function rd(r,e,t,...n){let i=r.slice();return i.splice(e,t,...n),i}function NT(r,e){switch(e.type){case"added":if(!r[e.newIndex]?.doc.ref.isEqual(e.doc.ref))return rd(r,e.newIndex,0,e);break;case"modified":if(r[e.oldIndex]==null||r[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=r.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return rd(r,e.newIndex,1,e);break;case"removed":if(r[e.oldIndex]?.doc.ref.isEqual(e.doc.ref))return rd(r,e.oldIndex,1);break}return r}function Xy(r){return(!r||r.length===0)&&(r=["added","removed","modified"]),r}var Ua=class{ref;query;afs;injector=et(Tn);constructor(e,t,n){this.ref=e,this.query=t,this.afs=n}stateChanges(e){let t=qa(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(Fe(n=>n.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Hs(void 0),Ws(),Ii(([n,i])=>i.length>0||!n),Fe(([,n])=>n),Be(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(Qs((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=Xy(e);return Hy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Be(this.injector))}valueChanges(e={}){return sd(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(t=>t.payload.docs.map(n=>e.idField?$s(Ti({},n.data()),{[e.idField]:n.id}):n.data())),Be(this.injector))}get(e){return qt(this.query.get(e)).pipe(Be(this.injector))}add(e){return this.ref.add(e)}doc(e){return new La(this.ref.doc(e),this.afs)}},id=class{query;afs;injector=et(Tn);constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?qa(this.query,this.afs.schedulers.outsideAngular).pipe(Be(this.injector)):qa(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(t=>t.filter(n=>e.indexOf(n.type)>-1)),Ii(t=>t.length>0),Be(this.injector))}auditTrail(e){return this.stateChanges(e).pipe(Qs((t,n)=>[...t,...n],[]))}snapshotChanges(e){let t=Xy(e);return Hy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Be(this.injector))}valueChanges(e={}){return sd(this.query,this.afs.schedulers.outsideAngular).pipe(Fe(n=>n.payload.docs.map(i=>e.idField?Ti({[e.idField]:i.id},i.data()):i.data())),Be(this.injector))}get(e){return qt(this.query.get(e)).pipe(Be(this.injector))}},Jy=new Me("angularfire2.enableFirestorePersistence"),Yy=new Me("angularfire2.firestore.persistenceSettings"),OT=new Me("angularfire2.firestore.settings"),FT=new Me("angularfire2.firestore.use-emulator");function Zy(r,e=t=>t){return{query:e(r),ref:r}}var MT=(()=>{class r{schedulers;firestore;persistenceEnabled$;ngZone=et(at);constructor(t,n,i,s,a,u,c,h,f,g,y,A,x,k,V,z,B){this.schedulers=c;let M=Pi(t,u,n),$=f;g&&Ou(M,u,y,x,k,V,A,z),[this.firestore,this.persistenceEnabled$]=no(`${M.name}.firestore`,"AngularFirestore",M.name,()=>{let K=u.runOutsideAngular(()=>M.firestore());if(s&&K.settings(s),$&&K.useEmulator(...$),i&&!Xs(a)){let W=()=>{try{return qt(K.enablePersistence(h||void 0).then(()=>!0,()=>!1))}catch(v){return typeof console<"u"&&console.warn(v),Ut(!1)}};return[K,u.runOutsideAngular(W)]}else return[K,Ut(!1)]},[s,$,i])}collection(t,n){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:a}=Zy(i,n),u=this.ngZone.run(()=>s);return new Ua(u,a,this)}collectionGroup(t,n){let i=n||(a=>a),s=this.firestore.collectionGroup(t);return new id(i(s),this)}doc(t){let n;typeof t=="string"?n=this.firestore.doc(t):n=t;let i=this.ngZone.run(()=>n);return new La(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(n){return new(n||r)(Y(ir),Y(sr,8),Y(Jy,8),Y(OT,8),Y(nr),Y(at),Y(Ri),Y(Yy,8),Y(FT,8),Y(Fu,8),Y(Cu,8),Y(Du,8),Y(Vu,8),Y(xu,8),Y(ku,8),Y(Nu,8),Y(or,8))};static \u0275prov=er({token:r,factory:r.\u0275fac,providedIn:"any"})}return r})(),kI=(()=>{class r{constructor(){Le.registerVersion("angularfire",Bt.full,"fst-compat")}static enablePersistence(t){return{ngModule:r,providers:[{provide:Jy,useValue:!0},{provide:Yy,useValue:t}]}}static \u0275fac=function(n){return new(n||r)};static \u0275mod=rr({type:r});static \u0275inj=tr({providers:[MT]})}return r})();export{hE as a,XE as b,MT as c,kI as d};
